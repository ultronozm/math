\documentclass[reqno]{amsart} \input{common.tex}

\usepackage{tikz-cd}


\numberwithin{theorem}{section}
\numberwithin{equation}{section}
\numberwithin{exercise}{section}

\begin{document}

\title{Aarhus Automorphic Forms Summer School}

\begin{abstract}
  Notes in progress on lectures taking place there.
\end{abstract}

\section{Gebhard Boeckle's lectures}\label{sec:cq6tho1n9f}
\textbf{Galois representations and congruences}.

We first discuss profinite groups.  Let $G$ be a topological group.

\begin{theorem}\label{theorem:cq6thpngt0}
  The following are equivalent:
  \begin{enumerate}[(a)]
  \item\label{enumerate:cq6r3e8dsb} $G$ is compact, Hausdorff, and totally disconnected.
  \item\label{enumerate:cq6r3e8eqf} $G$ is compact, and admits a neighborhood basis of the identity by open normal subgroups.
  \item\label{enumerate:cq6r3e8f6g} There is a directed poset $I$ and an inverse system $(G_i)$ of finite (discrete) groups such that $G = \varprojlim_I G_i$.
  \end{enumerate}
\end{theorem}
We say that $G$ is \emph{profinite} if the above conditions hold.  The topology on $\varprojlim G_i$ is that obtained by regarding it as a closed subgroup of the product $\prod G_i$.

Constructions:
\begin{enumerate}[(a)]
\item\label{enumerate:cq6r3e8b0y} If $G$ is discrete, then we equip it with the profinite topology $G^{\mathrm{pf}} := \varprojlim G / N$, where $N$ runs over the finite index subgroups.
\item\label{enumerate:cq6r3e8cou} If $G = \varprojlim G_i$ is profinite, then
  \begin{enumerate}[(i)]
  \item\label{enumerate:cq6r3fehbe} The abelianization is given by
    \begin{equation*}
      G^{\mathrm{ab}} = G / \overline{[G, G]} = \varprojlim G_i^{\mathrm{ab}},
    \end{equation*}
    and in particular, is profinite.
  \item\label{enumerate:cq6r3feivc} For $H$ finite, write $H_p$ for its maximal $p$-group quotient.  Then
    \begin{equation*}
      G_p = \varprojlim(G_i)_p
    \end{equation*}
    is a pro-$p$-group (and in particular, profinite).
  \item\label{enumerate:cq6r3fej61} If $N \leq G$ is closed and normal, then $G /N$ is profinite.
  \end{enumerate}
\end{enumerate}

\begin{example}\label{example:cq6thpnfb9}
  \begin{enumerate}[(a)]
  \item\label{enumerate:cq6r3fjkt4} Let $F$ be a field.  Set $G_F := \Aut_F(F^{\mathrm{sep}}) = \Gal(F^{\mathrm{sep}} / F)$ profinite.  Define the poset
    \begin{equation*}
      \mathcal{I}_F := \left\{ L \subseteq F^{\mathrm{sep}} : L \supseteq F \text{ finite Galois}, \subseteq \right\}.      
    \end{equation*}
    Then
    \begin{equation*}
      G_F \xrightarrow{\cong} \varprojlim_{L \in \mathcal{I}_F} \Gal(L / F).
    \end{equation*}
  \item\label{enumerate:cq6r3fm1jw} Let $F' \subseteq F^{\mathrm{sep}}$ be a normal extension of $F$.  Then $G_{F'} \leq G_F$ is closed and normal.  We may thus write
    \begin{equation*}
      \Gal(F ' / F) \cong G_F / G_{F'} = \lim_{
        \substack{
          L \in \mathcal{I}_F,  \\
          L \subseteq F'          
        }
      }
      \Gal(L /F).
    \end{equation*}
  \item\label{enumerate:cq6r3fm4tn} Let $\mathbb{N}$ denote the natural numbers, ordered by divisibility.  Then
    \begin{equation*}
      \hat{\mathbb{Z}} = \varprojlim \mathbb{Z} / n = \prod_{p} \mathbb{Z}_p,
    \end{equation*}
    where the last step is the Chinese remainder theorem.  We sometimes need a slight modification:
    \begin{equation*}
      \hat{\mathbb{Z}}^{(p)} = \varprojlim_{p \nmid n} \mathbb{Z} / n = \prod_{\ell \text{ prime}, \\ \ell \neq p } \mathbb{Z}_{\ell}.
    \end{equation*}

    Let's fix some notation:
    \begin{enumerate}
    \item\label{enumerate:cq6r3f3t8d} Let $K$ be a number field, $\mathcal{O}_K$ its ring of integers.  Let $\mathrm{P l}_K = \mathrm{P l}_K^\infty \sqcup \mathrm{P l}_K^{\mathrm{fin}}$ denote the set of places $v$ of $K$.  Let $v$ be a finite place.  We may then attach to it a maximal ideal $\mathfrak{q}_v$ of $\mathcal{O}_K$, giving a bijection
      \begin{equation*}
        \mathrm{P l}_K^{\mathrm{fin}} \leftrightarrow \operatorname{Max}(\mathcal{O}_K).
      \end{equation*}
      We may form the residue field $k_v := \mathcal{O}_K / \mathfrak{q}_v$.  We denote $q_v$ for the cardinality of $k_v$.  We write $\operatorname{char}(v)$ for the characteristic of $k_v$.  We denote by $\mathcal{O}_v = \varprojlim \mathcal{O} / \mathfrak{q}_v^n$, with fraction field $K_v$.  Also, we have a short exact sequence
      \begin{equation*}
        1 \rightarrow I_v \rightarrow G_v := \Gal_{K_v} \rightarrow \Gal_{k_v} \rightarrow 1.
      \end{equation*}
      A topological generator for $\Gal_{k_v}$ is given by
      \begin{equation*}
        \mathrm{Fr}_v : \alpha \mapsto \alpha^{q_v}.
      \end{equation*}
      We denote by $\mathrm{Frob}_v \in G_v$ some lift of $\mathrm{Fr}_v$.

      We write $S_\infty := \mathrm{P l}_K^\infty$ for the set of archimedean places, so that $K \otimes_{\mathbb{Q}} \mathbb{R} \cong \prod_{v \in S_\infty} K_v$.  For a rational prime $p$, we write $S_p$ for the set of places $v$ of $K$ such that $v \mid p$.
    \item We also need some local analogues for $E \supseteq \mathbb{Q}_p$ a $p$-adic field.  Let $\mathcal{O} = \mathcal{O}_E$ denote the ring of integers, $\pi = \pi_E$ a uniformizer, and $\mathbb{F} = \mathcal{O}_E / \pi$ the residue field, with $q = \# \mathbb{F}$.  Then $E \supseteq \mathbb{Q}_q = \mathbb{Q}_p[\zeta_{q - 1}] \supseteq \mathbb{Q}_p$.  We have $W(\mathbb{F}) = \mathbb{Z}_q = \mathbb{Z}_p[\zeta_{q - 1}]$.
    \end{enumerate}

    Contiuing the examples, which may serve as exercises:
    
  \item\label{enumerate:cq6r3g5d9c} Let $\zeta_t$ be a primitive $t$th root of $1$.  For $k$ a finite field, we have $G_k \cong \hat{\mathbb{Z}} = \overline{\langle \mathrm{Fr}_k \rangle}$, where $\mathrm{Fr}_k : \alpha \mapsto \alpha^{\lvert k \rvert}$.
  \item\label{enumerate:cq6r3g5e7y} Let $E \supseteq \mathbb{Q}_p$ (finite extension).  Then $G_E$ (Jannsen--Wingberg for $p \geq 2$).  Local class field theory: the Artin map $E^\times \rightarrow G_E^{\mathrm{ab}}$ is a continuous inclusion with dense image.  Writing $E^\times = \pi_E^{\mathbb{Z}} \times \mathcal{O}_E^\times = \pi_E^{\mathbb{Z}} \times \mathbb{F}^\times \times \mathcal{U}_E^1$.  Since the units are known to be a finitely generated $\mathbb{Z}_p$-module, we get as a corollary that
    \begin{equation*}
      \Hom_{\mathrm{cts}}(G_E, \mathbb{F}_p) = H^1_{\mathrm{cts}}(G_E, \mathbb{F}_p)
    \end{equation*}
    is finite.
  \item\label{enumerate:cq6r3g5cxb} We turn to the case of a number field $K$.  We fix an embedding $K^{\mathrm{sep}} \subseteq K_v^{\mathrm{sep}}$ for each place $v$, which gives an embedding of Galois groups $G_v \rightarrow G_K$.  For $S \subseteq \mathrm{P l}_K$ finite, we write
    \begin{equation*}
      K_S := \left\{ \alpha \in K^{\mathrm{sep}} : K(\alpha) \text{ is unramified outside } S \right\},
    \end{equation*}
    which is a normal (typically infinite) extension of $K$.  We write
    \begin{equation*}
      G_{K, S} := \Gal(K_S / K) = G_K / G_{K_S}
    \end{equation*}
    for its Galois group.  We remark that if we take $v \notin S$, then since $v$ does not ramify in $K_S$, we know that the map $G_v \rightarrow G_{K, S}$ factors via the quotient $G_v / I_v \cong G_{k_v}$, so that $\mathrm{Frob}_v \in G_{K, S}$ is independent of the choice of lift.  On the other hand, if $v \in S$, then we might ask whether the map $G_v \hookrightarrow G_{K, S}$ (see the work of Cheniever--Clozel).  The structure of $G_{K, S}$ is unknown, but global class field theory describes $G_{K, S}^{\mathrm{ab}}$.  A corollary is that
    \begin{equation*}
      H^{1}_{\mathrm{cts}}(G_{K, S}, \mathbb{F}_p) = \Hom_{\mathrm{cts}}(G_{K, S}, \mathbb{F}_p)
    \end{equation*}
    is finite whenever $S$ is finite.  (One can appeal to Hermite--Minkowski, or class field theory.)
  \item\label{enumerate:cq6r3g5bmp} Consider the tame quotient of $G_E$, for $E \supseteq \mathbb{Q}_p$.  Given $E \supseteq \mathbb{Q}_p$, we form the tower of extensions $E^{\mathrm{tame}} / E^{\mathrm{unr}} / E$, where
    \begin{equation*}
      E^{\mathrm{unr}} = \cup \left\{ E(\zeta_n) : p \nmid n \right\},
    \end{equation*}
    \begin{equation*}
      E^{\mathrm{tame}} = \cup \left\{ E^{\mathrm{unr}}(\sqrt[n]{\pi_E}) : p \nmid n \right\}.
    \end{equation*}
    It's a fact that $G_E^{\mathrm{tame}}$ may be expressed as the profinite completion of $\langle s t : s t s^{-1} = t^q \rangle$.
  \end{enumerate}
\end{example}
We finally come to \textbf{Galois representations}.  They will typically be called $\rho : G \rightarrow \mathrm{GL}_n(A)$, where $G$ is a topological group, $A$ is a topological ring, and $\rho$ is a continuous map.  The topology on $\mathrm{GL}_n(A)$ is the subspace topology coming from embedding inside $M_n(A) \times A$ via $g \mapsto(g, \det(g)^{-1})$, for instance.  We call $\rho$ a Galois representation if $G = G_F$ for some field $F$.  The main examples of interest for $A$ will be $\mathbb{C}$, finite fields, and $p$-adic fields, to interpolate $\mathrm{C N L}_{\mathcal{O}}$ (complete Noetherian local $\mathcal{O}$-algebras).

\begin{exercise}\label{exercise:cq6thpnece}
  Let $G$ be profinite, and $\rho$ as above.
  \begin{enumerate}[(a)]
  \item If $A = \mathbb{C}$, then $\rho(G)$ is finite.
  \item If $A = \overline{\mathcal{O}_p}$, then there is a finite extension $E \supseteq \mathbb{Q}_p$ such that $\rho(G) \subseteq \mathrm{GL}_n(E)$ up to conjugation.
  \item\label{enumerate:cq6r3j15cy} If $A = E \supseteq \mathbb{Q}_p$ (finite extension), then after conjugation, we can assume that $\rho(G) \subseteq \mathrm{GL}_n(\mathcal{O})$.
  \end{enumerate}
\end{exercise}
In case \eqref{enumerate:cq6r3j15cy}, we have a $G$-stable lattice $\Lambda \cong \mathcal{O}^n \subseteq E^n$.  We can apply reduction $\mathcal{O} \rightarrow \mathbb{F}$.  This gives a reduction
\begin{equation*}
  \overline{\rho}_\Lambda : G \rightarrow \mathrm{GL}_n(\mathbb{F}).
\end{equation*}
Let's use the notation $\mathrm{c p}_\alpha$ for the characteristic polynomial of $\alpha \in M_n(A)$.
\begin{theorem}\label{theorem:cq6thpnb2h}
  \begin{enumerate}[(a)]
  \item Given a representation $r : G \rightarrow \mathrm{GL}_n(\mathbb{F})$.  Then there exists a semisimple representation $r^{\mathrm{ss}} : G \rightarrow \mathrm{GL}_n(\mathbb{F})$ such that $\mathrm{c p}_r = \mathrm{c p}_{r^{\mathrm{ss}}}$ (Brauer--Nesbitt), where $r^{\mathrm{ss}}$ is unique up to isomorphism.
  \item We have $\mathrm{c p}_{\rho} \in \mathcal{O}[X]$ and $\mathrm{c p}_{\bar{\rho}_\Lambda} \in \mathbb{F}[X]$, independent of $\Lambda$.
  \end{enumerate}
\end{theorem}
\begin{theorem}\label{theorem:cq6thpnc4r}
  For $\rho, \rho ' : G_{K, S} \rightarrow \mathrm{GL}_n(E)$ semisimple, we have that $\rho \sim \rho '$ (conjugate) if and only if  for all $v \in \mathrm{P l}_K^{\mathrm{fin}} \setminus S$, we have
  \begin{equation*}
    \mathrm{c p}_{\rho(\Frob_v)} = \mathrm{c p}_{\rho '(\Frob_v)}.
  \end{equation*}
\end{theorem}
\begin{example}\label{example:cq6thpna68}
  \begin{enumerate}
  \item\label{enumerate:cq6r3ki8zp} $p$-adic cyclotomic character $\chi_p^{\mathrm{cyc}} : G_{\mathbb{Q}} \rightarrow \mathbb{Z}_p^\times$.  We have
    \begin{equation*}
      G_{\mathbb{Q}} \circlearrowright \mu_{p^n} = \left\langle \zeta_{p^n} \right\rangle \cong \mathbb{Z} / p^n,
    \end{equation*}
    $(\mathbb{Z} / p^n)^\times = \Aut_{\mathbb{Z}}(\mathbb{Z} / p^n)$.
    \textbf{Facts}:
    \begin{itemize}
    \item $\chi_p^{\mathrm{cyc}} \mid_{G_K}$: unramified outside $S_p \cup S_\infty$.
    \item $\chi_p^{\mathrm{cyc}}(\Frob_v) = q_v \in \mathbb{Z}_p^\times$.
    \end{itemize}
  \item\label{enumerate:cq6r3ki7yl} The Tate module of an elliptic curve $\mathcal{E}_{/ K}$.  We again have $G_K \circlearrowright \mathcal{E}[p^n](\bar{K}) \cong(\mathbb{Z} / p^n)^{\oplus 2}$, which gives rise to $G_K \rightarrow \mathrm{GL}_2(\mathbb{Z} / p^n)$.  In the limit, we get
    \begin{equation*}
      \rho_{\mathcal{E}, p} : G_K \rightarrow \mathrm{GL}_2(\mathbb{Z}_p) \hookrightarrow \mathrm{GL}_2(\mathbb{Q}_p).
    \end{equation*}
    \textbf{Facts}:
    \begin{itemize}
    \item $\rho_{\mathcal{E},p}$ is unramified outside $S_\infty \cup S_p \cup \mathrm{Bad}$.
    \item For $v$ outside those places, we have
      \begin{equation*}
        \mathrm{c p}_{\rho_{\mathcal{E}, p}}(\Frob_v) = X^2 - a_v(\mathcal{E}) X + q_v,
      \end{equation*}
      where
      \begin{equation*}
        a_v := \# \mathcal{E}(k_v).
      \end{equation*}
      This shows the geometric meaning of Frobenius.
    \end{itemize}
  \item\label{enumerate:cq6sj47m05} Let $f = q + \sum_{n \geq 2} a_n q^n$ be the $q$-expansion of a cuspidal Hecke eigenform $f \in S_k(N, \eps)$, $k \geq 1$, $\eps :(\mathbb{Z} / N)^\times \rightarrow \mathbb{C}^\times$.
    \begin{theorem}
      \begin{enumerate}[(a)]
      \item\label{enumerate:cq6sj5bs5p} $E_f = \mathbb{Q}(a_n : n \geq 1)$ is a number field, with $a_n \in \mathcal{O}_{E_f}$ for all $n$.
      \item\label{enumerate:cq6sj5bt7j} (Eichler--Shimura, Deligne, Deligne--Serre) For all finite places $\lambda$ of $E_f$ (with $E_\lambda$ the completion of $\lambda$ and $p$ the characteristic of $k_\lambda$) there exists an absolutely irreducible representation
        \begin{equation*}
          \rho_{f, \lambda} : G_{\mathbb{Q}, N \cup \{p, \infty\}} \rightarrow \mathrm{GL}_2(\bar{E}_\lambda)
        \end{equation*}
        and for all primes $\ell \nmid N p$, we have the relation that we just saw in Chris's talk:
        \begin{equation*}
          \mathrm{c p}_{\rho_{f , \lambda}}(\mathrm{Frob}_{\ell}) = X^2 - a_{\ell} X + \eps(\ell) \ell^{k - 1}.
        \end{equation*}
      \end{enumerate}
    \end{theorem}
    This characterizes the representation  and maybe gives the main link to Galois representation.
  \end{enumerate}
\end{example}

Now, we want to study congruences.  To do this, we first go from
\begin{itemize}
\item cusp forms that start life over the complex numbers on the upper half plane, to
\item Fourier coefficients, that live over the integers.
\end{itemize}
(For simplicity, assume that nebentypus is trivial: $\eps = 1$.)  Let $S_k(N, \mathbb{Z})$ denote the set of all $f = \sum_{n \geq 1} a_n q^n$ such that $a_n \in \mathbb{Z}$ for all $n$.
\begin{fact}\label{fact:cq6thpm98m}
  $S_k(N, \mathbb{Z})$ is a $\mathbb{Z}$-module of rank equal to $\dim_{\mathbb{C}} S_k(N)$.
\end{fact}
For any ring $A$, we have
\begin{equation*}
  \underline{S}_{A} = S_k(N, \mathbb{Z}) \otimes_{\mathbb{Z}} A \circlearrowleft \mathbb{T}_A = \mathbb{T}(N, A).
\end{equation*}

\begin{definition}\label{definition:cq6thpm876}
  For Hecke eigenforms $f = \sum a_n q^n$ and $g = b_n q^n \in S_k(N, \bar{\mathbb{Z}}_p)$, we say that $f \equiv g \pmod{p}$ if the following equivalent conditions hold:
  \begin{itemize}
  \item for all primes $\ell \nmid N p$, we have $a_{\ell} \equiv b_{\ell} \pmod{\mathfrak{m}_{\overline{\mathbb{Z}_p}}}$.
  \item $\rho_f \equiv \rho_g \pmod{\mathfrak{m} \bar{\mathbb{Z}}_p}$ as maps $G_{\mathbb{Q}} \rightarrow \mathrm{GL}_2(\bar{\mathbb{F}}_p)$.
  \end{itemize}
\end{definition}
We pass to the same Hecke algebra.  Let $\mathbb{T}_A '$ denote the subalgebra of $\mathbb{T}_A$ generated by $T_{\ell}$ for all $\ell \nmid N$.  This is acted on by $\underline{S}_A$.
\begin{fact}
  We have bijections between the following:
  \begin{itemize}
  \item $\mathbb{T} '$-Hecke eigensystems of forms in $S_k(N)$.
  \item $\Hom_{\mathbb{C}}(\mathbb{T}_{\mathbb{C}}', \mathbb{C})$.
  \item $\Hom_{\mathcal{O}}(\mathbb{T}_{\mathcal{O}}', \mathcal{O})$, where we choose $E$ large enough with $\mathbb{C} \supseteq \bar{\mathbb{Q}} \subseteq \bar{\mathbb{Q}}_p \supseteq E \supseteq \mathcal{O}$, where $\mathcal{O}$ always denotes the ring of integers of $E$.
  \end{itemize}
  We also have a bijection between
  \begin{itemize}
  \item $\Hom_{\mathcal{O}}(\mathbb{T}_{\mathcal{O}}, \mathbb{F})$, and
  \item The set of $\bar{\rho} : G_{\mathbb{Q}} \rightarrow \mathrm{GL}_2(\mathbb{F})$ that are semisimple reductions from some $\rho_f$, with $f \in S_k(N)$.
  \end{itemize}
  $\mathbb{T} '$ is a finite free $\mathcal{O}$-algebra.  For any $\bar{\rho}$, we get a maximal ideal $\mathfrak{m}_{\bar{\rho}} \subseteq \mathbb{T} '_{\mathcal{O}}$.  For a given $\bar{\rho}$, if we take
  \begin{equation*}
    (\mathbb{T}_{\mathcal{O}}')_{\mathfrak{m}_{\bar{\rho}}},
  \end{equation*}
  then this is the relevant Hecke algebra for understanding the forms congruent to $\bar{\rho}$.
\end{fact}
\begin{theorem}[Carayol, Serre]\label{theorem:cq6thpm721}
  Assume that $\bar{\rho}$ is absolutely irreducible.  Then there exists a continuous representation
  \begin{equation}\label{eq:cq6sj6h73f}
    \rho_{\bar{\rho}}^{\mathrm{mod}} : G_{\mathbb{Q}, N \cup \{p, \infty\}} \rightarrow \mathrm{GL}_2 \left((\mathbb{T}_0 ')_{\mathfrak{m}_{\bar{\rho}}} \right)
  \end{equation}
  ``built'' from the $\rho_f$, for $f \in S_k(N, \bar{\mathbb{Z}}_p)$, with $\rho_f \equiv \bar{\rho}$ modulo $\mathfrak{m}_{\bar{\mathbb{Z}}_p}$.
\end{theorem}
(One can write down a characteristic polynomial, similar to the above.)  Maybe one should also say that
\begin{equation}\label{eq:cq6sj6d3yn}
  \left( \mathbb{T} '_{\mathcal{O}} \right)_{\mathfrak{m}_{\bar{\rho}}} \subseteq \prod_{f, \rho_f \equiv \bar{\rho}} \mathcal{O},
\end{equation}
where the left hand side is generated by all the
\begin{equation*}
  \left\{ \trace \rho_f(\Frob_{\ell}) : \rho_f \equiv \bar{\rho}, \ell \nmid N p \right\}.
\end{equation*}
Now, is the inclusion \eqref{eq:cq6sj6d3yn} strict?  If you take twice the same form, then you get twice the same value.

\textbf{Vision of Mazur}?  Can $\rho_{\bar{\rho}}^{\mathrm{mod}}$ be characterized purely in terms of ``Galois'' theory, maybe at least once $\bar{\rho}$ is given?  You need to start somewhere.  Start with the mod $p$ representation.  Then there's a sort of $p$-adic representation \eqref{eq:cq6sj6h73f} that you get here, which sees all forms congruent to $\bar{\rho}$.  Can you see this sort of thing from a purely Galois-theoretic perspective?  This might have been the starting point for the study of deformations of Galois representations.  Mazur maybe had one example in mind: Hida had just written down his Hida families, which are much bigger than things of fixed weight and level.

Let's now turn to \emph{deformation functors}.  In many ways, what we're doing now at the beginning is very formal, and maybe in the next lecture it gets a bit more Galois-theoretic.  Let $G$ be a profinite group -- think of some global Galois group.  Let $E \supseteq \mathcal{O} \rightarrow \mathbb{F}$ be a local field, with uniformizer $\pi$ and residue field cardinality $q$.  In what natural category do these $\mathcal{O}$-algebras $\mathbb{T}_{\mathcal{O}}'$ live?
\begin{definition}\label{definition:cq6thpm6f8}
  $\mathrm{C N L }_{\mathcal{O}}$ is the category of complete noetherian $\mathcal{O}$-algebras $(A, \mathfrak{m}_{A})$ with residue field $\mathbb{F}$ and with local homomorphisms.
\end{definition}
Typical rings: $\mathcal{O} [[ X_1, \dotsc, X_r\rrbracket / I$.  Some structure theorem tells you that this is all you can get.  There is a finite subcategory
\begin{equation*}
  \mathrm{Ar}_{\mathcal{O}} \subseteq \mathrm{C N L}_{\mathcal{O}}
\end{equation*}
consisting of Artin objects.

\begin{question}\label{question:cq6thpm42q}
  For $\bar{\rho} : G \rightarrow \mathrm{GL}_n(\mathbb{F})$, when is the functor
  \begin{equation*}
    D_{\bar{\rho}} : \mathrm{C N L}_{\mathcal{O}} \rightarrow \mathrm{Set}
  \end{equation*}
  \begin{equation*}
    (A, \mathfrak{m}_A) \mapsto \left\{ \rho_A : G \rightarrow \mathrm{GL}_n(A) \mid \rho \mod{ \mathfrak{m}_A } \equiv \bar{\rho}\right\} / \sim
  \end{equation*}
  representable by $R_{\bar{\rho}} \in \mathrm{C N L}_{\mathcal{O}}$?
\end{question}
To fill in some terminology:
\begin{definition}\label{definition:cq6thpm4aq}
  \begin{enumerate}[(a)]
  \item For $A \in \mathrm{C N L}_{\mathcal{O}}$, set
    \begin{equation*}
      F_A := \Hom_{\mathrm{C N L}_{\mathcal{O}}}(A, \bullet) : \mathrm{C N L}_{\mathcal{O}} \rightarrow \mathrm{Set}.
    \end{equation*}
  \item Say that a functor $F : \mathrm{C N L}_{\mathcal{O}} \rightarrow \mathrm{Set}$ is
    \begin{enumerate}[(i)]
    \item \emph{representable} if there exists $A \in \mathrm{C N L }_{\mathcal{O}}$ such that $F \cong F_A$, and
    \item \emph{continuous} if for all $(A, \mathfrak{m}_A) \in \mathrm{C N L}_{\mathcal{O}}$, the map $F(A) \rightarrow \lim_{n} F(A / \mathfrak{m}_A^n)$ is an isomorphism.
    \end{enumerate}
  \end{enumerate}
\end{definition}
\begin{exercise}\label{exercise:cq6thpm3gt}
  \begin{enumerate}[(a)]
  \item The fiber product of the diagram $\Delta$ given by
    \begin{equation*}
      \begin{CD}
        @. B \\
        @. @V{\psi}VV \\
        A @>{\varphi}>> C
      \end{CD}
    \end{equation*}
    inside $\mathrm{A r}_{\mathcal{O}}$ is
    \begin{equation*}
      \left\{(a, b) \in A \times B \mid \varphi(a) \equiv \psi(b) \right\}.
    \end{equation*}
  \item $\mathrm{C N L}_{\mathcal{O}}$ "has no fiber products".
  \end{enumerate}
\end{exercise}
\begin{exercise}\label{exercise:cq6thpm2ek}
  Suppose $F = F_A$ for $A \in \mathrm{C N L}_{\mathcal{O}}$.  Then
  \begin{enumerate}[(a)]
  \item $F(\mathbb{F}) = \{\ast\}$, and $F$ is continuous.
  \item The Mayer--Vietoris property (MV) holds for $F$, i.e., for all diagrams $\Delta$, the induced map $(\ast)_\Delta$ is bijective, where
    \begin{equation*}
      (\ast)_\Delta : F(A \times_{C} B) \rightarrow F(A) \times_{F(C)} F(B),
    \end{equation*}
    where on the right hand side, we take the fiber product in $\mathrm{Set}$.
  \end{enumerate}
\end{exercise}
\begin{notation}
  \begin{itemize}
  \item\label{itemize:cq6thpmzgo} $\mathbb{F}[\eps] := \mathbb{F}[X] /(X^2)$.
  \item Call $\varphi : A \twoheadrightarrow A '$ in $\mathrm{CNL}_{\mathcal{O}}$ \emph{small} if $\mathfrak{m}_{A'} \cdot(\ker(\varphi)) = 0$.  (e.g., $\mathbb{F}[\eps] \rightarrow \mathbb{F}$)
  \item For $F : \mathrm{C N L}_{\mathcal{O}} \rightarrow \mathrm{Set}$, define the $T_F := F(\mathbb{F}[\eps])$, the \emph{tangent space} of $F$.
  \end{itemize}
\end{notation}
You can translate this back into rings.  Here are some more exercises:
\begin{exercise}\label{exercise:cq6thpm07x}
  If the functor $F$ satisfies
  \begin{itemize}
  \item $F(\mathbb{F}) = \{\ast\}$, and
  \item $(\ast)_{T_F} : F(\mathbb{F}[\eps] \times_{\mathbb{F}} \mathbb{F}[\eps]) \rightarrow T_F \times T_F$ is bijective,
  \end{itemize}
  then $T_F$ is an $\mathbb{F}$-vector space.
\end{exercise}
\begin{example}\label{example:cq6thpmybt}
  For $F = F_A$, we have
  \begin{equation*}
    T_F = \Hom_{\mathrm{C N L}_{\mathcal{O}}}(A, \mathbb{F}[\eps]) = \Hom_{\mathbb{F} } \left( \mathfrak{m}_A /(\mathfrak{m}_{A}^2 , \pi), \mathbb{F} \right) =: T_A.
  \end{equation*}
\end{example}
\begin{exercise}\label{exercise:cq6thpmxcy}
  For $\varphi : A \rightarrow B$ in $\mathrm{C N L}_{\mathcal{O}}$, the map $\varphi$ is surjective if and only if $T_\varphi : T_B \rightarrow T_A$ is injective.
\end{exercise}
\begin{theorem}[Grothendieck]\label{theorem:cq6thper60}
  Suppose $F : \mathrm{C N L}_{\mathcal{O}} \rightarrow \mathrm{Set}$ is continuous, satisfies $F(\mathbb{F}) = \{\ast\}$, the MV-property holds, and $\dim_{\mathbb{F}} T_F < \infty$.  Then $F$ is representable.
\end{theorem}
\begin{remark}\label{remark:cq6thpengd}
  For this last theorem, there are simplifications by Schlessinger, \emph{Functors of Artin rings}.  Schlessinger realized that these axioms of Grothendieck may be hard to verify in concrete situations, so he gave a simple (but somewhat long) list of axioms to verify.  See Mazur '87, and Gouvêa's survey.
\end{remark}
Let's now turn to \emph{Galois deformations functors}.  We have our usual
\begin{equation*}
  \bar{\rho} : G \rightarrow \mathrm{GL}_n(\mathbb{F}).
\end{equation*}
We can do something about the conjugation.

\begin{equation*}
  \Gamma_n(A) := \ker \left( \mathrm{GL}_n(A) \rightarrow \mathrm{GL}_n(\mathbb{F}) \right).
\end{equation*}
We define the \emph{lifting} and \emph{deformation} functors
\begin{equation*}
  D_{\bar{\rho}}^{\square}, \, D_{\bar{\rho}} : \mathrm{C N L}_{\mathcal{O}} \rightarrow \mathrm{Set},
\end{equation*}
\begin{equation*}
  (A, \mathfrak{m}_A) \mapsto \left\{ \rho_A : G \rightarrow \mathrm{GL}_n(A) \mid \rho_A \equiv \bar{\rho} \mod{\mathfrak{m}_A} \right\}
\end{equation*}
(``lifting functor'' or ``framed deformation functor''), and where for $D_{\bar{\rho}}$, we take things modulo $\Gamma_n(A)$-conjugacy (i.e., ``deformations are lifts modulo conjugacy'').

\begin{theorem}\label{theorem:cq6thpeky4}
  Suppose $\Phi_\rho$ holds, i.e., $\# \Hom(G, \mathbb{F}_p) < \infty$.  Then:
  \begin{enumerate}[(a)]
  \item $D_{\bar{\rho}}$ always has a ``hull''.
  \item If $\End_G(\bar{\rho}) = \mathbb{F}$, then $D_{\bar{\rho}}$ is representable (uses Schlessinger).  This gives rise to $R_{\bar{\rho}}$.
  \item\label{enumerate:cq6skams6j} (Always) $D_{\bar{\rho}}^{\square}$ is representable (Kisin, Magid--Lubotzki).  Gives rise to $R_{\bar{\rho}}^{\square}$.
  \end{enumerate}
\end{theorem}

Here \eqref{enumerate:cq6skams6j} is an exercise you can do.

\begin{example}\label{example:cq6thpeiz4}
  Take $n = 1$.  Le $\bar{\rho} : G \rightarrow \mathrm{GL}_1(\mathbb{F}) = \mathbb{F}^\times$.  \textbf{Fact} (Teichmüller lift): there exists $\hat{\rho} : G \rightarrow \mathrm{GL}_1(W(\mathbb{F}))$, a lift of $\bar{\rho}$ such that $\hat{\rho}(G) \xrightarrow{\mathrm{red}} \bar{\rho}(G)$.
\end{example}
\begin{exercise}\label{exercise:cq6thpehqo}
  Suppose that $\Hom_{\mathrm{cts}}(G^{\mathrm{ab}}, \mathbb{F})$ is finite.  Then the universal deformation ring $R_{\bar{\rho}}$ (which for $n = 1$ is the same as the universal lifting ring $R_{\bar{\rho}}^{\square}$)  is isomorphic to
  \begin{equation*}
    \mathcal{O} [[(G^{\mathrm{ab}})_p \rrbracket = \varprojlim
    \mathcal{O} \left[(G^{\mathrm{a b}})_p \right].    
  \end{equation*}
  The universal lifting is
  \begin{equation*}
    \hat{\rho} \otimes \left( G \rightarrow(G^{\mathrm{a b}})_p
      \hookrightarrow
      \mathcal{O} [[(G^{\mathrm{a b}})_p \rrbracket^\times.
    \right)
  \end{equation*}
\end{exercise}
Special cases:
\begin{enumerate}[(i)]
\item\label{enumerate:cq6skmixcf} $G = G_F$, $F \supseteq \mathbb{Q}_p$ finite extension, then by local class field theory,
  \begin{equation*}
    (G^{\mathrm{a b}})_p \cong \mu_{p^\infty}(F) \times \mathbb{Z}^{1 +[F : \mathbb{Q}_p]}.
  \end{equation*}
\item\label{enumerate:cq6skmix6w} $G = G_{K, S}$, $S \supseteq S_{\mathfrak{p}}$ finite, then global class field theory gives
  \begin{equation*}
    (G^{\mathrm{a b}})_p \cong \frac{A_{K, S}}{\text{finite $p$-group}}
    \times \mathbb{Z}_p^{r_2 + \delta},
  \end{equation*}
  where $r_2$ denotes the number of complex places and $\delta = \delta_{K, p}$ is the \emph{Leopoldt defect}, which the Leopoldt conjecture says is zero.
\end{enumerate}

We turn to cohomology.  For $\bar{\rho} : G \rightarrow \mathrm{GL}_n(\mathbb{F})$, define
\begin{equation*}
  \ad_{\bar{\rho}} = M_{n \times n}(\mathbb{F})
\end{equation*}
with the ``adjoint action'': for $g \in A$ and $\alpha \in M_{n \times n}$, we take
\begin{equation*}
  g \cdot \alpha := \bar{\rho}(g) \cdot \alpha \cdot \bar{\rho}(g)^{-1}.
\end{equation*}
(We remark that $\ad_{\bar{\rho}} \cong \bar{\rho} \otimes \bar{\rho}^\vee$.)
\begin{proposition}\label{proposition:cq6thpeed2}
  \begin{enumerate}[(a)]
  \item We have $T_{D_\rho^{\square}} = D_{\bar{\rho}}^{\square}(\mathbb{F}[\eps]) \xleftarrow{\cong} Z^1(G, \ad_{\bar{\rho}})$, where the map sends a cocycle $c : G \rightarrow \ad_{\bar{\rho}}$ to
    \begin{equation*}
      \rho_c : g \mapsto(1 + \eps c(g)) \bar{\rho}(g).
    \end{equation*}
  \item The above map induces an isomorphism $H^1(G, \ad \bar{\rho}) \xrightarrow{\cong} T_{D_{\bar{\rho}}}$.
  \item We have $\dim B^1(G, \ad_{\bar{\rho}}) = h^2 - h^0(G, \ad_{\bar{\rho}})$.  (We use the notation $h^i := \dim H^i$ and $z^i = \dim Z^i$.)
  \end{enumerate}
\end{proposition}
\begin{corollary}\label{corollary:cq6thpefo9}
  For $r = h^1(G, \ad_{\bar{\rho}})$, $r^{\square} = z^1(G, \ad_{\bar{\rho}})$, we have surjections
  \begin{equation*}
    \mathcal{O} [[ X_1, \dotsc, X_r \rrbracket \rightarrow R_{\bar{\rho}}
  \end{equation*}
  and
  \begin{equation*}
    \mathcal{O} [[ X_1, \dotsc, X_{r^{\square}} \rrbracket \rightarrow R_{\bar{\rho}}^{\square},
  \end{equation*}
  and $r$, $r^{\square}$ are optimal.
\end{corollary}
What's the relevance of $H^2$?  Let $\varphi : A^1 \rightarrow A$ be a small extension, and let $I := \ker(\varphi)$.
\begin{question}\label{question:cq6thpebye}
  Is the map $D_{\bar{\rho}}(A') \rightarrow D_{\bar{\rho}}(A)$ surjective?
\end{question}
Let $\rho_A : G \rightarrow \mathrm{GL}_n(A)$ be as in the right hand side.
\begin{fact}\label{fact:cq6thpec2o}
  There exists a set-theoretic lift $\rho ' : G \rightarrow \mathrm{GL}_n(A')$ of $\rho_A$ (i.e., $\varphi \circ \rho ' = \rho_A$).
\end{fact}
\begin{definition}\label{definition:cq6thpeaqx}
  Set
  \begin{equation*}
    c_{\rho '} : G \times G \rightarrow \ad_{\bar{\rho}} \otimes_{\mathbb{F}} I,
  \end{equation*}
  \begin{equation*}
    (g, h) \mapsto(\rho '(g, h) \cdot \rho '(h)^{-1} \cdot \rho '(g)^{-1}),
  \end{equation*}
  where this last quantity lies in $1 + M_{n \times n}(I)$.  We note that $(\ad_{\bar{\rho}} \otimes_{\mathbb{F}} I) \cong M_{n \times n}(I)$.  To get back, subtract $1$.
\end{definition}
\begin{proposition}\label{proposition:cq6thpd7zv}
  \begin{enumerate}[(a)]
  \item\label{enumerate:cq6sknji3b} $c_{\rho '} \in Z^2(G, \ad_{\bar{\rho}} \otimes I)$, $\mathrm{Obs}(\rho_A, \varphi) =[ c_{\rho '} ] \in H^2(G, \ad_{\bar{\rho}} \otimes I)$ is independent of $\rho '$!
  \item\label{enumerate:cq6sknjiey} We have $\mathrm{Obs}(\rho_A, \varphi) = 0$ if and only if there exists $\rho_{A'} \in D_{\bar{\rho}}(A')$ lifting $\rho$.
  \end{enumerate}
\end{proposition}
We give a proof of \eqref{enumerate:cq6sknjiey}.  If $c_{\rho '} = \partial^2 f$ for some $f : G \rightarrow \ad_{\bar{\rho}} \otimes I$, then you can check that if you take your $\rho '$ and multiply it on the left with $1 + f$, we get an element $(1 + f) \rho ' : G \rightarrow \mathrm{GL}_n(A')$ that is a lift of $\rho_A$ (to $D_{\bar{\rho}}^{\square}(A')$).

Mazur observed that you can do something with this obstruction theory: you can prove something more about these projections on the top line here.  But you have a very coarse control over the kernel ideal $I$ of the surjection.
\begin{theorem}\label{theorem:cq6thpd9ja}
  Consider $\mathcal{R}  = \mathcal{O} [[  X_1, \dotsc, X_r \rrbracket$ projecting via something called $\pi$ to $R_{\bar{\rho}}$ ($r = h'(G, \ad_{\bar{\rho}} 1)$), with kernel $J$.  Then
  \begin{equation*}
    \mathcal{R} / \mathfrak{m}_{\mathcal{R}} J \rightarrow R_{\bar{\rho}}
  \end{equation*}
  is small with kernel $J / \mathfrak{m}_{\mathcal{R}} J$, and
  \begin{equation*}
    \mathrm{o b} : \Hom(J / \mathfrak{m}_R J, \mathbb{F}) \cong H^2(G, \ad_{\bar{\rho}}),
  \end{equation*}
  \begin{equation*}
    \psi \mapsto(1 \otimes \psi) \operatorname{o b s} \left( \rho_{\bar{\rho}}^{\mathrm{univ}}, \pi \right)
  \end{equation*}
  is injective!
\end{theorem}

\begin{corollary}\label{corollary:cq6thpd6nv}
  With $r, r^{\square}$ from above and $s = h^2(G, \ad_{\bar{\rho}})$ have presentations $R_{\bar{\rho}} := \mathcal{O} [[ x_1, \dotsc, x_{r^{\square}} ]] /(f_1, \dotsc, f_s)$.
\end{corollary}
\begin{definition}[ad hoc]\label{definition:cq6thpd4m6}
  The \emph{expected cohomological dimension} is
  \begin{equation*}
    \operatorname{e c d} \operatorname{i m}(\bar{\rho}) = z^1(G, \ad_{\bar{\rho}}) - h^2(G, \ad_{\bar{\rho}}) = h^2 - \sum_{i = 0}^2(-1)^{i} h^i(G, \ad \bar{\rho}). 
  \end{equation*}
\end{definition}
\begin{proposition}\label{proposition:cq6thpd5k9}
  If
  \begin{equation}\label{eq:cq6skreori}
    \dim_{\mathrm{\operatorname{s}}} R \frac{\square}{\rho} / \pi \leq \mathrm{ec dim(\bar{\rho})},
  \end{equation}
  then $R_{\bar{\rho}}^{\square}$ is $0$-flat, of relative dimension $\operatorname{e c dim}(\bar{\rho})$ over $\mathcal{O}$, and a complete intersection.
\end{proposition}
\begin{example}\label{example:cq6thpd1g4}
  \begin{enumerate}[(a)]
  \item $G = G_F$, where $F \supseteq \mathbb{Q}_{\ell}$ is finite and $\ell \neq p$.  Then \eqref{eq:cq6skreori} holds.  $\mathrm{e c dim} = 4^2$.
  \item $G = G_F$, $F \supseteq \mathbb{Q}_p$.  Then \eqref{eq:cq6skreori} holds and each $\operatorname{ec dim} = n^2(1 +[F : \mathbb{Q}_p])$.
  \item If $G = G_{K, S}$, then we have many examples for \eqref{eq:cq6skreori} if $k$ is not totally real, $k$ is totaly odd, and $\bar{\rho}$ is totally odd, and $n \geq 2$.  (Have to be careful.  Use that $S \supseteq S_\infty \cup S_p sup \dotsb$)
  \item We have
    \begin{equation*}
      \dim_{\mathrm{Krull}} R_{\bar{\rho}}^n / \pi \leq \operatorname{ecdim}(\bar{\rho})
    \end{equation*}
    for $G = G_{K, S}$, with $G$ and $G_{K, S}$, if and only if $\delta = 0$.
  \end{enumerate}
\end{example}
\begin{remark}\label{remark:cq6thpd214}
  To avoid the reliance on $\delta = 0$ (often) by fixing a lift $\mu : G \rightarrow \mathcal{O}^\times$.
\end{remark}

\emph{Mazur's vision}: for $v \in S$, define ``geometric'' subfunctors $D_v^{\square} \subseteq D_{\bar{\rho} / G_{K, v}}^{\square}$ and the pullback in $(\underline{S} =(\bar{\rho}, S,(D_v^0)_{v \in S}))$ to get a diagram involving, for $G = G_{k , S}$,
\begin{equation*}
  D_{\bar{\rho}}^{\square} \rightarrow \sqcup_{v \in S} D_{\bar{\rho} \mid G_v}^{\square}
\end{equation*}
and
\begin{equation*}
  D_{\underline{S}}^{\square} \rightarrow \sqcup_{v \in S} D_v^{\square}.
\end{equation*}

Removing frames at right point, we get a
\begin{equation*}
  R_{\mathcal{I}} \twoheadleftarrow R_{\bar{\rho}}.
\end{equation*}

\begin{question}\label{question:cq6thpc16r}
  Can we choose $\mathcal{I}$ in such a way that some natural map
  \begin{equation*}
    R_{\rho} \rightarrow \mathbb{T}_k(N, \eps, \mathcal{O})_{\mathfrak{m}_{\bar{\rho}}}
  \end{equation*}
  is an isomorphism?
\end{question}

We turn now to \emph{local deformation problems}.  How to get a more geometric side of deformation rings?  Fix
\begin{equation*}
  \bar{\rho} : G_{K, S} \rightarrow \mathrm{GL}_n(\mathbb{F}).
\end{equation*}
Write $\bar{\rho}_v := \bar{\rho} \mid_{G_v}$.  Fix a character $\mu : G_{K, S} \rightarrow \mathcal{O}^\times$ lifting $\det \bar{\rho}$.  Our next aim is to identify interesting special loci in
\begin{equation*}
  X_{\bar{\rho}_v}^{\square} := \Spec(R_{\bar{\rho}_v}^{\square}).
\end{equation*}
\begin{definition}[Thorne, who gave a compact description]\label{definition:cq6thpcze8}
  A \emph{local deformation problem} is a subfunctor $D_v \subseteq D_{\bar{\rho}_v}^{\square, \mu_v}$ (possibly with fixed determinant, i.e., $\det(\rho) = \mu$ -- that's what the superscripted $\mu_v$ means) such that
  \begin{enumerate}
  \item\label{enumerate:cq6s0pdihm} $D_v \cong F_{R_v}$ for a quotient $R_v$ of $R_{\bar{\rho}_v}^{\square, \mu}$.
  \item\label{enumerate:cq6s0pgpcr} For all $A \in \mathrm{CNL}_{\mathcal{O}}$ and $g \in \Gamma_n(A)$,
    \begin{equation*}
      \rho \in D_v(A) \implies g \rho g^{-1} \in D_v(A).
    \end{equation*}
  \end{enumerate}
\end{definition}
\begin{remark}
  $\Gamma_n(R_{\bar{\rho}_v^{\square}})$ acts by conjugation on $D_{\bar{\rho}_v}^{\square}(R_{\bar{\rho}_v}^{\square})$, and hence (by universality of $R_{\bar{\rho}_v}^{\square}$), it acts on $R_{\bar{\rho}_v}^{\square}$.
\end{remark}
\begin{proposition}[BLGHT, Potential Automorphy 2, Lemma 3.2]\label{proposition:cq6thpcxtk}
  Let $R_v$ be a quotient $R_{\bar{\rho}_v}^{\square, \mu} \xrightarrow{\alpha_v} R_v$ such that
  \begin{enumerate}[(a)]
  \item\label{enumerate:cq6s0pxwwm} $\ker(\alpha_v)$ is invariant under $\Gamma_n(R_{\bar{\rho}_v}^{\square})$, and
  \item\label{enumerate:cq6s0pxv8b} $R_v$ is reduced and not isomorphic to $\mathbb{F}$.
  \end{enumerate}
  Then $F_{R_v} \subseteq D_{\bar{\rho}_v}^{\square}$ is a local deformation problem.
\end{proposition}
\textbf{Construction of the} $R_v's$? \textbf{(Kisin)}: Let $X_v \subseteq X_{\bar{\rho}_v}^{\square}(\bar{\mathbb{Q}}_p)$ be $\Gamma_n(\bar{\mathbb{Q}}_p)$-invariant.  Each $x \in X_{\bar{\rho}_v}^{\square}(\bar{\mathbb{Q}}_p)$ gives a map
\begin{equation*}
  \rho_x : G_v \rightarrow \mathrm{GL}_n(\bar{\mathbb{Q}}_p),
\end{equation*}
and also
\begin{equation*}
  \alpha_x : R_{\bar{\rho}_v}^{\square} \rightarrow \bar{\mathbb{Q}}_p.
\end{equation*}
Then
\begin{equation*}
  J := \cap_{x \in X_v} \ker(\alpha_x)
\end{equation*}
is $\Gamma_n(R_{\bar{\rho}_v}^{\square})$-invariant.  (Need to check whether condition \eqref{enumerate:cq6s0pxv8b} above holds to get the local deformation problem, but at least there is a good starting point for something.)  You can define some
\begin{equation*}
  R_{X_v} := R_{\bar{\rho}_v}^{\square} / I.
\end{equation*}
Then $\Spec R_{X_v}$ ``is'' the schematic closure of $X_v$ in $X_{\bar{\rho}_v}^{\square}$.

For a classification of the $\rho : G_v \rightarrow \GL(V)$ with $V \simeq \bar{\mathbb{Q}}_p^n$, with $v \neq \infty$ and $\ell = \operatorname{char}(v) \neq p$, use the \textbf{Grothendieck monodromy theorem}.  Choose a surjection
\begin{equation*}
  t_p : I_v \rightarrow I_v^{\mathrm{tame}} \simeq \hat{\mathbb{Z}}^{(\ell)} \xrightarrow{\text{surj}} \mathbb{Z}_p.
\end{equation*}
\begin{enumerate}[(a)]
\item\label{enumerate:cq6s0sm0js} There is a unique $N = N_\rho \in \operatorname{End}_{\bar{\mathbb{Q}}_p}(V)$ and an open subgroup $I \subseteq I_v$ so that
  \begin{equation*}
    \rho \mid_I = \exp \left(
      t_p(\bullet) N
    \right) \mid_I.
  \end{equation*}
\item\label{enumerate:cq6s0sm7x5} For $N$ from \eqref{enumerate:cq6s0sm0js},
  \begin{equation*}
    r = r_\rho : I_v \rightarrow \mathrm{GL}(V),
  \end{equation*}
  \begin{equation*}
    g \mapsto \rho(g) \exp(- t_p(\bullet) N)
  \end{equation*}
  is a continuous representation with finite image.  Call
  \begin{equation*}
    \tau =(r, N) = \mathrm{W D}(\rho)
  \end{equation*}
  the (inertial) Galois type  of $\rho$.
\end{enumerate}
Let
\begin{equation*}
  X_\tau := \left\{ x \in X_{\bar{\rho}_v}^{\square}(\bar{\mathbb{Q}}_p) \mid \mathrm{WD}(\rho) \simeq \tau \right\}.
\end{equation*}
Note that
\begin{equation*}
  \# \left\{ \tau \mid \tau \text{ arises from } X_{\bar{\rho}_v}^{\square}(\bar{\mathbb{Q}}_p) \right\}_{/ \cong} 
  < \infty.
\end{equation*}
Define
\begin{equation*}
  R_{\bar{\rho}_v}^{\square, \tau} := R_{X_\tau} \twoheadleftarrow R_{\bar{\rho}_v}^{\square}.
\end{equation*}
\begin{theorem}[Sholton, Proposition 3.6]\label{theorem:cq6thpcsuh}
  \begin{enumerate}[(a)]
  \item\label{enumerate:cq6s0szq5l} $R_{\bar{\rho}_v}^{\square, \tau}$ defines a local deformation problem at $v$.
  \item\label{enumerate:cq6s0szrtp} $\Spec(R_{\bar{\rho}_v}^{\square, \tau})$ is a union of irreducible components of $X_{\bar{\rho}_v}^{\square}$, and equidimensional ($n^2$).
  \item\label{enumerate:cq6s0s13y6} $R_{\bar{\rho}_v}^{\square, \tau}[\tfrac{1}{p}]$ is reduced, contains a dense set of (generic) smooth points.
  \end{enumerate}
\end{theorem}
\textbf{Warning} (depending upon how much you are interested in singularities of schemes, or not): $R_{\bar{\rho}_v}^{\square}$ is a complete intersection, but the components $R_{\bar{\rho}_v}^{\square, \tau}$ can apparently have much worse singularieties -- they need not even be Cohen--Macaulay.

Let's say a bit about the case $v \mid p$, where things get a bit vaguer.  Now take $K_v \supseteq \mathbb{Q}_p$ finite, and consider the set of all representations
\begin{equation}\label{eq:cq6s0s7n4f}
  \left\{ \rho : G_v \rightarrow \mathrm{GL}_n(\bar{\mathbb{Q}}_p) \right\}.
\end{equation}
By $p$-adic Hodge theory, this contains the following set of representations that are ``geometric'' in some sense:
\begin{equation}\label{eq:cq6s0s8j3o}
  \left\{ \rho : G_v \rightarrow \mathrm{GL}_n(\bar{\mathbb{Q}}_p) \mid \rho \text{ is potentially semistable}\right\}.
\end{equation}
Fontaine attaches invariants to these $\rho$'s.  One thing he attaches is a Galois type
\begin{equation*}
  \operatorname{WD}(\rho) =(r_\rho, N_\rho),
\end{equation*}
although in a very different way than before: in this case, where $K_v$ is a $p$-adic field, the pro-$p$-part of the inertia is not this harmless $\mathbb{Z}_p$, but is instead a huge group that can be complicated, so one really needs to use $p$-adic Hodge theory to get something here.  Here, as before, $N_\rho$ is a nilpotent operator and $r_\rho : I_v \rightarrow \mathrm{GL}_n(\bar{\mathbb{Q}}_p)$ is a finite-dimensional representation.  Fontaine also attaches a set of Hodge--Tate weights
\begin{equation*}
  \nu = \underline{\mathrm{H T}}(\rho) = \left\{ \mathrm{H T}_{\iota} \right\}_{\iota : K_v \rightarrow \bar{\mathbb{Q}}_p}.
\end{equation*}
We attach some
\begin{equation*}
  X_{\tau, \nu} = \left\{ \rho : G_v \rightarrow \mathrm{GL}_n(\bar{\mathbb{Q}}_p) \text{ potentially semistable } \mid
    \operatorname{W D}(\rho) \simeq \tau,
    \,
    \underline{\operatorname{H T}}(\rho) = \nu
  \right\}.
\end{equation*}
Kisin then attaches potentially semistable deformation rings $R_{\bar{\rho}_v}^{\square, \tau, \nu}$.
\begin{remark}\label{remark:cq6thpcqah}
  If $n = 2$ and $K = \mathbb{Q}$, and if you somehow have $\mathrm{H T}$-weights $\nu =(k = 1, 0)$, $k$ ``small'', ($k \geq 2$),
  $\tau = (\mathrm{triv}, 0)$ (giving rise to $\rho$ crystalline), then
  \begin{equation*}
    R_{\bar{\rho}_p}^{\square, \nu, \tau} \simeq \mathcal{O} [[ X_1, \dotsc, X_5]].
  \end{equation*}
  (Alternative: use ordinary deformation rings.)
\end{remark}

\textbf{Global deformation rings}.  Fix $f \in S_k(N, \eps, \mathbb{F})$, take $E$ sufficiently large.  We get
\begin{equation*}
  \bar{\rho} : G_{\mathbb{Q}, N p \infty} \rightarrow \mathrm{GL}_2(\mathbb{F}).
\end{equation*}
We found
\begin{equation*}
  \mathfrak{m}_{\bar{\rho}} \leq \mathbb{T}_{\mathfrak{o}} \rightsquigarrow \rho_{\bar{\rho}}^{\mathrm{mod}} : G_{\mathbb{Q}, N p \infty}
  \rightarrow \mathrm{GL}_2 \left((\mathbb{T}_{\mathcal{O}})_{\mathfrak{m}_p} \right).
\end{equation*}
Now, for the ramified primes $\ell \mid N p$, local Langlands gives a list $T_{\ell}$ of Galois types that arise from (forms parametrized by) $(\mathbb{T}'_{\mathcal{O}})_{\mathfrak{m}_{\bar{\rho}}}$.  At $p$, you also get $\mathrm{H T}$-weights $(k - 1, 0)$ (papers of Faltings and of Saito).  From this dta, you now get a local deformation problem
\begin{equation*}
  D_{\ell} = D_{\bar{\rho}_{\ell}}^{\square, T_{\ell}} \subseteq D_{\bar{\rho}_{\ell}}^{\square}
  \quad \text{and} \quad
  D_{\bar{\rho}_p}^{\square, T_p, \nu}.
\end{equation*}
You form the pullback functor for a list
\begin{equation*}
  \underline{S} =(\bar{\rho}, N, S,(D_{\ell})_{\ell \mid N p}),
\end{equation*}
where $S$ is the divisor of $N p \infty$. (Let's suppose $p > 2$.)  Get a restriction from global to local:
\begin{equation*}
  D_{\bar{\rho}}^{\square, \mu}
  \xrightarrow{\res}
  \prod_{\ell \mid N p}
  D_{\bar{\rho}_{\ell}}^{\square, \mu}.
\end{equation*}

\begin{equation*}
  \begin{CD}         
    D_{\bar{\rho}}^{\square, \mu} @> \res>> \prod_{\ell \mid N p}
    D_{\bar{\rho}_{\ell}}^{\square, \mu}\\
    @AAA  @AAA \\
    D_{\underline{S}}    @>>> \prod_{\ell \mid N p} D_{\ell}\\
  \end{CD}
\end{equation*}
which gives rise to $R_{\underline{S}}$ as a quotient of $R_{\bar{\rho}}^{\square, \mu}$, with
\begin{equation*}
  \rho_{\underline{S}}^{\mathrm{univ}} : G_{\mathbb{Q}, N p \infty} \rightarrow \mathrm{GL}_2(R_{\underline{S}}).
\end{equation*}
Universality of $R_{\underline{S}}$ (using local Langlands and $p$-adic Hodge theory) gives a surjection
\begin{equation}\label{eq:cq6s0uhkx2}
  \alpha : R_{\underline{S}} \rightarrow(\mathbb{T}_{\mathcal{O}})_{\mathfrak{m}_{\bar{\rho}}},
\end{equation}
\emph{assuming} that $\bar{\rho}$ is absolutely irreducible.
\begin{conjecture}\label{conjecture:cq6thpclm1}
  $\alpha$ is an isomorphism under suitable hypothesis.
\end{conjecture}
The hope is that one can find a Galois-theoretic representation that completely describes this thing coming from automorphic representations.  This was all first put into some definite form by Wiles and Taylor--Wiles in their proof of Fermat's last theorem.  Their work gave the first great supply of such isomorphisms.  Then there was Breuil--Conrad--Diamond--Taylor, proving Taniyama--Shimura--Weil conjecture.  Then there was Clozel--Harris--Taylor, and Khare--Winterberger proving the Serre conjecture.  One thing about why this thing could be important, and why it was important in many of these cases.  What helps you sometimes is that being modular is ``contagious''.  What is often relatively easy, maybe if the representation (a $p$-adic Galois representation) comes from the ring on the left hand side of \eqref{eq:cq6s0uhkx2}, and now if you have the full isomorphism \eqref{eq:cq6s0uhkx2}, then you know it also comes form the right hand side.  But in practice, this isomoprhism doesn't tell you modularity of one just form in the class giving rise to the right hand side, but all of them.  That's all.







\section{Chris Skinner's lectures}\label{sec:cq6tho1vem}
\textbf{Integral representations, Euler systems, and multiplicity one}.

My choice of these topics is motivated by my interest in special values of $L$-functions, and in particular problems like the BSD conjecture.  We'll focus on some representation theory, that plays a role in both the analytic and the algebraic sides of these problems.  You can possibly view this as a bridge between the talks at the start and at the end of the week.

Let's start by talking about \emph{integral representations}.  It's helpful to think
\begin{equation*}
  \text{$L$-function} =
  \int_{\text{symmetric space } X}
  (\text{automorphic form}),
\end{equation*}
where perhaps the automorphic form starts on some larger symmetric space $Y \supseteq X$.  This is useful because it's our main tool for studying $L$-functions.

The next part of my title is \emph{Euler systems}.  This is going to seem like something different.  What are Euler systems?  One starts off with a continuous action
\begin{equation*}
  G_k = \Gal(\bar{k} / k) \circlearrowright V,
\end{equation*}
where $V$ is a $\mathbb{Q}_p$-space of finite dimension (with $\mathbb{Q}_p$ acting linearly and continuously).  At least conjecturally, there's a fairly general framework for producing such $V$ from automorphic forms or representations.  This Galois representation captures something about the automorphic form that can be expressed in terms of the $L$-function.  All of these things are thus related to one another, even if they are frequently encountered separately.  Here $V$ often stabilizes in a $\mathbb{Z}_p$-submodule (lattice), which might yield a good exercise for later.  An Euler system is a collection of classes in Galois cohomology $c_F \in H^1(F, T)$, where $F / k$ are certain abelian extensions of $k$ satisfying certain compatibilities: for $F' \supseteq F$,
\begin{equation*}
  \operatorname{cores}_{F' / F}(c_{F '}) = ? c_F,
\end{equation*}
where $?$ often seems the local Euler factors of $V$ (or some $L$-function attached to $V$, depending upon the setting).

Both of these settings have been useful for exploring special values of $L$-functions (Kolyvagin, Gross--Zagier, ...).  What we'll focus on in these lectures is the role that multiplicity one plays in seeing these $L$-functions and in producing these Euler systems.  We'll see that they essentially play the same role, which is further evidence for what people say, to the effect that Euler systems are some sort of algebraic incarnation of $L$-functions.

What do we mean by ``multiplicity one''?  One frequently encounters this term in the theory of automorphic forms, in various guises:
\begin{enumerate}
\item\label{enumerate:cq6r3ndbhy} Uniqueness of a representation in some space of functions, e.g.:
  \begin{enumerate}[(a)]
  \item\label{enumerate:cq6r3m96yd} A cuspidal automorphic representation of $\mathrm{GL}_2$ shows up with multiplicity one $L^2(\mathrm{GL}_2(k) \backslash \mathrm{GL}_2(\mathbb{A}_k))$.
  \item\label{enumerate:cq6r3m98gf} Uniqueness of (local) Whittaker models for $\mathrm{GL}_2$.
  \end{enumerate}
\item\label{enumerate:cq6r3ndama} Uniqueness of some (invariant) linear functional: for $H \leq G$ and $\pi$ a representation of $G$,
  \begin{equation*}
    \dim \Hom_H(\pi, \mathbb{C}) \leq 1.
  \end{equation*}
  Or, for $\sigma$ a representation of $H$, as the assertion that $\dim \Hom_H(\pi, \sigma) \leq 1$.
\end{enumerate}
The first examples can be understood in terms of the latter.  The latter will be a useful framework for us.

Let's now turn to integral representations and give some examples.  The first integral representation we see is that of the Riemann zeta function.  Let
\begin{equation}\label{eq:cq6r3qe33m}
  \psi(t) = \sum_{n = 1}^\infty e^{- \pi n^2 t}.
\end{equation}
Then for $\Re s$ sufficiently large,
\begin{equation}\label{eq:cq6r3p0tmc}
  \int_0^\infty \psi(t) t^{\frac{1}{2} s - 1} \, d t
  = \pi^{- s/2} \Gamma(\tfrac{s}{2}) \zeta(s).
\end{equation}
We see this by bringing the summation outside the integral.  This gives a Mellin transform.

What's the automorphic side of this?  If we look at, for $\tau = x + i y$,
\begin{equation*}
  \theta(\tau) = \sum_{n \in \mathbb{Z}} e^{- 2 \pi i n^2 \tau}.
\end{equation*}
This is an automorphic form, and we have
\begin{equation*}
  (\tfrac{1}{2}(\theta(i y) - 1)) = \psi(2 y),
\end{equation*}
so \eqref{eq:cq6r3p0tmc} is an integral representation for the Riemann zeta function coming from the symmetric space for a torus embedded inside $\mathrm{GL}_2$.  One has similar integral representations for the Dirichlet $L$-functions.  (No multiplicity one that we can see thus far.)

This gets souped up in the work of Hecke and Iwasawa--Tate, which inspired how automorphic $L$-functions have been studied subsequently.  Let's recall how that goes.  Let $k$ be a number field.  We have the adeles $\mathbb{A}_k$ and the ideles $\mathbb{A}_k^\times$.  We have a Hecke character
\begin{equation*}
  \chi : k^\times \backslash \mathbb{A}_k^\times \rightarrow \mathbb{C}^\times,
\end{equation*}
which factors as a product $\chi = \prod \chi_v$ of characters $\chi_v : k_v^\times \rightarrow \mathbb{C}^\times$ indexed by the places $v$ of $k$.  (This is of course very useful, but is specific for $\mathrm{GL}_1$, and so obscures some of the more general features.)  Let $\phi \in \mathcal{S}(\mathbb{A})$ be a Schwartz function, which could also be a product $\phi = \prod \phi_v$ of local Schwartz functions $\phi_v \in \mathcal{S}(k_v)$.  We recall that this means that
\begin{itemize}
\item when $v$ is finite, $\phi_v$ is smooth and compactly-supported, and
\item when $v$ is archimedean, all derivatives decay faster than any polynomial, e.g., $e^{- \pi t^2}$.
\end{itemize}
Furthermore, $\phi_v = 1_{\mathcal{O}_{k_v}}$ for almost all finite $v$.  We then form
\begin{equation*}
  \theta(x) = \sum_{\alpha \in k} \phi(\alpha x).
\end{equation*}
(It's a good exercise to see how to specialize this to obtain something like \eqref{eq:cq6r3qe33m}.)  We then form the integral
\begin{equation*}
  \int_{k^\times \backslash \mathbb{A}_k^\times} \chi(x) \lvert x \rvert^s \theta(x) \,d^\times x.
\end{equation*}
These integrals converge absolutely for $\Re s$ sufficiently large and unfold in the usual way, giving
(at least for $\chi$ not a power of the absolute value, so that we don't need to worry about the contribution of $\alpha = 0$)
\begin{equation*}
  \int_{\mathbb{A}_k^\times} \chi(x) \lvert x \rvert^s \phi(x) \, d x.
\end{equation*}
If $\phi = \prod \phi_v$, then these factor further as
\begin{equation}\label{eq:cq6r32qpe5}
  \prod \int_{k_v^\times} \chi_v(x) \lvert x \rvert_v^s \phi_v(x) \, d x.
\end{equation}
One can show that the local integrals at non-archimedean places are rational functions, form the greatest common divisor of their denominators, and this turns out to be the way you can define the local $L$-function.  This is Tate's thesis.  We haven't yet really made any reference to multiplicity one.  This shows up when you try to generalize to other settings.

We may think of $\mathbb{A}_k^\times$ as $\mathrm{GL}_1(\mathbb{A}_k)$.  Let's now consider $\mathrm{GL}_n(\mathbb{A}_k)$.  We discuss Godement--Jacquet theory, which is a generalization of what Tate did to $\mathrm{GL}_n$.  Let $\pi$ be a cuspidal automorphic representation (by convention, irreducible).  Abstractly, this is isomorphic to a restricted tensor product $\otimes \pi_v$ of irreducible local representations $\pi_v$ of $\mathrm{GL}_n(k_v)$.  We can thus identify an element $\varphi \in \pi$ with a sum of tensor products of vectors (although, unlike in the case of characters, it will not pointwise be a product of local functions).  Now, mimicking what was done before, we take a Schwartz function $\phi \in \mathcal{S}(M_n(\mathbb{A}_k))$, and form a theta function
\begin{equation*}
  \theta(x)
  =
  \sum_{\alpha \in M_n(k)}
  \phi(\alpha x).
\end{equation*}
We then form
\begin{equation*}
  \int_{\mathrm{GL}_n(k) \backslash \mathrm{GL}_n(\mathbb{A}_k)}
  \varphi(x) \lvert \det(x) \rvert^s \theta(x) \,d^\times x.
\end{equation*}
This unfolds to
\begin{equation*}
  \int_{\mathrm{GL}_n(\mathbb{A})} \varphi(x) \lvert \det x \rvert^s \phi(x) \, d^\times x.
\end{equation*}
But does it factor?  Not obviously.

Let's now form
\begin{equation*}
  \theta(h, g) = \sum_{\alpha \in M_n(k)} \phi(h^{-1} \alpha g)
\end{equation*}
and consider
\begin{equation*}
  \int_{[\mathrm{GL}_n]} \varphi(g) \lvert \det g \rvert^s \theta(h, g) \, d g.
\end{equation*}
This is now automorphic as a function of $h$, so we can decompose it with respect to the automorphic spectrum.  To compute the coefficients in that decomposition, we consider, for $\tilde{\varphi}$ in the contragredient (or dual) $\tilde{\pi}$ of $\pi$, the iterated integral
\begin{equation*}
  \int_{[\mathrm{GL}_n^1]}
  \left(  \int_{[\mathrm{GL}_n]} \varphi(g) \lvert \det g \rvert^s \theta(h, g) \, d g \right)
  \tilde{\varphi}(h) \, d h,
\end{equation*}
where $\mathrm{GL}_n^1$ means either that we mod out by the center or that we restrict to $\lvert \det \rvert = 1$.  Then, reordering terms and unfolding, we obtain
\begin{equation*}
  \int_{\mathrm{GL}_n(\mathbb{A})} \phi(g) \lvert \det g \rvert^s
  \left( \int_{[\mathrm{GL}_n^1]} \tilde{\varphi}(h)
    \varphi(h g) \,d h
  \right) \, d g.
\end{equation*}
We can understand the parenthetical inner integral as
\begin{equation*}
  \langle \tilde{\varphi}, \pi(g) \varphi \rangle,
\end{equation*}
where
\begin{equation*}
  \langle \varphi_1, \varphi_2 \rangle = \int_{[\mathrm{GL}_n^1]} \varphi_1(h) \varphi_2(h) \, d h.
\end{equation*}
This pairing defines a $G$-invariant functional $\langle , \rangle :  \tilde{\pi} \times \pi \rightarrow \mathbb{C}$, which is locally unique, hence factors as a product of local invariant functionals $\langle , \rangle_v : \tilde{\pi}_v \times \pi_v \rightarrow \mathbb{C}$, thus
\begin{equation*}
  \langle , \rangle =(\ast) \prod_v \langle , \rangle_v.
\end{equation*}
The leading constant $(\ast)$ will depend upon our normalizations of the local and global integrals, and our normalization of the comparison between $\pi$ and $\otimes \pi_v$.

This is the first example where multiplicity one shows up in what we've discussed.  In the afternoon talk, we'll very quickly describe a few other automorphic $L$-function settings where we see multiplicity one, and then start to move to the Euler system side of things.

\textbf{Afternoon talk}.

Factoring the integral is only one step towards understanding the $L$-functions.  The next thing one needs to do is to compute these local integrals.  This of course seems more tractable than working globally, which is the point.  For instance, in the Iwasawa--Tate setting, when all of the data is unramified (meaning $\chi_v$ is an unramified character and $\phi_v$ is the characteristic function of the ring of integers), then the local factor in \eqref{eq:cq6r32qpe5} is easy to compute, and gives a local zeta function.  This is more complicated in the Godement--Jacquet setting, but still doable.  Then in the ramified situations, there is the question of how to choose good vectors so that one gets the $L$-function on the nose.  This is useful for many of the applications that the speaker makes of these kinds of functions.  In some settings it's still much of an art and there are lots of interesting questions.

Let's turn to Rankin--Selberg convolutions.  We'll begin classically, say with holomorphic modular eigenforms $f$ and $g$ of weights $k_f \geq k_g$, say of level $1$, i.e., on $\mathrm{SL}_2(\mathbb{Z})$.  Write
\begin{equation*}
  f = \sum a_n q^n, \qquad g = \sum b_n q^n.
\end{equation*}
We'll consider the Dirichlet series
\begin{equation}\label{eq:cq6r32z05j}
  \sum_n \overline{a_n} b_n n^{- s}.
\end{equation}
The integral representation is
\begin{equation}\label{eq:cq6r32zyac}
  \int_{\mathrm{SL}_2(\mathbb{Z}) \backslash \mathbb{H}} \overline{f(\tau)} g(\tau)
  E_k(\tau, s)
  y^{k_f}
  \, d \vol(\tau),
\end{equation}
where $k := k_f - k_g$ and
\begin{equation}\label{eq:cq6r320zyb}
  E_k(\tau, s)
  := \sum_{\gamma \in
    \begin{pmatrix}
      \ast      & \ast \\
      0             & \ast \\
    \end{pmatrix} \backslash \mathrm{SL}_2(\mathbb{Z})}
  j(\gamma, \tau)^{- k} \lvert y(\gamma(\tau)) \rvert^k.
\end{equation}
The way you get from \eqref{eq:cq6r32zyac} to \eqref{eq:cq6r32z05j} is to unfold the sum in \eqref{eq:cq6r320zyb} with the integral in \eqref{eq:cq6r32zyac}, which yields an integral over $
\begin{pmatrix}
  \ast  & \ast \\
  0     & \ast \\
\end{pmatrix} \backslash \mathbb{H}$.  This is a nice exercise if you haven't done it.

What does this have to do with multiplicity one?  Maybe we try to set this up a bit more automorphically.  Let $\pi_1$ and $\pi_2$ be cuspidal automorphic representations of $\mathrm{GL}_2(\mathbb{A}_k)$.  Let $\chi_1, \chi_2$ be Hecke characters $\chi_i : k^\times \backslash \mathbb{A}_k^\times \rightarrow \mathbb{C}$ such that $\chi_1 \chi_2 =(\chi_{\pi_1} \chi_{\pi_2})^{-1}$.  Let $I_s(\chi_1, \chi_2)$ denote the space of functions $f : \mathrm{GL}_2(\mathbb{A}) \rightarrow \mathbb{C}$ that are smooth (meaning the usual thing at archimedean places and ``fixed by an open subgroup'' at finite places) and ``$K$-finite'' and satisfying
\begin{equation*}
  f_s \left(
    \begin{pmatrix}
      a & b \\
      0 & d \\
    \end{pmatrix} g \right) =
  \chi_1(a) \chi_2(d)
  \left\lvert \frac{a}{d} \right\rvert^{s + \frac{1}{2}}
  f_s(g).
\end{equation*}
We then define an Eisenstein series by averaging:
\begin{equation*}
  E(f_s, g) := \sum_{\gamma \in B(\mathbb{Q}) \backslash \mathrm{GL}_2(\mathbb{Q})} f_s(\gamma g).
\end{equation*}
The Rankin--Selberg integral is now just the integral
\begin{equation*}
  \int_{[\mathrm{GL}_2]} \varphi_1(g) \varphi_2(g) E(f_s, g) \, d g.
\end{equation*}
We can unfold this to obtain
\begin{equation*}
  \int_{Z(\mathbb{A})B(\mathbb{Q}) \backslash \mathrm{GL}_2(\mathbb{A})} \varphi_1(g) \varphi_2(g) f_s(g) \, d g.
\end{equation*}
Let's replace $\varphi_i$ by its Whittaker expansion
\begin{equation*}
  \varphi_1(g) = \sum_{a \in k^\times} W_{\psi} \left(
    \begin{pmatrix}
      a      &  \\
             & 1 \\
    \end{pmatrix} g \right).
\end{equation*}
Then, unfolding a bit further, we arrive at
\begin{equation*}
  \int_{Z(\mathbb{A}) N(\mathbb{A}) \backslash \mathrm{GL}_2(\mathbb{A})} W_{\psi}(g) \varphi_2(g) f_s(g) \, d g
  =
  \int_{Z(\mathbb{A}) N(\mathbb{A}) \backslash \mathrm{GL}_2(\mathbb{A})}
  W_\psi(g) W_{\bar{\psi}} '(g) f_s(g) \, d g,
\end{equation*}
where $W_{\psi}'$ is the Whittaker function for $\varphi_2$ with respect to the conjugate character.  This last integrand is a product of local functions, so the integral factors, assuming that all vectors in our representations are pure tensors.

Where's the multiplicity one?  It's hidden, because, just like in the case of $\mathrm{GL}_1$ characters, we have taken for one of our automorphic forms something particularly special, namely an Eisenstein series.  The picture that might be better is, to give something slightly more complicated, there's something called the \textbf{triple product integral}.  Now we'll take $\varphi_i \in \pi_i$ for $i = 1, 2, 3$, where it'll be slightly simpler to assume that at least one is cuspidal.  Look at the function
\begin{equation*}
  \int_{[Z \backslash \mathrm{GL}_2]}
  \varphi_1(g) \varphi_2(g) \varphi_3(g) \, d g.
\end{equation*}
This integral defines a trilinear form on the product of the three representations that is invariant by the diagonal action of $\mathrm{GL}_2(\mathbb{A})$, or equivalently, a $\mathrm{GL}_2(\mathbb{A})$-invariant functional $\Lambda$ on the tensor product $\pi_1 \otimes \pi_2 \otimes \pi_3$, i.e, an element
\begin{equation*}
  \Lambda \in \Hom_{\mathrm{GL}_2(\mathbb{A})}(\pi_1 \otimes \pi_2 \otimes \pi_3, \mathbb{C}).
\end{equation*}
This space is one-dimensional, as are its local avatars:
\begin{equation*}
  \dim \Hom_{\mathrm{GL}_2(k_v)}(\pi_{1, v} \otimes \pi_{2, v} \otimes \pi_{3, v}) \leq 1.
\end{equation*}
We can thus factor $\Lambda = \prod \Lambda_v$, where each $\Lambda_v \in \Hom_{\mathrm{GL}_2(k_v)}(\pi_{1, v} \otimes \pi_{2, v} \otimes \pi_{3, v})$.  Suppose $v$ is a place for which $\pi_{i, v}$ is unramified for each $i$.  Then we can take
\begin{equation*}
  \Lambda_v =
  \int_{Z N(k_v) \backslash \mathrm{GL}_2(k_v)}
  W_{\psi_v} W_{\overline{\psi_v}}(g) f_v(g) \, d g.
\end{equation*}
Here, locally, we're realizing the unramified representation $\pi_{3, v}$ as an induced representation $\pi_{3, v} = \pi_v(\chi_{1, v}, \chi_{2, v})$.  We didn't unfold to this computation; this was all local.

There's one more example we'd like to emphasize: \emph{toric integrals}.  Let $K /k$ be a quadratic extension.  We can then think of $K$ as a two-dimensional $k$-space, which gives a way to identify
\begin{equation*}
  {\mathrm{GL}_2}{/ k} \cong \Aut_k(K) \hookleftarrow K^\times.
\end{equation*}
We might for simplicity that $\pi$ is a cuspidal automorphic representation of $\mathrm{GL}_2(\mathbb{A}_k)$, and let $\varphi \in \pi$ be a cusp form.  Let $\chi : K^\times \backslash \mathbb{A}_{K}^\times \rightarrow \mathbb{C}^\times$ be a Hecke character for our extension.  Let's assume that $\chi \mid_{\mathbb{A}_k^\times} = \chi_\pi^{-1}$, i.e., the restriction is the inverse of the central character.  We are then going to think of the integral
\begin{equation*}
  \int_{\mathbb{A}_k^\times K^\times \backslash \mathbb{A}_K^\times} \varphi(t) \chi(t) \,d^\times t
\end{equation*}
as defining an element of the space $\Hom_{\mathbb{A}_k^\times}(\pi, \mathbb{C}(\chi^{-1}))$, which has dimensional $\leq 1$.  Such integrals will thus factor as prodcuts of local linear functionals.

Some of these can be computed quickly in terms of integrals we already know.  Suppose $\pi_v$ is unramified and $v$ splits in $K /k$.  Then
\begin{equation*}
  K_v^\times = k_v^\times \times k_v^\times \cong \left\{
    \begin{pmatrix}
      a      &  \\
                                                                              & b \\
    \end{pmatrix} \right\} \subseteq \mathrm{GL}_2(k).
\end{equation*}
We may thus identify $\chi_v$ with a pair of characters $(\chi_{1, v}, \chi_{2, v})$.  We can define the local functional
\begin{equation*}
  \int_{k_v^\times} W_\psi
  \begin{pmatrix}
    t    &  \\
                                                                      & 1 \\
  \end{pmatrix} \chi_{1, v}(t) \,d^\times t,
\end{equation*}
which defines an element of $\Hom_{K_v^\times}(\pi_v, \mathbb{C}(\chi_v^{-1}))$.  For unramified data, this evaluates to $L(\pi_v, \chi_{1, v})$.  It turns out that (Waldspurger's formula)
\begin{equation*}
  \left\lvert \int \varphi(t) \chi(t) \,d^\times y \right\rvert^2 \sim L(\mathrm{B C}_{K/k}(\pi) \otimes \chi, \tfrac{1}{2}).
\end{equation*}
There's a similar relation in the triple product case, which we can guess using the Rankin--Selberg unfolding that we saw earlier.

\begin{remark}\label{remark:cq6thpb6e1}
  This doesn't make sense for general arguments other than $s = \tfrac{1}{2}$, except in some form when $\varphi$ is an Eisenstein series (``formula of Damerell'').  One needs to be able to vary $\varphi$ (or $\chi$) in a family, preserving the central character compatibility condition.
\end{remark}

All of these examples are special cases of the Gan--Gross--Prasad conjectures, which we'll hear more about later in the week.

We'll now begin by giving one example of an Euler system.  Tomorrow, we'll explore this in greater generality and more detail.  The simplest case is that of cyclotomic units.  Let $F$ be a number field or a local field.  Kummer theory gives an isomorphism
\begin{equation*}
  F^\times / F^{\times N} \rightarrow H^1(F, \mu_N),
\end{equation*}
as follows.  Let $\alpha \in F^\times$.  Choose an $n$th root $\alpha^{1/N}$.  The ambiguity in this choice is an element of $\mu_N$, i.e., an $n$th root of unity.  For any $\sigma \in G_F$, we can look at $\sigma(\alpha^{1/N}) / \alpha^{1/N}$.  Since the numerator and denominator are both $N$th roots of $1$, the ratio must lie in $\mu_N$.  This gives us a way of constructing elements of $H^1$ very concretely.  The classes we obtain are unramified away from $N \alpha$.

Let's now restrict ourselves to the field $\mathbb{Q}[\mu_N]$.  Restrict the above map to the unit group of that field:
\begin{equation*}
  \mathcal{O}_{\mathbb{Q}[\mu_N]}^\times \rightarrow H^1(\mathbb{Q}(\mu_N), \mu_{p^n}).
\end{equation*}
Taking inverse limits, we obtain, with $\mathbb{Z}_p(1) = \varprojlim\mu_{p^n}$ (where the Galois group acts via the cyclotomic character), a map
\begin{equation*}
  \mathcal{O}_{\mathbb{Q}[\mu_N]}^\times \otimes \mathbb{Z}_p \rightarrow H^1(\mathbb{Q}(\mu_N), \mathbb{Z}_p(1)).
\end{equation*}
Thus, for any $(a, N) = 1$, we get , say with $\zeta_N = e^{2 \pi i / N}$,
\begin{equation*}
  \frac{\zeta_N^a - 1}{\zeta_N - 1} \mapsto z_N,
\end{equation*}
say.  If we look at the corestriction
\begin{equation*}
  \operatorname{cores}_{\mathbb{Q}[\mu_{N \ell}] / \mathbb{Q}[\mu_N]}(z_{N \ell}) =
  \begin{cases}
    z_N    
    & \text{ if } \ell \mid N \\
    (1 - \mathrm{Fr}_{\ell}^{-1}) z_N
                                                                                     & \text{ if } \ell \nmid N.
  \end{cases}
\end{equation*}
We look at
\begin{equation*}
  \det \left( 1 - \mathrm{Fr}_{\ell}^{-1} X \mid \mathbb{Z}_p(1)^\ast \right) \mid X = \mathrm{Fr}_{\ell}^{-1}.
\end{equation*}


Some idea for checking this: $(\mathbb{Z} / \ell \mathbb{Z})^\times \subset(\mathbb{Z} / \ell N \mathbb{Z})^\times \cong \Gal(\mathbb{Q}(\mu_{N \ell}) / \mathbb{Q} )$, where the last map sends $a \mapsto \sigma_\alpha(\zeta_{N \ell}) = \zeta_{N \ell}^a$.

\begin{remark}\label{remark:cq6thpb27e}
  Given $f$ a holomorphic modular form, say of weight $2$, we have $\omega_f = f(\tau) \, d \tau \in H^0(X, \Omega_X^1) \subseteq H^1(X, \mathbb{C})$.  Then $\lVert f \rVert^2 = \int_X\omega_f \wedge \overline{\omega_f}$.

  Similarly, for $X \hookrightarrow X \times X \times X$, we get some particular values of the Rankin--Selberg convolution by looking at $\int_X \overline{\omega_f} \wedge \omega_g \wedge \omega_{E_k}$.  Then from the rational structure on cohomology, one can get something like rational structure on the $L$-values.
\end{remark}

\begin{remark}\label{remark:cq6thpb14c}
  Let's talk about the corestriction map in this setting.  Abstractly, it's a map
  \begin{equation*}
    H^1(\mathbb{Q}[\mu_{N \ell}], \mathbb{Z}_p(1)) \rightarrow H^1(\mathbb{Q}[\mu_N], \mathbb{Z}_p(1)).
  \end{equation*}
  How are we going to understand this?  We could of course write it down at the level of cocycles, or something.  But what's it's really doing is that if we restrict back, i.e., compose with the restriction map
  \begin{equation}\label{eq:cq6r4knx6r}
    H^1(\mathbb{Q}[\mu_N], \mathbb{Z}_p(1)) \rightarrow H^1(\mathbb{Q}[\mu_{N \ell}], \mathbb{Z}_p(1)),
  \end{equation}
  then the composition is just the trace map, given by
  \begin{equation*}
    \sum_{\sigma \in \Gal(\mathbb{Q}[\mu_{N \ell}] / \mathbb{Q}[\mu_N])} \sigma.
  \end{equation*}
  The restriction map \eqref{eq:cq6r4knx6r} is actually an injection because there are no Galois invariants of $\mathbb{Z}_p(1)$.

  Also, we have the Kummer map
  \begin{equation*}
    \mathbb{Q}[\mu_{N \ell}]^\times \xrightarrow{\mathrm{Kummer}} H^1(\mathbb{Q}[\mu_{N \ell}], \mathbb{Z}_p(1)).
  \end{equation*}
  And this construction is Galois-invariant.  We have the trace map $\alpha \mapsto \prod_\sigma \sigma(\alpha)$ from $\mathbb{Q}[\mu_{N \ell}]^\times \rightarrow \mathbb{Q}[\mu_N]^\times$.  We claim that this induces the corestriction map via the Kummer map.  This remains the case when we tensor with $\mathbb{Z}_p$.

  So when we're dealing with corestriction, what we really want to understand is what is the norm of the particular $\alpha$ that we're working with.

  All of this is fairly formal applied to a specific setting.  The Kummer map is also a connecting map in a long exact sequence of Galois cohomology, associated to
  \begin{equation*}
    0 \rightarrow \mu_{p^n} \rightarrow \bar{F}^\times \xrightarrow{\alpha \mapsto \alpha^{p^n}} \bar{F}^\times \rightarrow 0.
  \end{equation*}
  From the formal stuff, we have an arithmetic question.  We take
  \begin{equation*}
    \alpha = \frac{\zeta_{N \ell}^a - 1}{\zeta_{N \ell} - 1},
  \end{equation*}
  and we want to know, what is the norm of this element?  Look at
  \begin{equation*}
    \operatorname{norm}_{\mathbb{Q}(\mu_{N \ell}) / \mathbb{Q}(\mu_N)}(\alpha).
  \end{equation*}
  We have
  \begin{equation*}
    \Gal(\mathbb{Q}(\mu_{N \ell}) / \mathbb{Q}(\mu_N))
    \subseteq \Gal(\mathbb{Q}(\mu_{N \ell}) / \mathbb{Q})
    \cong(\mathbb{Z} / N \ell)^\times,
  \end{equation*}
  The subgroup here will be identified with congruence classes $b$ satisfying $b \equiv 1 \pmod{N}$.  The last isomorphism is given by $\sigma_c \mapsto c$, where $\sigma_c(\zeta_{N \ell}) = \zeta_{N \ell}^c$.  Now, suppose for instance that $\ell \nmid N$.  Then $\zeta_{N \ell}^{b \ell} = \zeta_N^b = \zeta_N$.  As $b \in(\mathbb{Z} / N \ell )^\times$ runs over $\ell - 1$ residue classes modulo $\equiv 1 \pmod{N}$, then $\zeta_{N \ell}^b$ runs over $\ell$th roots of $\zeta_N$, but excluding $\zeta_N^{\ell^{-1}}$.  A short calculation then gives the claim corestriction formula.  In the other case where $\ell \mid N$, $b$ runs over $\ell$ classes, and we get the other answer.
\end{remark}

We're going to continue our discussion of Euler systems.  We turn to the example given by Heegner points.  Let $K / \mathbb{Q}$ be an imaginary quadratic field, with ring of integers $\mathcal{O}_K$.  Let $N$ be a positive integer such that all primes $\ell \mid N$ split in $K /\mathbb{Q}$.  We take
\begin{equation*}
  X_0(N) = \Gamma_0(N) \backslash[\mathfrak{h} \sqcup \mathbb{P}^1(\mathbb{Q})],
\end{equation*}
and write $\tau \in \mathfrak{h}$.  This classifies elliptic curves together with an isogeny of order $N$, e.g.,
\begin{equation*}
  E := \mathbb{C} / \mathbb{Z} \oplus \mathbb{Z} \tau \rightarrow E' :=  \mathbb{C} / \tfrac{1}{N}(\mathbb{Z} + N \tau \mathbb{Z}) \cong \mathbb{C} / \mathbb{Z} + N \tau \mathbb{Z},
\end{equation*}
whose kernel is $\tfrac{1}{N} \mathbb{Z} / \mathbb{Z}$.

We're going to produce some points on $X_0(N)$.  Let $c$ be positive integer.  We can have an order
\begin{equation*}
  \mathcal{O}_c := \mathbb{Z} + c \mathcal{O}_K \subseteq \mathcal{O}_K.
\end{equation*}
This gives us a lattice inside the complex numbers (having chosen a complex embedding of $K$).  We can then form the quotient $\mathbb{C} / \mathcal{O}_c$.  To produce a lattice that is slightly larger, we will use that each $\ell \mid N$ splits to \emph{choose} an ideal $\mathfrak{n} \subseteq \mathcal{O}_K$ such that $\mathcal{O}_K / \mathfrak{n} \cong \mathbb{Z} / N \mathbb{Z}$.  We then obtain an isogeny of elliptic curves
\begin{equation*}
  \left[ \mathbb{C} / \mathcal{O}_c \rightarrow \mathbb{C} / \mathfrak{n}^{-1} \mathcal{O}_c \right] \in X_0(N)(K[c]),
\end{equation*}
where $K[c]$ denotes the \emph{ring class field} of $K$ of conductor $c$.  To explain what this means, we introduce some notation.  For a module $M$, write $\hat{M} := M \otimes \hat{\mathbb{Z}}$, where $\hat{\mathbb{Z}} = \prod_{\ell} \mathbb{Z}_{\ell}$.  (For instance, if $M$ is a $\mathbb{Q}$-module, then we may also write $\hat{M}$ as $M \otimes_{\mathbb{Q}} \mathbb{A}_f$.)  Class field theory tells us that
\begin{equation*}
  \Pic(\mathcal{O}_c) = K^\times \backslash \hat{K}^\times / \hat{\mathcal{O}}_c^\times \xrightarrow{\mathrm{rec}} \Gal(K[c] / K),
\end{equation*}
\begin{equation*}
  [\mathfrak{b}] \mapsto \sigma_{\mathfrak{b}}.
\end{equation*}
More generally, for any fractional ideal $\mathfrak{a}$ of $\mathcal{O}_c$, we get a point
\begin{equation*}
  x_{c}(\mathfrak{a}) := \left[ \mathbb{C} / \mathfrak{a} \rightarrow \mathbb{C} / \mathfrak{n}^{-1} \mathfrak{a} \right] \in X_0(N)(K[c]).
\end{equation*}
The action of $\Gal(K[c] / K)$ on $X_0(N)(K[c])$ on these points is described by the relation
\begin{equation}\label{eq:cq6sjz7g2n}
  \sigma_{\mathfrak{b}} x_c(\mathfrak{a}) = x_c(\mathfrak{b}^{-1} \mathfrak{a}).
\end{equation}
This is the content of CM theory.

Now we're going to look at the divisors
\begin{equation*}
  y_c(\mathfrak{a}) := x_c(\mathfrak{a}) - \infty
\end{equation*}
obtained by subtracting off the cusp at infinity, which is defined over $\mathbb{Q}$.  This difference defines an element of the Jacobian $J_0(N) := \Jac(X_0(N))$, defined over $K[c]$.  The Jacobian is an abelian variety.  For abelian varieties, there is a construction very similar to Kummer theory that gives us an analogue of the Kummer map defined yesterday,
\begin{equation*}
  J_0(N)(K[c]) \rightarrow H^1(K[c], J_0(N)[p^m]),
\end{equation*}
where $J_0(N)[p^m]$ is the $p^m$-torsion subgroup of the Jacobian.  The map is defined as follows.  Given $y \in J_0(N)(K[c])$, let us choose $y '$ so that $p^m y' = y$.  We send this to the class of the cocycle $\sigma \mapsto \sigma(y') - y'$.  Applying this map to  $y_c(\mathfrak{a})$ gives us a cohomology class
\begin{equation*}
  z_c(\mathfrak{a}) \in H^1(K[c], J_0(N)[p^m]).
\end{equation*}
In the special case where $\mathfrak{a} = \mathcal{O}_c$, we drop it from the notation and write simply $z_c$.

Suppose now that $\ell \nmid c D_K N$.  Then we're going to look at what happens when we take the point $z_{c \ell}$ (attached as above to the order $\mathcal{O}_{c \ell}$) and form the norm
\begin{equation*}
  \sum_{\sigma \in \Gal(K[c \ell] / K[c])} \sigma z_{c \ell}.
\end{equation*}
We can write this as the sum
\begin{equation*}
  \sum_{\mathfrak{b} \in \ker(\Pic \mathcal{O}_{c \ell} \rightarrow \Pic \mathcal{O}_c)} \sigma_{\mathfrak{b}} z_{c \ell}.
\end{equation*}
We can in turn rewrite $\sigma_{\mathfrak{b}} z_{c \ell}$ as $\sum_{\mathfrak{b}} y_{c \ell}(\mathfrak{b}^{-1}) - \infty$, summing over the same $\mathfrak{b}$ as before.  Now, how many $\mathfrak{b}$'s are there, and what is this sum?

Suppose that $\ell$ is inert in $K$.  Comparing what happens with $c$ and $c \ell$, we get
\begin{equation*}
  \frac{(\mathcal{O}_K \otimes \mathbb{Z}_{\ell})^\times}{((\mathbb{Z} + \ell \mathcal{O}_K) \otimes \mathbb{Z}_{\ell})^\times},
\end{equation*}
which is cyclic of order $\ell + 1$.  Now, $\mathfrak{b}$ lying in the kernel of the above map means that $\mathfrak{b} \mathcal{O}_c$ is a principal ideal, say $\beta \mathcal{O}_c$ with $\beta \in K^\times$.  If we look at $\beta \mathfrak{b}^{-1} \mathcal{O}_c$, then we see that inside $\mathcal{O}_c$, it has index $\ell$.  As $\mathfrak{b}$ varies, this exhausts all lattices of index $\ell$.  By definition of the Hecke operator $T_{\ell}$, we see that
\begin{equation*}
  \sum_{\mathfrak{b}} \left( y_{c \ell}(\mathfrak{b}^{-1}) - \infty \right) = T_{\ell}(y_c - \infty).
\end{equation*}
Under the Kummer map, this tells us that
\begin{equation*}
  \operatorname{cor}_{K[c \ell] / K[c]} z_{c \ell}
  = T_{\ell} z_c.  
\end{equation*}

Kolyvagin used these relations as follows.
\begin{equation*}
  y_K = \trace_{K[1] / K} y_1 \in J_0(N)(K) \xrightarrow{\phi_E} E(K),
\end{equation*}
where $E$ is an elliptic curve of conductor $N$ with a modular parametrization $\phi_N : X_0(N) \rightarrow E$ sending $\infty$ to $0$.  Using relations, Kolyvagin could show that if the point is not torsion, then the rank of the elliptic curve is $1$.  Around the same time, Gross--Zagier showed that the Néron--Tate height of this point is nonzero if and only if $L$-function for $E/K$ vanishes exactly to order one.  This gave some of the first theoretical evidence for the Birch and Swinnerton-Dyer conjecture.  This was a spectacular application by Kolyvagin that got people interested in Euler systems.

You can also run Kolyvagin's argument in another way.  You can look at the primes $\ell$ that are \emph{split} in $K$, say $\ell = \lambda \bar{\lambda}$.  Then
\begin{equation*}
  \frac{(\mathcal{O}_K \otimes \mathbb{Z}_{\ell})^\times}{((\mathbb{Z} + \ell \mathcal{O}_K) \otimes \mathbb{Z}_{\ell})^\times}
  =
  \frac{\mathcal{O}_\lambda^\times \times \mathcal{O}_{\bar{\lambda}}^\times}{\{(a, b) : a \equiv b(\ell)\}},
\end{equation*}
where the numerator is really $\mathbb{Z}_{\ell}^\times \times \mathbb{Z}_{\ell}^\times$.  Arguing as above, we're no longer summing over all the lattices, but instead we miss two of them: $\lambda \mathcal{O}_c$ and $\bar{\lambda} \mathcal{O}_c$.  One obtains
\begin{equation*}
  \sum_{\mathfrak{b}} (y_{c \ell}(\mathfrak{b}^{-1}) - \infty )
  =
  T_{\ell}(y_c - \infty)
  - (\mathrm{Fr}_\lambda^{-1} + \mathrm{Fr}_{\bar{\lambda}}^{-1})(y_c - \infty).
\end{equation*}
(The inverses come from \eqref{eq:cq6sjz7g2n}.)

Work of the speaker and Jetchev and Wan used the split primes to do something like what Kolyvagin did.

Let $\mathfrak{c} = \lambda_1 \dotsb \lambda_r$ be a squarefree product of ideals $\lambda_i \nmid N D_K$ of degree $1$ in $K$, with $\lambda_i =\overline{\lambda_i}$.  Let $c$ be the integer such that $(c) = \mathfrak{c} \cap \mathbb{Z}$.  Let $z(\mathfrak{c})$ be basically the class that we were just analyzing, but let's modify it slightly:
\begin{equation}\label{eq:cq6sj3hg5b}
  z(\mathfrak{c}) := \prod_{i = 1}^r \left( - \mathrm{Fr}_{\lambda_i} \right) z_c \in H^1(K[c], T_p J_0(N)),
\end{equation}
where $T_p J_0(N) = \varprojlim J_0(N)[p^m]$.  We obtain now, for $\lambda \mid \ell$,

\begin{equation}\label{eq:cq6sj0iiz3}
  \operatorname{cores}_{K[c \ell] / K[c]} z(\mathfrak{c} \lambda) = \left( \mathrm{Fr}_\lambda^{- 2} - T_{\ell} \mathrm{Fr}_\lambda^{-1} + 1 \right) z(\mathfrak{c}).
\end{equation}
Let's think about this last expression in terms of the Hecke polynomial $X^2 - T_{\ell} X + \ell$.  You can see that if we evaluate this at $\lambda^{-1}$, we almost get the quantity appearing on the right hand side of \eqref{eq:cq6sj0iiz3}:
\begin{equation*}
  (X^2 - T_{\ell} X + \ell) \mid_{X = \mathrm{Fr}_\lambda^{-1}}.
\end{equation*}
They are congruent modulo $\ell - 1$, which is $N(\lambda) - 1$.  When working with Euler systems, it's acceptable to work with congruences modulo $\ell - 1$.  There's a general way to massage those classes so that they give the relations on the nose, but there's no need to do so.  Later, we'll pose a question that will suggest that this comparison is a feature of some integral representation theory, once we see where these norm relations come from in those terms.  In any event, once you have these relations, you can take these objects and run Kolyvagin's argument and reprove Kolyvagin's theorem.

We next want to explain how to set up the construction of the Kolyvagin system in such a way that some representation theory naturally shows up, with this Galois relation \eqref{eq:cq6sj0iiz3} showing up as something like a Hecke module, which in turn is closely related to representation theory.  The argument we're going to give generalizes quite significantly, for instance, it produces an Euler system in the sense of these split primes for the diagonal cycles coming from the arithmetic Gan--Gross--Prasad settings, and one can generalize Kolyvagin's statement to a rank one statement about Selmer groups for certain Rankin--Selberg convolutions of $\mathrm{GL}_n \times\mathrm{GL}_{n + 1}$.  With Euler systems, we're trying to bound the orders of Selmer groups of elliptic curves, something like $H^1_f(\mathbb{Q}, E[p^N])$, where the subscript $f$ denotes some sort of Block--Kato condition coming from the geometry of the elliptic curve.  One way to bound a Selmer group like this is to use global duality to give classes in the arithmetic dual, i.e., $H_f^1(\mathbb{Q}, E[p^N]^\ast )$, where
\begin{equation}\label{eq:cq6sj3fh1h}
  E[p^N]^\ast = \Hom(E[p^N], \mathbb{Q}_p / \mathbb{Z}_p(1)).
\end{equation}
Here one wants to allow ramification at good primes $\ell$, chosen to capture the orders of classes that we want to control.  One can then reduce to looking at
\begin{equation}\label{eq:cq6sj3eqsx}
  H^1_{\mathrm{ur}}(\mathbb{Q}_{\ell}, E[p^N]).
\end{equation}
The local duality relates this to $H^1(I_{\ell}, E[p^N]^\ast)^{G_{\mathbb{Q}_{\ell}}}$.  So if we can produce a class in the latter that is highly ramified (of large order), then we can force the class in \eqref{eq:cq6sj3eqsx} to have small order.  That, in a nutshell, is how Selmer groups are bounded.  The whole trick is to produce ramified classes in \eqref{eq:cq6sj3fh1h} that you can measure the size of in some way.  Now, producing things that are provably ramified is a hard problem.  There are few cases where we can do this.  It's much easier to check that something is unramified (think of the criterion of Néron--Ogg--Shafarevich or something like that).  What Kolyvagin's argument does is, he says well, let's start off with classes \eqref{eq:cq6sj3hg5b} that are over ramified extensions.  If they are truly over that ramified extension and not, say, defined over some extension with less ramification, then Kolyvagin can use that to produce ramified classes, and it is exactly these relations \eqref{eq:cq6sj0iiz3} that allow him to understand how ramified these classes actually are.  These norm relations are thus crucial for producing ramified classes with controlled or measurable ramification.  That's sort of the algebra background for why one is interested in Euler systems.

We'll now describe a more representation-theoretic picture that produces these Kolyvagin classes.  Recall the situation.  We have the modular curve $X_0(N)$ and the Heegner point $x_c \in X_0(N)(K[c])$, corresponding to an isogeny $[\mathbb{C} / \mathcal{O}_c \rightarrow \mathbb{C} / \mathfrak{n} \mathcal{O}_c]$.  The modular curve is a curve defined over $\mathbb{Q}$, so we can think of this point as defining a map
\begin{equation*}
  \Spec K[c] \rightarrow X_0(N).
\end{equation*}
We can base our curve to a curve over $K[c]$, yielding the following map of varieties over $K [c]$:
\begin{equation*}
  \Spec K[c] \xrightarrow{x_c} X_0(N) \times \Spec K[c].
\end{equation*}
The left hand side has dimension $0$, while the right hand side has dimension $1$.  There is thus a cycle class map
\begin{equation*}
  H^0(\Spec K[c])
  \xrightarrow{\mathrm{cyc}}
  H^{2}(X_0(N) / \Spec K[c], \mathbb{Z}_p(1)).
\end{equation*}
(In general, the exponent is $2 d$, where $d$ is the codimension.)

This is a single point.  What we did before was to take the difference between two points,
\begin{equation}\label{eq:cq6s0hup34}
  \operatorname{cyc}(x_c) - \operatorname{cyc}(\infty) \in
  H^2(X_0(N) \times \Spec K[c], \mathbb{Z}_p(1))_0,
\end{equation}
but it's now homologically trivial in the sense that if we pass to the algebraic closure, i.e., we consider the degree map
\begin{equation*}
  H^2(X_0(N) \times \Spec K[c], \mathbb{Z}_p(1))_0
  \xrightarrow{\deg}
  H^2(X_0(N) \times \Spec \bar{K}[c], \mathbb{Z}_p(1))_0
  \cong \mathbb{Z}_p
\end{equation*}
which the difference \eqref{eq:cq6s0hup34} lies in the kernel of, then we obtain the element
\begin{equation*}
  y_c \in
  H^1(K[c], H^1(X_0(N) / \bar{K}, \mathbb{Z}_p(1)))
  =H^1(K[c], T_p J_0(N)).
\end{equation*}

Now, we don't want to keep tracking the field of definition, so let's think of $x_c$ as a map over $K$.  Starting with
\begin{equation*}
  \Spec K[c](\bar{K})
  = \left\{ \sigma : K[c] \hookrightarrow \bar{K} \right\} \simeq \Gal(K[c] / K)
  = K^\times \backslash \hat{K}^\times / \hat{\mathcal{O}}_c^\times,
\end{equation*}
we can think of
\begin{equation*}
  H^0(K^\times \backslash \hat{K}^\times / \hat{\mathcal{O}}_c^\times)
  \xrightarrow{\mathrm{cyc}}
  H^2(X_0(N) \times K^\times \backslash \hat{K}^\times / \hat{\mathcal{O}}_c^\times,
  \mathbb{Z}_p(1)).
\end{equation*}
There is an action of $\Gal(K[c] / K)$ on $X_0(N) \times K^\times \backslash \hat{K}^\times / \hat{\mathcal{O}}_c^\times$ that we may reinterpret as multiplication by $\hat{K}^\times$.

Now, let's take an embedding $K \hookrightarrow M_2(\mathbb{Q})$ such that $\mathcal{O}_K = K \cap M_2(\mathbb{Z})$.  This induces $K^\times \hookrightarrow \mathrm{GL}_2(\mathbb{Q})$.  We fix $\tau_0 \in \mathfrak{h}$ such that $\Stab_{\mathrm{GL}_2^+(\mathbb{Q})}(\tau) = K^\times$.  For a compact open subgroup $U$ of $\mathrm{GL}_2(\mathbb{A}_f)$, we set
\begin{equation*}
  X_U := \mathrm{GL}_2(\mathbb{Q}) \backslash[\mathfrak{h}^{\pm, \ast} \times \mathrm{GL}_2(\mathbb{A}_f) / U],
\end{equation*}
where $\ast$ means ``add the cusps'' so as to obtain a compactification.    The above contains the set of ``CM points''
\begin{equation*}
  \left\{[\tau_0, g] : g \in \mathrm{GL}_2(\mathbb{A}_f) \right\},
\end{equation*}
which comes with with an action of $\hat{K}^\times$ via the reciprocity map $\hat{K}^\times \xrightarrow{\mathrm{rec}} G_K^{\mathrm{ab}}$ defined by
\begin{equation*}
  \operatorname{rec}(\alpha)[\tau_0, g]
  =[\tau_0, \alpha g].
\end{equation*}
We might as well take
\begin{equation*}
  U = U_0(N) = \mathrm{GL}_2(\hat{\mathbb{Z}}) \cap
  \begin{pmatrix}
    \ast    & \ast \\
    N \ast            &  \ast \\
  \end{pmatrix}.
\end{equation*}

In that case, $x_c =[\tau_0, g_c]$ for a particular choice of $g_c$.

This is the classical picture of Heegner points.  We're going to change the picture just a little bit.  Think
\begin{equation}\label{eq:cq6s0mlq0m}
  H := \mathbb{Q}^\times \backslash K^\times \rightarrow G := \frac{\mathrm{GL}_2 \times K^\times}{\mathbb{Q}^\times}.
\end{equation}
(The right hand side may be thought of as $\mathrm{GU}(1, 1)$, if you'd like.)  We get
\begin{equation*}
  X_{U_0(N)} \rightarrow
  \mathrm{S h}_G(U) := G(\mathbb{Q}) \backslash G(\mathbb{A}) / K_\infty U, \quad U := U_0(N) \times V.
\end{equation*}
We also get
\begin{equation*}
  \mathrm{S h}_H(V) := \hat{\mathbb{Q}}^\times K^\times \backslash \hat{K}^\times / V.
\end{equation*}<++>
There is a map
\begin{equation*}
  \mathrm{S h}_G(U) \rightarrow \mathrm{Sh}_H(V).
\end{equation*}
In the interest of time, we're going to cut to the chase here.  Look at compactly supported functions on $H(\mathbb{A}_f) \backslash G(\mathbb{A}_f)$, valued in $\mathbb{Z}_p$.  We'll produce elements in the Shimura variety of $G$ (over $K$) valued in $\mathbb{Z}_p(1)$:
\begin{equation}\label{eq:cq6s0i3k4v}
  C_c(H(\mathbb{A}_f) \backslash G(\mathbb{A}_f), \mathbb{Z}_p)
  \rightarrow H^2_{\mathrm{ct}}(\mathrm{S h}_{G /K}, \mathbb{Z}_p(1))
\end{equation}
\begin{equation*}
  \mathbf{1}(g U) \mapsto U_H = \hat{H}^\times g U g^{-1}.
\end{equation*}
Now we have
\begin{equation*}
  \mathrm{Sh}_H(U_H) \xrightarrow{\mathrm{cyc}}
  H^2(\mathrm{Sh}_G(g U g^{-1}), \mathbb{Z}_p(1)) \xrightarrow{g}
  H^2(\mathrm{Sh}_G(U), \mathbb{Z}_p(1)).
\end{equation*}
These maps are $G(\mathbb{A}_f)$-equivariant, or ``Hecke equivariant''.

\begin{exercise}\label{exercise:cq6tho7823}
  Recover the Heegner point Euler system that we wrote down before by taking the right open compact and the right elements $g_c$, with $V$ coming from $\mathcal{O}_c$.
\end{exercise}
The point is that through this process, the Galois action has been subsumed into some kind of group action.  What's really going on in some ways is that the Shimura varieties for these unitary groups are just some copies of modular curves, where the number of copies is just the class group of some ring class extension.  Once you have this picture, the Euler system should just be the image of a bunch of elements on the left hand side of \eqref{eq:cq6s0i3k4v}, and you just have to choose the elements:
\begin{equation*}
  \text{Euler system} = \text{ image of elements in } C_c((H \backslash G)(\mathbb{A}_f) / \mathbb{Z}_p).
\end{equation*}
This can factor.  Suppose $c = \ell_1 \dotsb \ell_r$ is ap roduct of primes.  We might then take
\begin{equation*}
  \varphi_c = \varphi_S \otimes \bigotimes_{\ell_i} \varphi_{\ell_i} \otimes \bigotimes_{
    \substack{
      \ell \neq \ell_i  \\
      \ell \notin S      
    }
  }
  \varphi_{\ell}^0 \in \Bigl(C_c(X(\mathbb{Z}_S), \mathbb{Z}_p) \otimes C_c(X(\mathbb{A}_f^S), \mathbb{Z}_p)\Bigr)^{U_c},
\end{equation*}
where $U_c := U_0(N) \times \hat{\mathcal{O}}_c^\times$, the $\varphi_{\ell_i}$ are chosen well and $\varphi_{\ell}^0 := \mathbf{1}(G(\mathbb{Z}_{\ell}))$ is the unramified choice.  By choosing $\varphi_S$ appropriately, we can even arrange that we're in the homologically trivial classes, hence giving rise to
\begin{equation*}
  z_c = \mathrm{cyc}(\varphi_c)
\end{equation*}
in Galois cohomology; this is easy to arrange by just choosing the right section for $\varphi_S$, which amounts to acting by a Hecke operator of degree zero or something like that.  The norm relations are all about the $\varphi_{\ell_i}$.  We have
\begin{equation*}
  \mathrm{cor}_{K[c \ell] / K[c]} z_{c \ell} =
  \operatorname{cyc}
  \left(
    \sum_{
      t \in (\mathcal{O}_c \otimes \mathbb{Z}_{\ell} )^\times /(\hat{\mathcal{O}}_{c \ell} \otimes \mathbb{Z}_{\ell})^\times
    }
    (1, t) \varphi_{c \ell}
  \right)
  \in C_c(X(\mathbb{A}_f), \mathbb{Z}_p)^{U_c}.
\end{equation*}
Suppose $\ell \nmid c$.  Then we have
\begin{equation*}
  \varphi_{\ell}^0 = \mathbf{1}(X(\mathbb{Z}_{\ell}))
\end{equation*}
and
\begin{equation*}
  \varphi_{\ell} ' := \trace \varphi_{\ell} = \sum_t \varphi_{\ell}(x(1, t)).
\end{equation*}
What we're interested in is, how to compare these two?  Both of the above define elements of
\begin{equation*}
  C_c(H \backslash G(\mathbb{Q}_{\ell}), \mathbb{Z}_p)^{G(\mathbb{Z}_\ell)}
  =
  C_c(H \backslash G(\mathbb{Q}_{\ell}) / G(\mathbb{Z}_\ell), \mathbb{Z}_p).
\end{equation*}
This space is cyclic for the action of the Hecke algebra (at least after tensoring by $\mathbb{Q}_p$)
\begin{equation*}
  \mathcal{H}(G \git G(\mathbb{Z}_{\ell}), \mathbb{Q}_p)
\end{equation*}
generated with respect to that action by the $\varphi_{\ell}^0$.  So we can write
\begin{equation*}
  \varphi_{\ell} ' = P_{\ell} \ast \varphi_{\ell}^0.
\end{equation*}
In the remaining minutes, let's say something about how that calculation might go.

Let $\pi$ and $\chi$ be unramified representations of $\mathrm{GL}_2(\mathbb{Q}_{\ell})$ and $K_{\ell}^\times$, respectively, with $\chi_\pi \chi \mid_{\mathbb{Q}_{\ell}^\times} = 1$.  This pair defines a representation of the group $G$ as in \eqref{eq:cq6s0mlq0m}.  Take a spherical vector $\theta \in \pi$.  Maybe we realize $\pi$ in the Whittaker model.  Let's also assume that $\ell$ splits.  The sort of functional we're looking at is
\begin{equation*}
  \int_{(g, t_0) \in H \backslash G(\mathbb{Q}_{\ell})}
  \int_{t \in \mathbb{Q}_{\ell}^\times \backslash K_{\ell}^\times}
  \theta(t g)
  \chi(t t_0)
  \varphi(g, t_0)
  \,d^\times t
  = \Lambda(\varphi).
\end{equation*}
Taking
\begin{equation*}
  \varphi = \varphi_{\ell} ' = P_{\ell} \ast \varphi_{\ell}^0,
\end{equation*}
we obtain
\begin{equation*}
  \Lambda(\varphi_{\ell} ') = \xi_{(\pi, \chi)}(P_{\ell}) \cdot \Lambda(\varphi_{\ell}^0),
\end{equation*}
where
\begin{equation*}
  \Lambda(\varphi_{\ell}^0) = \int_{\mathbb{Q}_{\ell}^\times \backslash K_{\ell}^\times} \theta(t) \chi(t) \,d^\times t.
\end{equation*}
We might want to arrange that $1 = \Lambda(\varphi_{\ell} ')$.  Since $\Lambda(\varphi_{\ell}^0)$ is the $L$-factor, this motivates taking $\xi(P_{\ell})$ to be the Hecke polynomial of which the $L$-factor is the inverse.  Here we're assuming that $\ell$ splits in $K / \mathbb{Q}$.

Locally, we can think
\begin{equation*}
  K_{\ell}^\times = \mathcal{O}_{\ell}^\times \times \mathcal{O}_{\ell}^\times \hookrightarrow \mathrm{GL}_2(\mathbb{Q}_{\ell}),
\end{equation*}
where the inclusion is the diagonal embedding.  We can take
\begin{equation*}
  g_{\ell} =
  \begin{pmatrix}
    1 & \frac{1}{\ell} \\
    0 & 1 \\
  \end{pmatrix}.
\end{equation*}
Then
\begin{equation*}
  \varphi_{\ell} '
  = \sum
  _{a \in(\mathbb{Z} / \ell)^\times}
  \varphi_{\ell}^0 \left(
    \begin{pmatrix}
    1      & \frac{a}{\ell} \\
    0             & 1 \\
    \end{pmatrix} \right).
\end{equation*}
You end up with something that's not quite what you want, but is \emph{congruent} to what you want modulo $\ell - 1$.  Anyway, the norm relation from before falls out.

You can do this more generally for $H \subset G$ defining Shimura varieties.  One can is to take
\begin{equation*}
  G = G\bigl(\U(n, 1) \times \U(n - 1, 1) \times \U(1)\bigr),
\end{equation*}
which contains
\begin{equation*}
  H = G \bigl( \U(n - 1, 1) \times \U(1) \bigr).
\end{equation*}
(This belongs to the ``GGP'' setting.)  We have a corresponding map of Shimura varieties
\begin{equation*}
  \mathrm{Sh}_H \rightarrow \mathrm{Sh}_G
\end{equation*}
of dimensions $n - 1$ and $n + n - 1 = 2 n - 1$, so the codimension is $n$, and we get a cycle class map
\begin{equation*}
  H^0(\mathrm{Sh}_H) \xrightarrow{\mathrm{cyc}} H^{2 n}(\mathrm{Sh}_G, n).
\end{equation*}
This leads to
\begin{equation*}
  H^1(\text{ring class fields}, H^{2 n - 1}(\mathrm{Sh}_{\U(n - 1, 1) \times \U(n, 1)})).
\end{equation*}
See the work of the speaker and Xinwen Wan.

\begin{remark}\label{remark:cq6tho73c6}
  We consider
  \begin{equation*}
    C_c(X(\mathbb{Q}_{\ell}), \mathbb{Z}_p)^{G(\mathbb{Z}_{\ell})}
    \supseteq \trace C_c(X(\mathbb{Q}_{\ell}), \mathbb{Z}_p)^{G_{\ell}(\mathbb{Z}_{\ell})},
  \end{equation*}
  for some subgroup $G_{\ell}(\mathbb{Z}_{\ell}) \subseteq G(\mathbb{Z}_{\ell})$.  What is the right hand side?  Contains
  \begin{equation*}
    \left( P_{\ell} ,(\ell - 1) C_c(\dotsb)^{G(\mathbb{Z}_{\ell})} \right).
  \end{equation*}
\end{remark}
\begin{remark}\label{remark:cq6tho71jb}
  See paper of David Loeffler regarding the ramified primes
\end{remark}


\section{Jayce Getz's lectures}\label{sec:cq6tho1wyu}
\subsection{Langlands $L$-functions and converse theorem}\label{sec:cq6tho1xqr}

Let $F$ be a number field, $\mathbb{A}_F$ the ring of adeles, and $G$ a split reductive group over $F$.  Let $A_G$ denote the neutral component in the real topology of the greatest $\mathbb{Q}$-split torus in $\Res_{F / \mathbb{Q}} Z_G$.  (For example, $A_{\GL_r} = \mathbb{R}_{> 0} I_r$.)


\textbf{Goal}: given an $L$-map $\rho : {}^L G \rightarrow \mathrm{GL}_n(\mathbb{C})$, construct a transfer of automorphic representations of $G(\mathbb{A}_F)$ to $\mathrm{GL}_n(\mathbb{A}_F)$.

Given an automorphic representationd $\pi$ of $G(\mathbb{A}_F)$, we can form the Langlands $L$-function
\begin{equation*}
  L(s, \pi, \rho) := \prod_v L(s, \pi_v, \rho).
\end{equation*}
If $\pi$ is unramified at $v$, then
\begin{equation*}
  L(s, \pi_v, \rho) = \frac{1}{\det(1 - \rho(c(\pi_v)) q_v^{- s})},
\end{equation*}
where $c(\pi_v) \in{}^L G$ is the Langlands class of $\pi_v$.

Let $\psi : F \backslash \mathbb{A}_F \rightarrow \mathbb{C}^\times$ be a nontrivial character.  Then we obtain $\eps$-factors $\eps(s, \pi_v, \rho, \psi_v)$, defined via local Langlands and the known definition in the case of $\mathrm{GL}_n$.  There is also the $\gamma$-factor
\begin{equation*}
  \gamma(s, \pi_v, \rho, \psi_v) :=
  \frac{
    \eps(s, \pi_v, \rho, \psi_v)
    L(1 - s, \pi_v^\vee, \rho)
  }{
    L(s, \pi_v, \rho)
  }.
\end{equation*}
\begin{conjecture}[Langlands]\label{conjecture:cq6tho7y7k}
  $L(s, \pi, \rho)$ admits a meromorphic continuation to $\mathbb{C}$, is bounded in vertical strips, and satisfies a functional equation
  \begin{equation*}
    L(s, \pi, \rho) = \eps(s, \pi, \rho, \psi) L(1 - s, \pi^\vee, \rho).
  \end{equation*}
\end{conjecture}
If $L(s, \pi, \rho)$ satisfies the conjecture, then we say that it is \emph{nice}.

One case where we know this in complete generality is the case of the standard representation
\begin{equation*}
  \rho := \rho_{\mathrm{st}} = \mathrm{triv} \times \mathrm{Id} :{}^L \mathrm{GL}_n = \Gal_F \times \mathrm{GL}_n(\mathbb{C}) \rightarrow \mathrm{GL}_n(\mathbb{C}),
\end{equation*}
in which case we write simply
\begin{equation*}
  L(s, \pi) := L(s, \pi, \rho_{\mathrm{st}}).
\end{equation*}
Then the conjecture is known, and you can prove it in three different ways that are largely distinct:
\begin{itemize}
\item Godement--Jacquet (which preceded the general formulation of this conjecture).
\item The Rankin--Selberg method.
\item The Langlands--Shahidi method.
\end{itemize}
At first glance, none of these methods will work to address the general conjecture, but we'll see that there is a sort of modification of the first two that might be applicable.

Now, what's the converse theorem?
\begin{theorem}[Cogdell--Piatetski-Shapiro; Hecke, Weil]\label{theorem:cq6tho7vvs}
  Let $\sigma$ be an admissible irreducible representation of $\mathrm{GL}_n(\mathbb{A}_F)$.  (In order to get this sort of thing, you have to choose a bunch of local data and outside finitely many places you declare that it is unramified.)  Assume that
  \begin{itemize}
  \item the central character $\omega_\sigma$ is $Z_{\mathrm{GL}_n(F)}$-invariant,
  \item $\sigma_v$ is generic for all $v$, and
  \item $L(s, \sigma)$ converges for $\Re s$ sufficiently large.
  \end{itemize}
  Let $S$ be a finite set of finite primes.  Assume that $L(s, \sigma \times \sigma ')$ is nice and holomorphic for all cuspidal automorphic representations $\sigma '$ of $\mathrm{GL}_m(\mathbb{A}_F)$ unramified at $S$, with $1 \leq m \leq n - 2$ (for $n \geq 2$; for $n = 2$, just take $m = 1$).  Then there exists an automorphic representation $\pi '$ of $\mathrm{GL}_n(\mathbb{A}_F)$ that is nearly equivalent to $\sigma$ in the sense that $\sigma_v \cong \pi_v '$ for all $s \notin S$.
\end{theorem}
To see the relevance of this, take $\pi$ on $G(\mathbb{A}_F)$, and take $\sigma = \rho(\pi)$, giving an admissible representation for almost all places (assuming the local Langlands correspondence).

This gives some overplay of the interplay between $L$-functions and automorphic representations and exactly how the two are interrlated via functoriality.  This sort of thing is in the background when you read things on the Braverman--Kazhdan program, Beyond Endoscopy, etc.

Now let's talk about a particular case.

\subsection{Rankin--Selberg products and triple products}\label{sec:cq6tho1yti}

Let $\underline{r} =(r_1, r_2, r_3)$.  Set $\mathrm{GL}_{\underline{r}} :=\mathrm{GL}_{r_1} \times\mathrm{GL}_{r_2} \times\mathrm{GL}_{r_3}$.  We have an $L$-map that we call the Rankin--Selberg product (taking complex points, say)
\begin{equation}\label{eq:cq6tg2afra}
  \otimes^2 : {}^L(\mathrm{GL}_{r_1} \times\mathrm{GL}_{r_2}) \rightarrow\mathrm{GL}_{r_1 r_2},
\end{equation}
\begin{equation}\label{eq:cq6tg2hl5x}
  \otimes^3 : {}^L\mathrm{GL}_{\underline{r}} \rightarrow\mathrm{GL}_{r_1 r_2 r_3}.
\end{equation}
We'll think of these as hypothetical Langlands transfers.
\begin{theorem}[Chevalley]\label{theorem:cq6tho7t2z}
  Given any faithful representation $\rho : H \rightarrow \mathrm{GL}_n$ (say with $H$ reductive), any other representation is a subrepresentation of $\rho^{\otimes m} \otimes \rho^{\vee \otimes n}$ for some $m$ and $n$.
\end{theorem}
Now, ${}^L G$ is not a reductive group, but ignore that fact for a moment.  Say we're given an $L$-map
\begin{equation}\label{eq:cq6tg2amid}
  \rho :{}^L G \rightarrow \mathrm{GL}_n.
\end{equation}
Suppose we know the Rankin--Selberg transfer \eqref{eq:cq6tg2afra} as well as transfer for \eqref{eq:cq6tg2amid}.  Then, \emph{any} transfer from $G$ to $\GL(V)$ is a ``subtransfer'' of some $\rho^{\otimes m} \otimes \rho^{\vee \otimes n}$.

\begin{question}[Not an exercise]\label{question:cq6tho7sd5}
  Given functorial transfers $\rho^{\otimes m} \otimes \rho^{\vee \otimes n}$, how to pick out the transfers associated to subrepresentations?
\end{question}

By analogy to representation theory, some of the basic ways to construct new representations from old ones is to take direct sums, induced representations and tensor products.  In the automorphic world, we know how to do the first two (isobaric sum and Eisenstein series), but not the third.

The importance of triple product $L$-functions (attached to \eqref{eq:cq6tg2hl5x}) is that if they are nice, then, using the converse theorem, we get that Rankin--Selberg transfers exist.  This is the motivation for what we're about to do.

\subsection{Poisson summation conjecture}\label{sec:cq6tho1zlh}

In the exercises, we'll see the Godement--Jacquet Poisson summation formula for $M_{n \times n}$, which leads to the functional equation and analytic continuation of the standard $L$-functions $L(s, \pi)$.  Bravmern--Kazhdan suggest replacing $M_{n \times n}$ by a certain $M_{\rho}$, and try to run the argument to study $L(s, \pi, \rho)$.  This proposal was refined by Ngô.  Sakellaridis suggested working with some spherical
varieties.  Need a little more flexibility.

We'll start with the geometric setup.

\subsubsection{Global setting}\label{sec:cq6tho17py}

Let $F$ be a number field, let $R$ be an $F$-algebra, and let $G_{/F}$ be a reductive group.  Assume given an action
\begin{equation*}
  \mathcal{R} : X \times G \rightarrow X
\end{equation*}
on an affine $G$-scheme $X$.  Assume that there is a unique open orbit $X^{\circ} \subseteq X$.  Let $Z_G^+$ denote the greatest split torus in $Z_G$ (e.g., for $G = \mathrm{GL}_n$, $Z_G^+ = \mathbb{G}_m$).  Fix an isomorphism $\mathbb{G}_m^n \xrightarrow{\cong} Z_G^+$.  Assume that the pullback $\mathcal{R} : X \times \mathbb{G}_m^n \rightarrow X$ extends to $\mathcal{R} : X \times \mathbb{G}_a^n \rightarrow X$.

\begin{example}\label{example:cq6tho7qex}
  $X = \mathbb{G}_a$ (which we don't write as $\mathbb{A}^1$, because that denotes the adeles).  Then the map $X \times \mathbb{G}_m \rightarrow X$ given by $(t, a) \mapsto t a$ extends to $\mathbb{G}_a \supset \mathbb{G}_m$ (at $0$, but not at $\infty$).
\end{example}

Assume that there exists an automorphic $\iota : G \rightarrow G$ such that $\iota(z) = z^{-1}$ for $z \in Z_G^+(\mathbb{R})$.

\begin{example}\label{example:cq6tho7ox2}
  Take $X$ to be a vector space, $G =\mathrm{GL}_{X}$, $\iota(g) = g^{- \intercal}$, and $X(R) := \{x \in R^n \mid Q(x) = 0\}$, where $Q$ is an anisotropic quadratic form.  Or take $G = \GO_Q$, and $\iota(g) = \operatorname{simil}(g^{-1}) g$.
\end{example}

We need a generalization.  In integral representations, you often need some sort of Whittaker or Fourier coefficients to integrate against.  The reason is that if you don't have it, then when you integrate against cusp forms, you get zero.  If we don't have this in the cases of interest, then we end up getting zero.  There's a geometric way of phrasing this:
\begin{definition}\label{definition:cq6tho7nvw}
  Suppose given a $\mathbb{G}_a^n$-torsor $p : V^{\circ} \rightarrow X^{\circ}$ equipped with a $\mathbb{G}_a^n \rtimes G$-action.  Assume that $p$ is $\mathbb{G}_a^n \rtimes G$-equivariant.  Consider the map
  \begin{equation*}
    V^{\circ}(R) \times R^n \times G(R) \rightarrow V^{\circ}(R) \times R^n,
  \end{equation*}
  \begin{equation*}
    (v, z, g) \mapsto(v g,(0 \times g)^{-1} z(0 \times g)).
  \end{equation*}
  Assume given $\Psi : V^{\circ} \times \mathbb{G}_a^n \rightarrow \mathbb{G}_a$ such that
  \begin{enumerate}
  \item [$\Psi 1$] $\Psi$ factors through $p \times \mathrm{id} : V^{\circ} \times \mathbb{G}_a^n \rightarrow X^{\circ} \times \mathbb{G}_a^n$.
  \item [$\Psi 2$] $\Psi$ is $G$-invariant.
  \item [$\Psi 3$] For each $w \in V^{\circ}(R)$, the map $\Psi(w, \bullet) : \mathbb{G}_{a, R}^n \rightarrow \mathbb{G}_{a, R}$ is a group homomorphism.
  \end{enumerate}
  An \emph{affine} $\Psi$\emph{-bundle} is a pair $(p : V^{\circ} \rightarrow X^{\circ}, \Psi)$ as above.
\end{definition}
Given $w \in V^{\circ}(R)$, set $x := p(w)$.  We obtain $R^n \xrightarrow{\cong} V_x^0(R)$, $z \mapsto w z$.  For $g \in G_\lambda(R)$, there is a unique $z_w(g) \in R^n$ such that $w z_w(g) = w g$.  Then $\Psi_w(g) = \Psi(w, z_w(g))$.
\begin{lemma}\label{lemma:cq6tho7lzu}
  $\Psi_w : G_x \rightarrow \mathbb{G}_a$ is a character, depending only upon $x$.
\end{lemma}

This is the geometry that underlies the Poisson summation conjecture.  In the remaining time today, we'll start doing some of the harmonic analysis.  We'll enrich the geometry by introducing some function spaces on the $F$-points of everything.  We'll start that process now and continue it in the next lecture.

\subsubsection{Local harmonic analysis}\label{sec:cq6tho3bu5}

Start with some global character $\psi : F \backslash \mathbb{A}_F \rightarrow \mathbb{C}^\times$.  Let $v$ be a place of $F$.  Define $F = F_v$, $\psi = \psi_v$.  Thus, we'll work locally and omit $v$ from notation.  We ask for a Schwartz space sitting as follows:
\begin{equation*}
  C_c^\infty(X^{\circ}(F)) \subseteq \mathcal{S}(X(F)) \subseteq C^\infty(X^{\circ}(F)) \cap L^2(X^{\circ}(F)).
\end{equation*}
(This assumes that we have an invariant measure to define $L^2$.  It's better in some sense to work instead with half-densities.)  We want the Schwartz space to be stable under $G(F)$.  One can do a bit more: one can form an $\eps_\psi$-hermitian bundle over $X^{\circ}(F)$, using the affine $\Psi$-bundle just mentioned.  The sections are
\begin{equation*}
  \left\{ f \in C^\infty(V^{\circ}(F)) \mid \mathcal{R}(a \times I) f(w) = \psi(\Psi(w, a) f(w)) \right\}.
\end{equation*}
The motivation is that if you don't incorporate such sections rather than just functions, then you'll get zero when you try to integrate against cusp forms.  Consider for instance a cusp form $\varphi$ on $\mathrm{GL}_2(\mathbb{A}_F)$.  Then
\begin{equation*}
  \int_{[\mathbb{G}_a]} \varphi
  \begin{pmatrix}
    1 & x \\
    0 & 1 \\
  \end{pmatrix} \, d x= 0,
\end{equation*}
while
\begin{equation*}
  \int_{[\mathbb{G}_a]} \varphi
  \begin{pmatrix}
    1 & x \\
    0 & 1 \\
  \end{pmatrix}
  \psi(x) \, d x
  \, d x
  =
  W_\psi^\varphi(1).
\end{equation*}
Actually, it's better, and we do it in the paper (see the course references (TODO: add link here)), and you need it.  We twist by half-densities: $\eps_\psi \otimes \lvert \Lambda \rvert^{1/2} = \mathcal{L}_\psi$.  These are canonical -- no choice of measure.  They are helpful for normalization.  On the other hand, you can't evaluate at points.  But you can work around this.  Using these makes the formulation of the theory much simpler.  Another benefit is that with half-densities, Schwartz spaces behave well under restriction.  Maybe the reason behind this might be an exercise:
\begin{exercise}\label{exercise:cq6tho3tag}
  $L^2(X^{\circ}(F), \lvert \Lambda \rvert^{1/2})$ is a unitary $G(F)$-representation.
\end{exercise}

We continue now with harmonic analysis over a local field $F$.  Let $X \times G \rightarrow X$ be a $G$-variety, with open $G$-orbit $X^{\circ} \subset X$.  We'll ignore the half-densities ``$\mathcal{L}_\psi$'' discussed earlier.

Recall that we are looking for a Schwartz space $\mathcal{S}(X(F))$ sitting as follows:
\begin{equation*}
  C_c^\infty(X^{\circ}(F)) \subset S(X(F)) \subset C^\infty \cap L^2(X^{\circ}(F)).
\end{equation*}
We moreover have the following desiderata for the Schwartz space:
\begin{itemize}
\item It should be stable under $G(F)$.
\item There should be a unitary ``Fourier transform'' $\mathcal{F}_X \circlearrowright \mathcal{S}(X(F))$.
\item We should have the compatibility $\mathcal{F}_X \circ \mathcal{R}(g) = \mathcal{R}(\iota(g)) \mathcal{F}_x$
\end{itemize}
We caution that elements of $\mathcal{S}(X(F))$ need not be defined on all of $X(F)$.  We want the following:
\begin{enumerate}
\item In the archimedean case, we want $S(X(F))$ to be a Frechét space, with the action continuous.
\item We want elements of $S(X(F))$ to enjoy ``rapid decay at $\infty$''.  In the archimedean case, this means dominated by a Schwartz function after an affine embedding.  In the non-archimedean case, it means supported on a compact subset of $X(F)$ (not $X^{\circ}(F)$).
\item We want the space to be local: given a $G$-equivariant embedding $X \hookrightarrow \mathbb{G}_a^n $, we want the space to be preserved under multiplication by restrictions of functions in $\mathcal{S}(F^n)$.
\end{enumerate}
In the unramified case, we ask that for a \emph{basic function} $b_X \in S(X(F))$ such that $X^{\circ}(\mathcal{O}_F) \subsetneq \supp b_X \subseteq X(\mathcal{O}_F)$, with $\mathcal{F}_X(b_X) = b_X$.

In many cases, one can construct this.  For instance, the case of $\overline{P^{\der} \backslash G}^{\mathrm{aff}}$ was studied by Braverman--Kazhdan, refined by Getz--Liu, and further by Getz--Hsu--Leslie.

\subsubsection{Poisson summation formula}\label{sec:cq6txpqnif}

Let $F$ again be a number field.  Assume that $\mathcal{S}(X(F_v))$ has been constructed for all places $v$.  We then take
\begin{equation*}
  \mathcal{S}(X(\mathbb{A}_F)) = \bigotimes_{v \mid \infty} \mathcal{S}(X(F_v))  \otimes \bigotimes_{v \nmid \infty} {}^{'} \mathcal{S}(X(F_v)),
\end{equation*}
where the restricted tensor product is with respect to the $b_{X_{F_v}}$.

We set $\mathcal{F}_X := \otimes_v \mathcal{F}_{X_{F_v}}$, which acts on $\mathcal{S}(X(\mathbb{A}_F))$.  If
\begin{equation}\label{eq:cq6txloduw}
  f = f_{v_1} f_{v_2} f^{v_1 v_2}
  \quad \text{ with }
  \supp f_{v_1}  \subset X^{\circ}(F_{v_1})
  \text{ and }
  \supp \mathcal{F}_X(f_{v_2}) \subset X^{\circ}(F_{v_2}),
\end{equation}
then the Poisson summation conjecture is that is the statement that
\begin{equation*}
  \sum_{x \in X^{\circ}(F)} f(x) = \sum_{x \in X^{\circ}(F)} \mathcal{F}(f)(x).
\end{equation*}
We remark that this may not be true in general.  We expect it to be true for reductive monoids and more generally in multiplicity one situations.  One thing we'll talk about in later lectures is how one can prove new types of formulas of this type from old ones.  We'll see examples where even if you're ultimately interested in situations with multiplicity one (spherical varieties), it may be useful to pass outside that setting.

Now, Poisson summation is a very useful formula in analysis, but why would someone outside representation theory care about this?  The reason is the connection to zeta integrals.  Suppose $\pi$ is cuspidal in $A_G \backslash G(\mathbb{A}_F)$, and let $\varphi \in \pi$.  Write $Z_G^+ = \mathbb{G}_m^n$.  We assume given characters
\begin{equation*}
  \eta_s : G(\mathbb{A}_F) \rightarrow(\mathbb{A}_F^\times)^n \xrightarrow{x \mapsto \prod \lvert x_i \rvert^{s_i}} \mathbb{C}^\times.
\end{equation*}
Given $f \in \mathcal{S}(X(\mathbb{A}_F))$, we form the zeta integral
\begin{equation*}
  Z(f, \varphi, s) = \int_{[G]}
  \sum_{x \in X^{\circ}(F)} f(x g)
  \varphi(g)
  \eta_s(g) \, d g.
\end{equation*}
Morally, the Poisson summation conjecture implies that
\begin{equation*}
  Z(f, \varphi, s) = Z(\mathcal{F}_X(f), \varphi^\vee, 1 - s),
\end{equation*}
where $\varphi^\vee(g) = \varphi(\iota(g))$ is just defined using this automorphism that we mentioned earlier.  These sort of period integrals have appeared in almost every talk that we've seen this week.

We're primarily interested in the Eulerian case, i.e., when
\begin{equation*}
  Z(f, \varphi, s) = \prod_v Z(f_v, \varphi_v, s)
\end{equation*}

for pure tensors $f = \otimes_v f_v$ and $\varphi = \otimes_v \varphi_v$.

\subsection{The spectral argument}\label{sec:cq6txpqmpx}

Known properties of $L$-functions imply cases of the Poisson summation conjecture.  (This is analogous to the fact that the functional equation of the Riemann zeta function is \emph{equivalent} to Poisson summation for $\mathbb{Z}$.)  Why would you do this, given that it seems circular?
\begin{enumerate}
\item It puts the local theory on firmer footing.
\item It's a check on the Poisson summation conjecture.
\item We can produce new Poisson summation formulae from old ones.  (If you place it in the right context, the Rankin--Selberg method is a consequence of this.  It starts by taking known properties of Eisenstein series, which can always be understood as a case of the Poisson summation conjecture, and then applies it to new $L$-functions.)
\item ``Boundary terms lead to residue kernels.''  We won't have much time to talk about this point in these lectures, but the idea is that if you want to remove the condition \eqref{eq:cq6txloduw}, you'll get new boundary terms, which can in turn be related to residues of $L$-functions.
\end{enumerate}

\subsubsection{Plancherel decomposition}\label{sec:cq6txpqlp7}

Let's talk about this spectral argument, starting locally.  A nice reference is \cite{MR1075727}.  Recall that we expect
\begin{equation*}
  C_c^\infty(X^{\circ}(F)) \subsetneq \mathcal{S}(X(F)) \subsetneq \mathcal{C}(X(F)) \subsetneq L^2(X(F)),
\end{equation*}
where $\mathcal{C}$ denotes the Harish--Chandra Schwartz space.  We may write
\begin{equation*}
  L^2(X^{\circ}(F)) = \int_{\widehat{G(F)}} V_\pi \, d \mu_X(\pi)
\end{equation*}
for some Borel measure $d \mu_X(\pi)$.  (If you're not familiar with these, they're analogous to writing $L^2(\mathbb{R}) = \int \mathbb{C} e^{i t} \, d t$.)  We assume that the support of $d \mu_X$ is contained in the tempered spectrum $T_p(G(F))$.  For each $\pi$, we have a projection map
\begin{equation*}
  \alpha_\pi : C_c^\infty(X^{\circ}(F)) \rightarrow V_\pi,
\end{equation*}
with adjoint
\begin{equation*}
  \beta_\pi : V_\pi^\infty \rightarrow C^\infty(X^{\circ}(F)).
\end{equation*}
For $f \in C_c^\infty(X^{\circ}(F))$, we have
\begin{equation*}
  f(x) = \int_{T_p(G(F))}
  f_\pi(x)
  \, d \mu_X(\pi)
  \quad
  \text{ when }
  f_\pi = \beta_\pi \circ \alpha_\pi(f).
\end{equation*}


\subsubsection{$L$-functions}\label{sec:cq6txpqktt}

Recall that we have our torus
\begin{equation*}
  \begin{CD}         
    Z_G^+    @>>> \mathbb{G}_m^n\\
    @VVV  @VVV \\
    \overline{Z_G^+}    @>>> \mathbb{G}_a^n. \\
  \end{CD}
\end{equation*}
Recall that we asked that the action map  $X^{\circ} \times Z^+_G \rightarrow X^{\circ}$ extends to a map (no longer an action) $X \times \overline{Z_G^+} \rightarrow X$.  We can choose $d_i : G \rightarrow \mathbb{G}_m$ such that
\begin{equation*}
  Z_G^+ \rightarrow G \xrightarrow{\prod  d_i} \mathbb{G}_m^n
\end{equation*}
is an isogeny.  For $s \in \mathbb{C}^n$, set
\begin{equation*}
  \eta_s(g) := \prod \lvert d_i(g) \rvert^{s_i}.
\end{equation*}
We record \textbf{Hypothesis L}: there exists $r_i :{}^L G \rightarrow \GL_{v_i}(\mathbb{C})$, for $1 \leq i \leq n$, such that when $F$ is non-archimedean, for all $f \in C_c^\infty(X(F))$ and $\phi \in C_c^\infty(X^{\circ}(F))$e, we have
\begin{equation*}
  \frac{\left\langle f, \phi_\pi \otimes \eta_s \right\rangle}{\prod L(\tfrac{1}{2} + s_i, \pi, r_i)} \in \mathbb{C}[q^{\pm s_1}, \dotsc, q^{\pm s_n}].
\end{equation*}
See the work of Sakellaridis--Venkatesh, Ichino--Ikeda, and our paper in the list of references.  The idea is that some ``almost $L$-functions'' (they would be actual $L$-functions if the ratio were $1$ rather than some polynomial) control the boundary asymptotics.

A basic example is when $X^{\circ} = \mathbb{G}_m$ and $X = \mathbb{G}_a$, where the asymptotics near zero are controlled by the local zeta factor $\zeta(s)$.

There's another hypothesis that's useful: \textbf{Multiplicity one}.  This says that for tempered $\pi$ and generic $s \in \mathbb{C}^n$, we have
\begin{equation*}
  \dim \Hom(V_\pi \otimes \eta_s \otimes C^\infty(X^{\circ}(F)), \mathbb{C}) = 1.
\end{equation*}
(This was one of the motivations for Sakellaridis to focus on spherical varieties in his early papers.)

\subsubsection{Construction of a Schwartz space}\label{sec:cq6txpqjrw}

Given the above, we can give our first pass at the definition of the Schwartz space.  Assume that
\begin{equation*}
  f(x) = \int_{T_p(G(F))}
  f_\pi(x)
  \, d \mu_X(\pi).
\end{equation*}
Assume Hypothesis $L$ and Multiplicity One.  If $F$ is non-archimedean, then our first approximation at a definition is that
\begin{equation*}
  \mathcal{S}^{\text{naive}}(X(F))
  =
  \left\{ f \in \mathcal{C}(X^{\circ}(F)) \mid \pi \mapsto \frac{f_\pi}{\prod_i L(\frac{1}{2}, \pi, r_i)} \text{ is polynomial} \right\}.
\end{equation*}
(Our treatment is inspired by \cite[\S2.6]{2015arXiv150601452B}.)  A polynomial function on $(\mathbb{R} / 2 \pi i \log q)^n$ is a function of the form $s \mapsto p(q^{- s}, q^{s})$ for some $p \in \mathbb{C}[x, y] /(x y - 1)$.  Locally, $T_p(G(F))$ is a quotient of $(\mathbb{R} / 2 \pi i \log q)^n$ by a finite group.  A polynomial function on $T_p(G(F))$ is a function that pulls back to a polynomial function on $(\mathbb{R} / 2 \pi i \log q)^n$.  (You can ask me later to give an example.)  Define the basic function to be
\begin{equation*}
  b_X = \int_{T_p(G(F))}
  \prod_i L(\tfrac{1}{2}, \pi, r_i)
  \cdot 
  \mathbf{1}_{X^{\circ}(\mathcal{O}_F)_\pi}
  \, d \mu_X(\pi)
\end{equation*}
and
\begin{equation*}
  \mathcal{F}_X(f) := \int_{T_p(G(F))} \prod_i \gamma(\tfrac{1}{2}, \pi, r_i) \cdot f_{\pi^\vee}
  \, d \mu_X(\pi).
\end{equation*}
Then $\mathcal{F}_X$ acts on $\mathcal{S}^{\text{naive}}(X(F))$.  (This should be an approximation to the Schwartz space, but too big.)

\subsubsection{The spectral argument}\label{sec:cq6txpqe90}

We define $\mathcal{S}(X(\mathbb{A}_F))$ to be a restricted tensor product, as before.
\begin{exercise}\label{exercise:cq6txpqdmd}
  Derive the Poisson summation formula for $\mathbb{Z} \subset \mathbb{R}$ from the functional equation of the Riemann zeta function $\zeta(s)$.
\end{exercise}
Generalizing this, you can show that if $L(s, \pi, r_i)$ is nice for all $i$, then the Poisson summation conjecture holds for $X$.  We're not going to go through this, and in any given case there might be some difficulties to make this precise.

\begin{example}\label{example:cq6ud4pnkj}
  Take $F$ to be a local non-archimedean field.  We may write
  \begin{equation*}
    L^2(F^\times) = \int_{\mathbb{R} / (2 \pi i \log q) \mathbb{Z}} \bigoplus_\chi \chi \lvert . \rvert^{i t} \, d t,
  \end{equation*}
  where $\chi$ runs over a set of characters of $F^\times$ modulo twisting by $\lvert . \rvert^{i t}$.  Take $X^{\circ} \subset X$ to be $\mathbb{G}_m \subset \mathbb{G}_a$.  Set $f := \mathbf{1}_{X(\mathcal{O}_F)}$.  Let $\phi \in C_c^\infty(F^\times)$, such as $\phi = \mathbf{1}_{\mathcal{O}_F^\times}$.  Then
  \begin{equation*}
    \phi_{\chi_s} = \int_{\mathcal{O}_F^\times} \chi_s(t) \, d t \, \chi_s(x).
  \end{equation*}
  We have
  \begin{equation*}
    \langle f, \phi_{\chi_s} \rangle = L(s, \chi).
  \end{equation*}
\end{example}


\subsection{Producing new Poisson summation formulae from old}\label{sec:cq6ud4pku1}

We will discuss two techniques, one of which has been exploited more than the other.

\subsubsection{Restriction}\label{sec:cq6ud4pjsa}

Suppose given $X \times G \rightarrow X$ together with a Poisson summation formula.  If we restrict to a subgroup $H \subset G$ that still has open orbit, then we get a Poisson summation formula still for $X$, but with respect to the action of $H$.
\begin{example}\label{example:cq6ud4qj65}
  Take a parabolic subgroup $P = M N \leq G$.  We can look at
  \begin{equation*}
    X := \overline{P^{\mathrm{der} \backslash G}}^{\mathrm{aff}},
  \end{equation*}
  with an action by $M^{\mathrm{a b}} \times G$.  The Poisson summation conjecture for $X$ is known, and is essentially the theory of Eisenstein series plus the spectral argument.  (Some of these ideas go back to Gelfand--Graev.)  Here $M^{\mathrm{ab}}$ is an abelian group, so you can do a Mellin transform.  By summing, one then gets an Eisenstein series.  The thing to note is that if we look at the integrals defined the other day $Z(f, \varphi, s) = 0$ for $\varphi$ a cusp form on $G(\mathbb{A}_F)$, because if we try to integrate it against this space, then every stabilizer will continue the unipotent radical of a parabolic subgroup, hence will die.  But $Z(f, \varphi, s)$ may be nonzero if $\varphi$ is a cusp form on $H(\mathbb{A}_F)$.  This will still have a functional equation because it inherits it from the case of $G$.  \end{example}
The above is just another way of talking about the Rankin--Selberg method.  Here's a concrete example:
\begin{example}\label{example:cq6ud4qlts}
  Let $P$ denote the Siegel parabolic subgroup of $\mathrm{GSp}_6$, i.e.,
  \begin{equation*}
    P = \left\{
      \begin{pmatrix}
        z g        & \ast \\
                   & g^{- \intercal} \\
      \end{pmatrix}
      : g \in \mathrm{GL}_3\right\}.
  \end{equation*}
  Take $H = G(\mathrm{SL}_2 \times \mathrm{SL}_2 \times \mathrm{SL}_2)$.  Poisson conjeture for $\overline{P^{\der} \backslash \mathrm{GSp}_6}$ is known.  This gives rise to the triple product $L$-function $L(s, \pi, \otimes^3)$ for $\pi = \pi_1 \otimes \pi_2 \otimes \pi_3$, with $\pi_i$ on $\mathrm{GL}_2(\mathbb{A}_F)$, introduced by Garrett \cite{MR881269} and developed further by Piatetski-Shapiro--Rallis \cite{MR911357}.
\end{example}

\subsubsection{Coinvariant}\label{sec:cq6ud4ph5c}

Take $X \times G \rightarrow X$ and $\iota \circlearrowright G$, as before.  Assume that $G = G ' \ltimes H$ and that $\iota |_{H} = \id$.  Suppose given a $G'$-equivariant map
\begin{equation*}
  I : \mathcal{S}(X(F))_{H(F_v)} \rightarrow C^\infty(Y^{\circ}(F_v))
\end{equation*}
for some quasi-affine space $Y^{\circ}$, with $Y^{\circ} \times G' \rightarrow Y^{\circ}$ some other action.  We assume the Poisson summation conjecture for $X$.  Often, one can prove
\begin{equation*}
  \sum_{y \in Y^{\circ}(F)}
  I(f)(y)
  = \sum_{y \in Y^{\circ}(F)}
  I(\mathcal{F}_X(f))(y).
\end{equation*}
This gives the Poisson summation formula for $Y \times G' \rightarrow Y$.

It is often reasonable to define
\begin{equation*}
  \mathcal{S}(Y(\mathbb{A}_F)) := \mathcal{S}(X(\mathbb{A}_F))_{H(\mathbb{A}_F)}.
\end{equation*}
You have to be a bit careful at the infinite places (you want to take some closure, but let's not worry about that).  You can think of $\mathcal{S}(X(\mathbb{A}_F)) \rightarrow \mathcal{S}(Y(\mathbb{A}_F))$ as a harmonic analytic analogue of the map $X \rightarrow[X / H]$, where $[X / H]$ is the stack that appeared in yesterday's exercise session.

Two examples:

\begin{example}
  (Suggested to me by Aaron Slipper.)  Take $V = \mathbb{G}_a^n$ to be a vector space, and $V \times G \times H \rightarrow V$ any action.  Then we get a Schwartz space for $V / H$.  This seems a bit stupid, but you can create some fairly complicated vector spaces $V$ and get some interesting examples out of this.
\end{example}

\begin{example}\label{example:cq6ud5xqwu}
  $V = \mathbb{G}_a^n \times \mathbb{G}_a^n$ and $Q_n(x, y) := x y^{\intercal}$, and $Y_n(R) := \left\{ v \in V_n(R) : Q_n(v) = 0 \right\}$ to be the zero locus.  We have a Weil representation
  \begin{equation*}
    \rho : \mathrm{SL}_2(\mathbb{A}_F) \times \O_{V_n}(\mathbb{A}_F) \times \mathcal{S}(V_n(\mathbb{A}_F)) \rightarrow \mathcal{S}(V_n(\mathbb{A}_F)).
  \end{equation*}
  Let $R := (\rho \otimes\mathrm{std}^\vee) \boxtimes \mathrm{trivial} : \mathrm{SL}_2(\mathbb{A}_F) \otimes \O_{V_n}(\mathbb{A}_F) \times \mathcal{S}(V_{n + 1}(\mathbb{A}_F)) \rightarrow \mathcal{S}(V_{n + 1}(\mathbb{A}_F))$, where the action is extended from the subspace
  \begin{equation*}
    \mathcal{S}(V_{n + 1}(\mathbb{A}_F)) \supseteq \mathcal{S}(V_n(\mathbb{A}_F)) \otimes \mathcal{S}(\mathbb{A}_F^2)
  \end{equation*}
  Then you get a map (see \cite{MR4887846})
  \begin{equation*}
    I : \mathcal{S}(V_{n + 1}(\mathbb{A}_F))_{r(\mathrm{SL}_2(\mathbb{A}_F))} \rightarrow C^\infty(Y_n^{\circ}(\mathbb{A}_F)).
  \end{equation*}
  Note that $V_{n + 1}$ is \emph{not} spherical for $\O_n$.  It is not even homogeneous - the orthogonal group does not act transitively on $V_n$.  Nevertheless, after we take these coinvariants, we obtain a summation formula for the $\GO_n$-spherical variety $Y_n$.  The Fourier transform in this case just comes a Fourier transform on a big vector space.

  There's a more complicated example, sort of combining this example with that of the Siegel parabolic, due to Getz--Liu \cite{MR3916514}.
\end{example}

\subsubsection{Fiber bundle method}

Assume given affine $G$-schemes $B_i$ and equivariant maps $p_i : X \rightarrow B_i$, fitting into a diagram
\begin{equation*}
  \begin{tikzcd}
    & X \arrow[dl, "p_1"'] \arrow[dr, "p_2"] & \\
    B_1 & & B_2
  \end{tikzcd}
\end{equation*}
Assume given compatible Poisson summation formulae for the fibers of $p_1$ and $p_2$.  Then we get the Poisson summation formulae for $X$.

Say this is a vector bundle, for example.  Then you can just do Poisson summation on all the vector spaces, and as long as the group action preserves everything, you get a Poisson summation for the whole thing.  (That's kind of interesting -- maybe you don't think about Poisson summation formulas in families.)  But it's more interesting when you have two of these and can combine them.  Let's give a simple example saying what you can get out of this, which is very rich.

\begin{example}
   Take
   \begin{equation*}
    X = \overline{(N \backslash \mathrm{SL}_3)}^{\mathrm{aff}}.
  \end{equation*}
  Let $V = \mathbb{G}_a^3$ and let $V^\vee := \Hom(V, \mathbb{G}_a)$.  It's not hard to verify that we can identify
  \begin{equation*}
    X(R) = \left\{(v, v^\vee) \in V(R) \times V^\vee(R) : v^\vee(v) = 0 \right\}.
  \end{equation*}
  So it's another one of these cones.  In this picture, we have our little diagram again:
  \begin{equation*}
    \begin{tikzcd}
      & X \arrow[dl, "p_1"'] \arrow[dr, "p_2"] & \\
      V & & V^\vee
    \end{tikzcd}
  \end{equation*}
  One Fourier transform is given by
  \begin{equation*}
    \mathcal{F}_1(f)(v, v^\vee) = \int_{(V^\vee)^{\perp}(F)} f(v ', v^\vee)
    \psi \left( \frac{v \wedge v '}{v^\vee} \right)
    \, \frac{d v'}{d v^\vee},
  \end{equation*}
  being a bit liberal here with notation in order to make the equivariance properties more transparent, e.g., in the argument of $\psi$, we think of $v \wedge v '$ as defining the linear map
  \begin{equation*}
    x \mapsto \frac{v \wedge v ' \wedge x}{e_1 \wedge e_2 \wedge e_3},
  \end{equation*}
  which is then a functional that we can then divide by $v^\vee$.  For $\mathcal{F}_2$, you exchange the roles of $v$ and $v^\vee$ in the above expression.  The operators $\mathcal{F}_1$ and $\mathcal{F}_2$ extend to $L^2(X^\circ(F))$ (there is an $\mathrm{SL}_3$-invariant measure on this), and generate a subgroup of $\Aut(L^2(X^{\circ}(F)))$ isomorphic to $S_3$.  The latter is really the Weyl group $W$ of a maximal torus in $\mathrm{SL}_3$ -- the two Fourier transforms correspond to simple reflections.  This tells us that we can define $\mathcal{F}_w$ for $w \in W$.  Let
  \begin{equation*}
    \mathcal{S}_{\mathrm{B K}}(X(F_v)) = \bigoplus_{w \in W}
    \mathcal{F}_w(\mathcal{S}(X^{\circ}(F_v))).
  \end{equation*}
  This is a bit of a cheat, but it's obviously invariant under all the Fourier transforms now.  We can think of this as living inside $L^2(X^{\circ}(F))$.

  We can adelize.  We get Poisson summation formulae for $X$, with a whole non-abelian group of Fourier transforms.

  This example gives you \emph{hidden equivariance}.  You'll notice that this space is an example of the space from Example \ref{example:cq6ud5xqwu}, just realized differently.  You can ask, what is the relationship between the two? Let $P \subset \SO_6$ be the stabilizer of an isotropic vector.  Then
  \begin{equation*}
    \overline{P^{\mathrm{der}} \backslash \SO_6}^{\mathrm{aff}} = \overline{(N \backslash \SL_3)}^{\mathrm{aff}}.
  \end{equation*}
  The Schwartz spaces are the same.  But the actions are different - on the left, there is an action of $\mathbb{G}_m \times \SO_6$ (here $\mathbb{G}_m = P / P^{\mathrm{der}}$), while on the right, we have an action of $\mathbb{G}_m^2 \times \mathrm{SL}_3$ (here $\mathbb{G}_m^2 = T \leq \mathrm{SL}_3$ is the diagonal torus).  Now, $\mathcal{F}_1$ and $\mathcal{F}_2$ do \emph{not} commute with the action of $\SO_6$, but the long Weyl element for $\mathrm{SL}_3$ defines the operator $\mathcal{F}_1 \mathcal{F}_2 \mathcal{F}_1$, which \emph{does} commute with that action and defines the Fourier transform arising naturally on the left.

  The moral is that sometimes one can build equivariant Fourier transforms by composing non-equivariant Fourier transforms.
\end{example}

\subsection{Integral representations of triple product $L$-functions}

Maybe in the last five minutes, we'll try to say something about what we do in the preprint \cite{2025arXiv2503.21648}.  Let $\underline{r} =(r_1, r_2, r_3)$ be as before, and $\mathrm{GL}_{\underline{r}} = \prod_{i = 1}^3\mathrm{GL}_{r_i}$.  Let
\begin{equation*}
  H(R) := \{(h_1, h_2, h_3) \in \mathrm{GL}_{\underline{r}}(R) \mid \det h_1 = \det h_2 = \det h_3\}.
\end{equation*}
We construct an affine $\Psi$-bundle
\begin{equation*}
  \mathcal{V}^{\circ} \rightarrow X \times Y
\end{equation*}
equipped with an action of $\mathrm{GL}_{\underline{r}} \times\mathrm{GL}_{\underline{r - 2}} \times H$.  We assume that $f \in C^\infty(X^{\circ}(\mathbb{A}_F) \times Y^{\circ}(\mathbb{A}_F), \mathcal{L}_\psi)$.  We can then form the theta function
\begin{equation*}
  \theta_f(g, g', h) := \sum_{
    (x, y) \in 
    X^{\circ}(F) \times Y^{\circ}(F)
  }
  \mathcal{R}(g, g', h) f(x, y).
\end{equation*}
For $\varphi \in \pi$ on $\mathrm{GL}_{\underline{r}}(\mathbb{A}_F)$, $\varphi ' \in \pi '$ on $\mathrm{GL}_{\underline{r - 2}}(\mathbb{A}_F)$ and $s \in \mathbb{C}$ and $\underline{s} \in \mathbb{C}^3$, we define a zeta integral
\begin{equation*}
  Z(f, \varphi, \varphi ', s, \underline{s})
  := \int_{[\mathrm{GL}_{\underline{r}} \times\mathrm{GL}_{\underline{r - 2}}] \times[H^{\circ}]}
  \theta_f(g, g', h)
  \varphi(g) \varphi '(g')
  \eta_{s, \underline{s}}(g', h)
  \, d g \, d g' \, d h,
\end{equation*}
with $\eta_{s, \underline{s}}$ a suitable quasi-character.
\begin{theorem}[Getz--Gu--Hsu--Leslie]
  \begin{enumerate}
  \item This zeta integral is a holomorphic multiple of
    \begin{equation*}
      L(s + \tfrac{1}{2}, \pi^\vee, \otimes^3)
      \prod_{i = 1}^3 L(\tfrac{1}{2} + s + \frac{s_i - s_{i + 1} - s_{i + 2}}{r_i - 2}, \pi_i \times \pi_i ')
      L(\tfrac{1}{2} + s_i, \pi_i).
    \end{equation*}

  \item The Poisson summation conjecture for $X \times Y$ implies the meromorphic continuation of the above.
  \end{enumerate}
\end{theorem}
If you were looking at this with a critical eye and knew something about the subject, you could just say, well, use the reductive monoid attached to the triple product, for which the Poisson summation conjecture implies the meromorphic continuation.  So what have you really done?  What we argue is that the space $X \times Y$ is designed so that one can apply the techniques discussed earlier in this lecture, e.g., the fiber bundle method, to get going.  On the other hand, at least far as the speaker can see, there is no known way of attacking the Poisson summation conjecture directly on reductive monoids.  The only real idea we have is to push it to the trace formula and try to work there.


\section{Chen Wan's lectures}\label{sec:cq6tho3cpy}

We'll focus on the \emph{period} aspect of the relative Langlands duality of Ben-Zvi--Sakellaridis--Venkatesh.  Recall from Chris's talk that we saw something about integral representations of $L$-functions, which involves integrating automorphic forms $\phi$ on some larger space $Y$ over some smaller space $X$.  In nice cases, such integrals represent $L$-functions:
\begin{equation}\label{eq:cq6tg8d3hf}
  \int_X (\phi, \text{ automorphic form on $Y \supseteq X$}) = \text{$L$-function}.
\end{equation}
We've seen in previous lectures that if you have this sort of integral representation of $L$-functions, then you can use it to study the meromorphic continuation of $L$-functions, or their special values.  Such identities are thus very useful.

The examples might seem a bit \emph{ad hoc}.  Why should we integrate automorphic forms on $Y$ over $X$, for certain pairs $(X, Y)$?  Is there some way to systematically find, for a given $L$-function, which integrals represent them?  Can we determine systematically which $L$-functions are represented by some integral?  The theory of relative Langlands duality at least gives some explanation of this in some cases.  This is what we'll talk about in our lectures.

Let's first say the rough idea.  If you look at this kind of integral \eqref{eq:cq6tg8d3hf}, it's kind of an automorphic integral involving the quotient variety $\mathcal{M} = Y / X$ (whatever this means).  Relative Langlands duality generalizes the classical Langlands correspondence to varieties: one passes from $\mathcal{M}$ to some dual variety $\hat{\mathcal{M}}$, and the proposal in relative Langlands duality is that
\begin{equation*}
  (\text{automorphic integral on } \mathcal{M})
  = 
  (\text{$L$-function associated to } \hat{\mathcal{M}}).
\end{equation*}
Moreover, it's a duality, which means that the same holds with the roles of $\mathcal{M}$ and $\hat{\mathcal{M}}$ reversed:
\begin{equation*}
  (\text{automorphic integral on } \hat{\mathcal{M}})
  = 
  (\text{$L$-function associated to } \mathcal{M}).
\end{equation*}
Everything is general at this point -- later, we'll say precisely what it means.  But the idea is that at least in terms of periods integrals of automorphic forms, you have certain nice Hamiltonian spaces and dualities between them so that the integrals attached to one space are given by the $L$-functions attached to the other.

Let's now set up some notation.  We'll first define the automorphic integrals associated to this data, and if there's time, the $L$-functions and the duality.  Let $K$ be a global field, and $\mathbb{A} = \mathbb{A}_K$ the ring of adeles.  Sometimes we'll also work over a local field $F$, (e.g., $\mathbb{R}, \mathbb{C}, \mathbb{Q}_p, \dotsc$).  Let $G$ be a connected reductive group defined over $K$.  (If you're not familiar with this language, you can just think of the matrix groups that you're familiar with, such as $\mathrm{GL}_n$, $\mathrm{SL}_n$, $\mathrm{PGL}_n$, $\SO_n$, $\Sp_{2 n}$.)  Throughout these lectures, we'll mostly focus on the groups that are \emph{split}, i.e., that have a maximal split torus.

The foundation of the Langlands program is based on the duality between these reductive groups.  For each such group $G$, we can write down its dual group $\hat{G}$.  Reductive groups are parametrized by root data.  For each root data, you can take its dual root data, which then defines the dual group:
\begin{tabular}{|c|c|}
  \hline
  $G$ & $\hat{G}$ \\
  \hline \hline
  $\mathrm{GL}_n$ & $\mathrm{GL}_n$ \\
  \hline
  $\mathrm{SL}_n$ & $\mathrm{PGL}_n$ \\
  \hline
  $\mathrm{SO}_{2n+1}$ & $\mathrm{Sp}_{2n}$ \\
  \hline
  $\mathrm{SO}_{2n}$ & $\mathrm{SO}_{2n}$ \\
  \hline
\end{tabular}

The \emph{Langlands conjecture} says roughly that automorphic representations of $G(\mathbb{A})$ should correspond to Langlands parameters $\phi : L_K \rightarrow \hat{G}(\mathbb{C})$ valued in the dual group, and similalry with $G$ and $\hat{G}$ swapped.

\begin{definition}\label{definition:cq6tho3qgh}
  A \emph{BZSV quadruple} for $G$ is $\Delta =(G, H, \iota, \rho_H)$, where
  \begin{enumerate}
  \item\label{enumerate:cq6tg8um5h} $H \subset G$ is a split connected reductive subgroup,
  \item\label{enumerate:cq6tg8uyi6} $\iota : \mathrm{SL}_2 \rightarrow G$ is a homomorphism (possibly trivial) such that $H$ commutes with $\operatorname{image}(\iota)$, so that we may extend to $\iota : H \times \mathrm{SL}_2 \rightarrow G$.
  \item\label{enumerate:cq6tg8wpyk} $\rho_H$ is a symplectic representation of $H$, i.e., a homomorphism $H \rightarrow \mathrm{Sp}(V)$.
  \end{enumerate}
\end{definition}
Define the automorphic quotient $[G] := G(K) \backslash G(\mathbb{A})$, and let $\phi :[G] \rightarrow \mathbb{C}$ be an automorphic form.  The goal today is to define the period integral $\mathcal{P}_\Delta(\phi)$ associated to a quadruple $\Delta$ as above.

Let's start with some easy special cases, before moving to the general case.
\begin{enumerate}
\item\label{enumerate:cq6tg85st6} Suppose $\iota = 1$ (the trivial representation, $\mathbb{C}$) and $\rho_H = 0$ (the \emph{zero-dimensional} symplectic representation $\{0\}$), thus $\Delta =(G, H, 1, 0)$.  Then
  \begin{equation*}
    \mathcal{P}_\Delta(\phi) := \int_{[H]} \phi(h) \, d h.
  \end{equation*}
  (In general, this does not converge and must be understood via truncation, etc.)
\item\label{enumerate:cq6tg85t0e} Suppose still that $\iota = 1$ is trivial, but allow $\rho_H$ to be general.  Then
  \begin{equation*}
    \mathcal{P}_\Delta(\phi) := \int_{[H]} \phi(h) \cdot \Theta_{\rho_H}(h) \, d h,
  \end{equation*}
  where $\Theta_{\rho_H}$ is a suitable theta function, whose definition depends also upon the choice of a Schwartz function:
  \begin{enumerate}[(a)]
  \item\label{enumerate:cq6thb0l6i} It's easiest to define in the special \emph{polarized} case that $\rho_H = \tau \oplus \tau^\vee$ for some $\tau : H \rightarrow\mathrm{GL}(W)$.  In that case, after choosing $\varphi \in \mathcal{S}(W(\mathbb{A}))$, we define
    \begin{equation*}
      \Theta_{\rho_H}(h) := \sum_{x \in W(F)} \varphi(\tau(h) x).
    \end{equation*}
    To illustrate that case, we consider a couple examples:
    \begin{enumerate}[(i)]
    \item\label{enumerate:cq6thb0n66} Suppose
      \begin{equation*}
        \Delta =(\mathrm{GL}_n \times \mathrm{GL}_n, \mathrm{GL}_n \times \mathrm{GL}_n, 1, \mathrm{std} \otimes \mathrm{std \oplus(\mathrm{std} \otimes \mathrm{std})^\vee})
      \end{equation*}
      Then, writing $\phi = \phi_1 \otimes \phi_2$ with each $\phi_i :[\mathrm{GL}_n] \rightarrow \mathbb{C}$, we may take $W = \Mat_{n \times n}$ above (the space of $n \times n$ matrices), and we obtain
      \begin{equation*}
        \mathcal{P}_\Delta(\phi) := \int_{[\mathrm{GL}_n] \times[\mathrm{GL}_n]} \phi_1(h_1) \phi_2(h_2) \sum_{x \in \Mat_{n \times n}(F)}
        \varphi(h_1^{-1} x h_2) \, d h_1 \, d h_2.
      \end{equation*}
    \item\label{enumerate:cq6thb0ptu} Take $\Delta =(\mathrm{GL}_n \times \mathrm{GL}_n, \mathrm{GL}_n^{\mathrm{diag}}, 1, \mathrm{std} \oplus \mathrm{std}^\vee)$.  Then, taking $W$ to be the $n$-dimensional vector space on which $\mathrm{GL}_n$ acts by right multiplication, we obtain
      \begin{equation*}
        \mathcal{P}_\Delta(\phi) := \int_{[\mathrm{GL}_n]} \phi_1(h) \phi_2(h) \sum_{x \in W(K)}
        \varphi(x h) \, d h,
      \end{equation*}
      which is the Rankin--Selberg integral for $\mathrm{GL}_n \times \mathrm{GL}_n$.
    \end{enumerate}
  \item\label{enumerate:cq6thb0m6q} In general, $\rho_H : H \rightarrow \Sp(V)$ induces the so-called Weil representation, which may be realized on $\mathcal{S}(Y(\mathbb{A}))$ for a maximal isotropic subspace $Y$ of $V$.  As you may know, the Weil representation is not on $\Sp(V)$, but on its double cover.  So you can't do it for an arbitrary symplectic representation -- need a condition called ``anomaly-free'' that allows you to resolve the ambiguity, but let's not go into the details there.  There is anyway some condition under which we can split the Weil representation over $H$, giving a well-defined representation.  The splitting is not necessarily unique, and perhaps BZSV do not currently choose a canonical splitting, but it's expected that there is some natural splitting.  Of course there is such a natural splitting in the polarized case.  In any event, one then sets, for $h \in H(\mathbb{A})$ and $\varphi \in \mathcal{S}(Y(\mathbb{A}))$,
    \begin{equation*}
      \Theta_{\rho_H}(h) := \sum_{x \in Y(K)} \Omega_{\rho_H}(h) \varphi(x).
    \end{equation*}
  \end{enumerate}
\item\label{enumerate:cq6thb84py} In the fully general case, we define
  \begin{equation}\label{eq:cq6thc4107}
    \mathcal{P}_\Delta(\phi) := \int_{[H]} \mathcal{P}_\iota(\phi)(h) \Theta_{\rho_H}(h) \, d h.
  \end{equation}
  Here $\mathcal{P}_\iota$ is the Fourier coefficient of $\phi$ associated to $\iota$, defined as follows.  We first recall that $\iota : \mathrm{SL}_2 \rightarrow G$.  In particular, we can let $L := \mathrm{Cent}_G(\operatorname{image}(\iota(T_{\mathrm{SL}_2})))$, with $T_{\mathrm{SL}_2} \leq \mathrm{SL}_2$ the diagonal maximal torus consisting of elements of the form $\diag(t, t^{-1})$.  Then $L$ is a Levi subgroup of $G$.  We also know, since $H$ commutes with the image of $\iota$, that $H$ is a subgroup of $L$.  Now let $U := \exp(\mathfrak{u})$, where $\mathfrak{u}$ is the positive weight space for $\Ad(\iota(\diag(t, t^{-1})))$.  We also define $\bar{U} := \exp(\bar{\mathfrak{u}})$, with $\mathfrak{u}$ the negative weight space.
  \begin{example}\label{example:cq6ueb2rz1}
    Take $G = \mathrm{GL}_{2 n}$ and $\iota : \mathrm{SL}_2 \rightarrow \mathrm{GL}_{2 n}$ given by
    \begin{equation*}
      \begin{pmatrix}
        t      &  \\
               & t^{-1} \\
      \end{pmatrix}
      \mapsto
      \begin{pmatrix}
        t I_n      &  \\
                   & t^{-1} I_n \\
      \end{pmatrix},
    \end{equation*}
    \begin{equation*}
      \begin{pmatrix}
        1 & 1 \\
          & 1 \\
      \end{pmatrix}
      \mapsto
      \begin{pmatrix}
        I_n      &  I_n \\
                 & I_n \\
      \end{pmatrix},
    \end{equation*}
    \begin{equation*}
      \begin{pmatrix}
        1      &  \\
        1 & 1 \\
      \end{pmatrix}
      \mapsto
      \begin{pmatrix}
        I_n      &  \\
        I_n &  I_n \\
      \end{pmatrix}.
    \end{equation*}
    Then
    \begin{equation*}
      L = \left\{
        \begin{pmatrix}
          a          &  \\
                     & b \\
        \end{pmatrix} : a, b \in \mathrm{GL}_n \right\},
      \quad
      U = \left\{
        \begin{pmatrix}
          I_n          & \ast \\
                       & I_n \\
        \end{pmatrix} \right\},
      \quad
      \bar{U} = \left\{
        \begin{pmatrix}
          I_n          &  \\
          \ast          & I_n \\
        \end{pmatrix} \right\}.
    \end{equation*}
  \end{example}

  If $\iota$ is even (i.e., all the weights of $\Ad(\iota(\diag(t, t^{-1})))$ are even), then the Fourier coefficient is given by a very easy formula:
  \begin{equation}\label{eq:cq6thc26pn}
    \mathcal{P}_\iota(\phi)(h) := \int_{[U]} \phi(u h) \xi(u)^{-1} \, d u,
  \end{equation}
  where $\xi :[U] \rightarrow \mathbb{C}^\times$ is a character defined, for $x \in \mathfrak{u}(\mathbb{A})$, by
  \begin{equation*}
    \xi(\exp(x)) := \psi \bigl( \langle x, \iota \left(
      \begin{smallmatrix}
        0&0\\
        1&0 \\
      \end{smallmatrix}
    \right) \rangle \bigr),
  \end{equation*}
  where $\psi : K \backslash \mathbb{A} \rightarrow \mathbb{C}^\times$ is some fixed character.
  \begin{example}\label{example:cq6ueb2vh0}
    In the above example,
    \begin{equation*}
      \xi
      \begin{pmatrix}
        I_n    & x \\
                                                                                        & I_n \\
      \end{pmatrix}
      = \psi \left( \left\langle
          \begin{pmatrix}
            0        & x \\
            0 & 0 \\
          \end{pmatrix},
          \begin{pmatrix}
            0        & 0 \\
            1 & 0 \\
          \end{pmatrix} \right\rangle \right)
      = \psi(\trace(x)).
    \end{equation*}
  \end{example}
  \begin{exercise}\label{exercise:cq6ueb2mev}
    Let $G := \mathrm{GL}_n$ and $\iota : \mathrm{SL}_2 \rightarrow \mathrm{GL}_n$ be $\rho_{\sym}^{n - 1}$.  Then write down the Fourier coefficient $\mathcal{P}_\iota(\phi)$.
  \end{exercise}

  If $\iota$ is \emph{not} even, then we have a Weil representation $\Omega_\iota$ of $U(\mathbb{A})$ on $\mathcal{S}(Z(\mathbb{A}))$, where $Z$ is a maximal isotropic subspace of the weight $1$ space of $\Ad(\iota(\diag(t, t^{-1})))$.  Then we build another theta kernal $\Theta_\iota(u) := \sum_{x \in Z(K)} \Omega_\iota(u) \varphi(x)$, where $\varphi \in \mathcal{S}(Z(\mathbb{A}))$.  The period integral (depending upon $\varphi$) is then given by integrating not just against a character as in \eqref{eq:cq6thc26pn}, but against the theta function:
  \begin{equation}\label{eq:cq6thc48wh}
    \mathcal{P}_\iota(\phi) := \int_{[U]} \phi(u) \Theta_{\iota}(u) \, d u.
  \end{equation}

  So, in the integral $\mathcal{P}_\Delta(\phi)$, there are possibly two different choices of Schwartz functions: one in the theta kernel in \eqref{eq:cq6thc4107}, and another in the theta kernel in \eqref{eq:cq6thc48wh}.  But in some special cases ($\iota$ trivial or even), we don't need these.
\end{enumerate}

\begin{example}\label{example:cq6tho3o9b}
  Take $\Delta =(G, H, \iota, \rho_H)$, where
  \begin{equation*}
    G =\mathrm{GL}_{2 n},
  \end{equation*}
  \begin{equation*}
    H = \mathrm{GL}_n = \left\{
      \begin{pmatrix}
        h        &  \\
                 & h \\
      \end{pmatrix} \mid h \in \mathrm{GL}_n \right\},
  \end{equation*}
  $\rho_H = 0$ and
  \begin{equation*}
    \iota :
    \begin{pmatrix}
      t      &  \\
             & t^{-1} \\
    \end{pmatrix}
    \mapsto
    \begin{pmatrix}
      t I_n &  \\
            & t^{-1} I_n \\
    \end{pmatrix},
    \quad
    \begin{pmatrix}
      1 & 1 \\
        & 1 \\
    \end{pmatrix}
    \mapsto
    \begin{pmatrix}
      I_n      & I_n \\
               & I_n \\
    \end{pmatrix}.
  \end{equation*}
  Then
  \begin{equation*}
    \mathcal{P}_\Delta(\phi) =
    \int_{[\mathrm{GL}_n] / \mathrm{GL}_1(\mathbb{A})}
    \int_{[\Mat_{n \times n}]} \phi \left(
      \begin{pmatrix}
        I_n      & x \\
                 & I_n \\
      \end{pmatrix}
      \begin{pmatrix}
        h &  \\
          & h \\
      \end{pmatrix}      
    \right)
    \psi(\trace(x))^{-1} \, d x
    \, d h,
  \end{equation*}
  which is relevant for the \emph{Shalika model}.
\end{example}

\begin{exercise}\label{exercise:cq6tho3oca}
  For $G = \mathrm{GL}_6$, find $\Delta$ for which $\mathcal{P}_\Delta(\phi)$ is given by
  \begin{equation*}
    \int_{[\mathrm{GL}_2]} \int_{[\Mat_{2 \times 2}^3]} \phi
    \left(
      \begin{pmatrix}
        I_2      & X & Z \\
                 & I_2 & Y \\
                 &  & I_2 \\
      \end{pmatrix}
      \begin{pmatrix}
        h      &  &  \\
               & h &  \\
               &  & h \\
      \end{pmatrix}\right)
    \psi(\trace(X + Y))^{-1}
    \, d X \, d Y \, d Z \, d h.
  \end{equation*}
\end{exercise}

\begin{example}\label{example:cq6tho3m7k}
  $\iota : \mathrm{SL}_2 \rightarrow \mathrm{GL}_3$ given by $h \mapsto \diag(h, 1)$ is \emph{not} even, because we get odd weight spaces for $\diag(t, t^{-1}, 1)$ acting via the adjoint representation for $\mathrm{GL}_3$.
\end{example}

Continuing, let $G$ be be a split connected reductive group over $K$.  Recall that a BZSV quadruple is $\Delta =(G, H, \iota, \rho_H)$, where $H \subset G$ is a split connected reductive group, $\iota : \mathrm{SL}_2 \rightarrow G$ has image commuting with $H$, and $\rho_H : H \rightarrow \Sp(V)$ is a symplectic representation.  Then, given $\phi :[G] \rightarrow \mathbb{C}$, we defined
\begin{equation*}
  \mathcal{P}_\Delta(\phi) := \int_{[H]} \mathcal{P}_\iota(\phi)(h) \Theta_{\rho_H}(h) \, d h.
\end{equation*}
We recall also that there were Schwartz functions entering into this definition, but we omit this from our notation for simplicity.

There will be some conditions that one can impose on these quadruples, called \emph{hyperspherical} and \emph{anomaly-free}.  Under these conditions, \emph{relative Langlands duality} is a conjecture saying that there should be a duality between such quadruples
\begin{equation}\label{eq:cq6txrs6zo}
  \Delta =(G, H, \iota, \rho_H) \leftrightarrow
  \hat{\Delta} =
  (\hat{G}, \hat{H}', \hat{\iota}', \rho_{\hat{H}'}).
\end{equation}
\begin{remark}\label{remark:cq6txru6kw}
  In general, for the duality, with $\Delta$ dual to $\hat{\Delta}$, one is a quadruple for $G$, while the other is a quadruple for $\hat{G}$.  But the other three data should be viewed as a whole, i.e., $(H, \iota, \rho_H)$ is dual to $(\hat{H}', \hat{\iota}', \rho_{\hat{H}'})$, but the duality is not defined at the level of individual entries in these tuples.
\end{remark}

There are then several conjectures that one can associate to this duality.  In my talk, we will focus on the \emph{period integral conjecture} of BZSV.  If you want to summarize it in one line, it says that if you have one quadruple that is dual to another one, then the period for $\Delta$ should be roughly equal to the $L$-function for $\hat{\Delta}$, and vice-versa:
\begin{equation*}
  P_{\Delta} = L_{\hat{\Delta}}, \qquad
  P_{\hat{\Delta}} = L_{\Delta}.
\end{equation*}
So far for this whole picture, we only did one thing, which is we defined the period.  We next need to define the $L$-functions, and then explain which quadruples should admit such a duality.  (One should not expect a duality for arbitrary quadruples.)

We'll next define define the $L$-functions.  We recall that, because the image of $\iota$ commutes with $H$, the map $\iota$ extends to $\iota : H \times \mathrm{SL}_2 \rightarrow G$.  Using this homomorphism and the adjoint action, we get an action of $H \times \mathrm{SL}_2$ on $\Lie(G)$.  We may thus decompose
\begin{equation*}
  \mathfrak{g} = \bigoplus_{k \geq 0} \rho_k \otimes \Sym^k,
\end{equation*}
where the $\rho_k$ are representations of $H$.  Now the adjoint representation of $G$ on its whole Lie algebra is an orthogonal representation (because it fixes the Killing form), but if you look at the symmetric powers $\Sym^k$ of $\mathrm{SL}_2$, when $k$ is even, it is an orthogonal representation, while when $k$ is odd, is a symplectic representation.  Since the tensor should be of orthogonal type, we also know that $\rho_k$ is orthogonal (resp.\ symplectic) when $k$ is even (resp.\ odd).

We can do the same thing for the dual side of \eqref{eq:cq6txrs6zo}, i.e., using $\hat{\iota} ' : \hat{H} ' \times \mathrm{SL}_2 \rightarrow G$, we get
\begin{equation*}
  \hat{\mathfrak{g}} = \bigoplus_{k \geq 0}
  \hat{\rho}_K \otimes \Sym^k,
\end{equation*}
with $\hat{\rho}_K$ a representation of $\hat{H}'$.

We can now state the \emph{period integral conjecture of BZSV}.
\begin{enumerate}
\item Let $\pi$ be a discrete automorphic representation of $G(\mathbb{A})$.  Let $\nu : \pi \rightarrow L^2([G])$.  Then $\mathcal{P}_\Delta(\phi) \neq 0$ for some $\phi \in \image(\nu)$ only if the Arthur parameter of $\pi$ factors through
  \begin{equation*}
    \hat{\iota}' : \hat{H}'(\mathbb{C}) \times \mathrm{SL}_2(\mathbb{C}) \rightarrow \hat{G}(\mathbb{C}).
  \end{equation*}
  To be a bit more precise, recall that the Arthur parameter for $\pi$ is (conjecturally) a map $\omega_\pi : L_K \times \mathrm{SL}_2(\mathbb{C}) \rightarrow \hat{G}(\mathbb{C})$, where $L_K$ is the conjectural Langlands group.  The meaning of ``factors through'' is then that there exists an Arthur parameter $\omega_\sigma : L_K \times \mathrm{SL}_2(\mathbb{C}) \rightarrow \hat{H}'(\mathbb{C})$ (of an automorphic representation $\sigma$ of $H '(\mathbb{A})$) such that
  \begin{equation*}
    \omega_\pi = \hat{\iota} ' \circ (\omega_\sigma \times \id_{\SL_2}),
  \end{equation*}
  fitting into a commutative diagram
  \begin{equation*}
    \begin{tikzcd}
      L_K \times \mathrm{SL}_2(\mathbb{C}) \arrow[r, "\omega_\pi"] \arrow[d, "\omega_\sigma"', dashed] & \hat{G}(\mathbb{C}) \\
      \hat{H}'(\mathbb{C}) \times \mathrm{SL}_2(\mathbb{C}) \arrow[ur, "\hat{\iota}'"'] &
    \end{tikzcd}
  \end{equation*}
  The content of ``factors through'' is thus that $\pi$ is the Langlands functorial transfer of an automorphic representation $\sigma$ of $H '(\mathbb{A})$.  Assume that this is the case, and assume that $\sigma$ is tempered (i.e., that $\omega_\sigma |_{\mathrm{SL}_2(\mathbb{C})} \equiv 1$).  Then we can choose $\nu$ such that
  \begin{equation*}
    \left\lvert \mathcal{P}_\Delta(\phi) \right\rvert^2
    \doteq
    \frac{
      L(\tfrac{1}{2}, \sigma, \rho_{\hat{H}'})
      \prod_{k \geq 0} L(\frac{k}{2} + 1, \sigma, \hat{\rho}_K)}{L(1, \sigma, \Ad)^2}.
  \end{equation*}
  In other words, on the dual side, we get two things from $\hat{H}'$ and $\hat{\iota}'$.  It first gives you functoriality, i.e., the period is nonzero only if it factors through $\hat{\iota}'$.  It also gives you the grading into $k$'s and the second factor in the numerator.  Finally, the symplectic representation gives you $L$-values at $1/2$.

  The equal sign is dotted because there are several other factors, e.g. volume terms, quantities depending upon the sizes of Arthur packets, etc.
\item Conversely, $\mathcal{P}_{\hat{\Delta}}$ is ``equal'' to $L_\Delta$.
\end{enumerate}
Two special cases:
\begin{enumerate}
\item\label{enumerate:cq6txwuycw} $\hat{\Delta} =(\hat{G}, \hat{H}', 1, 0)$.  Then the conjecture says that $\mathcal{P}_\Delta(\phi)$ detects the functoriality from $H'(\mathbb{A})$ to $G(\mathbb{A})$.  For instance, suppose (as discussed earlier) $\Delta =(\mathrm{GL}_{2 n}, \mathrm{GL}_n,(2^n), 0)$, where $\mathrm{GL}_n$ is embedded like $\diag(h, h)$, and $(2^n)$ means we take $\iota : \diag(t, t^{-1}) \mapsto \diag(t I_n, t^{-1} I_n)$.  Then $\hat{\Delta} =(\mathrm{GL}_{2 n}, \Sp_{2 n}, 1, 0)$.  Thus $\mathcal{P}_\Delta \neq 0$ only if $\phi$ comes from the functorial lifting from $\SO_{2 n + 1}(\mathbb{A})$ to $\mathrm{GL}_{2 n}(\mathbb{A})$.
\item\label{enumerate:cq6txwu9pz} Let's consider next the case where $\hat{\Delta} =(\hat{G}, \hat{G}, 1, \hat{\rho}_{\hat{G}})$, i.e., we only have a symplectic representation (but no $\mathrm{SL}_2$ representation).  Then the conditions simplify and what we get is that
  \begin{equation*}
    \left\lvert \mathcal{P}_\Delta(\phi) \right\rvert^2 \doteq \frac{L(\tfrac{1}{2}, \pi, \hat{\rho}_{\hat{G}})}{L(1, \pi, \Ad)}.
  \end{equation*}
  In other words, in this case, the period corresponds to a special value of $L$-functions.
\end{enumerate}
The general case will be some combination of these two cases: some detection of functoriality, and some special values.

\begin{exercise}\label{exercise:cq6txvu33z}
  Check this for $\Delta =(\mathrm{GL}_n \times \mathrm{GL}_n, \mathrm{GL}_n \times \mathrm{GL}_n, 1,(\std \otimes \std)^\vee \oplus(\std \otimes \std))$ and $\hat{\Delta} =(\mathrm{GL}_n \times \mathrm{GL}_n, \mathrm{GL}_n, 1, \std \oplus \std^\vee)$, where it corresponds to the results of Godement--Jacquet and Rankin--Selberg.
\end{exercise}

This is now the rough statement of the period conjecture, but we still haven't said exactly what things are dual to each other, and which categories we're working with (i.e., which quadruples).  Let's now discuss that point.  We continue to fix our $G$ and $\hat{G}$.  The relative Langlands duality goes between \emph{smooth, anomaly-free, hyperspherical Hamiltonian spaces} $\mathcal{M} \leftrightarrow \hat{\mathcal{M}}$ for $G$ and $\hat{G}$, respectively.  Let's explain how to attach, to a quadruple $\Delta =(G, H, \iota, \rho_H)$, a $G$-Hamiltonian space $\mathcal{M}_\Delta$.  The association is easy to understand in special cases:
\begin{enumerate}
\item $\Delta =(G, H, 1, 0)$.  Then $\mathcal{M}_\Delta = T^\ast(G / H)$ is just the cotangent bundle.
\item $\Delta =(G, G, 1, \rho_G)$, where $\rho_G : G \rightarrow \Sp(V)$.  Then $\mathcal{M}_\Delta = V$.
\item Combining these two cases together, take $\Delta =(G, H, 1, \rho_H)$, where $\rho_H : H \rightarrow \Sp(V)$.  Then $\mathcal{M}_\Delta =(V \times_{\mathfrak{h}^\ast} \mathfrak{g}^\ast) \times^H G$.  Here $V \times_{\mathfrak{h}^\ast} \mathfrak{g}^\ast$ is the fiber product, where $V \rightarrow \mathfrak{h}^\ast$ is the moment map (coming from the symplectic action of $H$).  (This is sometimes called ``symplectic induction''.)
\end{enumerate}
In general, recall that $\iota$ gives $L = \Cent_G(\iota(\diag(t, t^{-1})))$ and $U = \exp(\mathfrak{u})$, where $\mathfrak{u}$ is the positive weight space for $\Ad(\iota(\diag(t, t^{-1})))$.  Let $\mathfrak{u}_+ \subseteq \mathfrak{u}$ denote the weight $\geq 2$ space.  Then $\mathfrak{u} / \mathfrak{u}_+$ is the weight one space.  (We remark that $\mathfrak{u} / \mathfrak{u}_+ = \{0\}$ if and only if $\iota$ is even in the terminology introduced earlier.)  The quotient $\mathfrak{u} / \mathfrak{u}_+$ is a symplectic vector space.
\begin{equation*}
  \mathcal{M}_\Delta = \left(
    (V \times \mathfrak{u} / \mathfrak{u}_+)
    \times_{(\mathfrak{h} + \mathfrak{u})^\ast}
    \mathfrak{g}^\ast\right)
  \times^{H U}
  G.
\end{equation*}

We have $\mathfrak{u} / \mathfrak{u}_+ \rightarrow \mathfrak{u}^\ast$ via $x \mapsto \kappa(x) + \kappa_f$, where $\kappa : \mathfrak{u} / \mathfrak{u}_+ \rightarrow(\mathfrak{u} / \mathfrak{u}_+)^\ast$ comes from the symplectic pairing
and the shift $\kappa_f \in \mathfrak{u}^\ast$ is given by $Y \mapsto \left\langle \iota \left(
    \begin{smallmatrix}
      0&0\\
      1&0 \\
    \end{smallmatrix}
  \right), Y \right\rangle$.  The \emph{hyperspherical} condition involves several requirements.  Many concern avoiding the cases of covering groups, where stabilizers need not be connected.  The main requirement is \emph{coisotropy}, which says that the space $K(\mathcal{M})^G$ of $G$-invariant rational functions on $\mathcal{M}$ is commutative with respect to the Poisson bracket.

There is a structure theorem of BZSV that says that every smooth hyperspherical Hamiltonian $G$-space $\mathcal{M}$ arises as $\mathcal{M}_\Delta$ for some unique BZSV quadruple $\Delta$.  Tomorrow, we'll explain how in terms of the quadruples to see the coisotropy conditions; we will also explain the ``anomaly-free'' condition.  (Note that so far we could take any subgroup $H$ in such a quadruple, which would be too powerful; the hyperspherical condition says roughly that $H$ is a spherical subgroup in the special case \eqref{enumerate:cq6txwuycw}, while in the special case \eqref{enumerate:cq6txwu9pz}, it says that the symplectic representation should be multiplicity-free in a certain sense to be discussed tomorrow.)

\begin{remark}\label{remark:cq6ueb2get}
  For a reductive group over a local field, local Langlands classifies isomorphism classes of irreducible representations in terms of conjugacy classes of maps from $W_F '$ to $\hat{G}$.  (For a compact connected Lie group, there is a simpler bijection involving $S^1$ in place of $W_F'$.)  In this setting, there is a Hamiltonian $G$-space $\mathcal{M}$ and a Hamiltonian $\hat{G}$-space $\hat{\mathcal{M}}$.  There is something like quantization.  Formally, $\mathcal{M} =T^\ast X$ and $\hat{\mathcal{M}} = T^\ast \hat{X}$.  There are actions $G \circlearrowright L^2(X)$ and $\hat{G} \circlearrowright L^2(\hat{X})$.  For instance, if $\mathcal{M} = T^\ast(G / H)$, then $X= G / H$.  It makes sense to consider the subset
  \begin{equation*}
    \Irr_X(G(F)) = \left\{ \pi \in \Irr(G(F)) \text{ appearing in } L^2(X) \right\}.
  \end{equation*}
  This should correspond to
  \begin{equation*}
    \left\{ \phi : W_F ' \rightarrow \hat{G}(\mathbb{C}) : \hat{\mathcal{M}}^{\image(\phi)} \neq \emptyset \right\}.
  \end{equation*}
\end{remark}

Continuing, let's first recall what we've been doing in the past few days, in the reverse order.  We start with a split reductive group $G$, with dual group $\hat{G}$.  We said at the end of yesterday that the relative Langlands duality is a duality, conjectured by BZSV, between certain Hamiltonian spaces $\mathcal{M}$ and $\hat{\mathcal{M}}$ for $G$ and $\hat{G}$ satisfying certain conditions: anomaly-free and hyperspherical.  The structure theorem of BZSV states that any hyperspherical $\mathcal{M}$ is of the course $\mathcal{M} = \mathcal{M}_\Delta$ for some unique BZSV quadruple $\Delta =(G, H, \iota, \rho_H)$, where we recall that $H \subset G$ is a reductive subgroup, $\iota : \mathrm{SL}_2 \rightarrow G$ commutes with $H$, and $\rho_H : H \rightarrow\mathrm{Sp}(V)$.
\begin{definition}\label{definition:cq6ueb08jo}
  We say that a quadruple $\Delta$ is \emph{anomaly-free hyperspherical} if the associated Hamiltonian space $\mathcal{M}_\Delta$ is.
\end{definition}
How does one see these conditions in terms of the quadruples?  Recall that, given $\Delta =(G, H, \iota, \rho_H)$, from $\iota$, we get $L := \operatorname{Cent}_G(\operatorname{image}(\iota(\diag(t, t^{-1}))))$ and $U = \exp(\mathfrak{u})$, with $\mathfrak{u}$ the positive weight space.  We also let $\mathfrak{u}_+$ denote the weight $\geq 2$ space, so that $\mathfrak{u} / \mathfrak{u}_+$ is actually the weight $1$ space; it is also a symplectic representation of $H$.  We denote this representation by $\rho_\iota$.  From this quadruple, we define another quadruple, but with trivial $\iota$, by
\begin{equation}\label{eq:cq6uefar6y}
  \Delta_{\mathrm{red}} :=(L, H, 1, \rho_{H, \iota}),
\end{equation}
where $\rho_{H, \iota} = \rho_H \oplus \rho_\iota$.  The reason we write ``$\mathrm{red}$'' for ``reductive'' is that the $\iota$ part in the period integral gives some unipotent period, so if you want a period integral over a reductive subgroup, that's equivalent to saying that $\iota$ is trivial.  We say that $\Delta$ is \emph{reductive} if $\iota = 1$, or equivalently, if $\Delta = \Delta_{\red}$.
\begin{definition}\label{definition:cq6ueb2cbs}
  We say that $\Delta$ is \emph{anomaly-free} if this symplectic representation $\rho_{H, \iota}$ is an anomaly-free symplectic representation of $H$, in the sense defined below.
\end{definition}
\begin{definition}\label{definition:cq6ueb0lsb}
  Let $\pi : H \rightarrow\mathrm{Sp}(V)$ be a symplectic representation.  Recall that $H$ is split.  Let $T \subset H$ denote the maximal split torus.  We may then restrict our representation to $T$.  Since the representation is symplectic, its restriction to $T$ will be self-dual and even-dimensional, so we can decompose $\pi |_T = \tau \oplus \tau^\vee$ (non-uniquely, although the definition to follow does not depend upon this choice).  We say that $\pi$ is \emph{anomaly-free} if there exists $\chi : T \rightarrow \mathrm{GL}_1$ and $\eta : H \rightarrow \mathrm{GL}_1$ such that $\det(\tau) = \chi^2 \cdot \eta |_T$.
\end{definition}
This means roughly that if you take half the weights of the $\pi$, you get a square in the weight lattice.  From the point of view of period integrals, recall that we really needed a Weil representation, but this is usually not defined on $\mathrm{Sp}(V)$, but rather on its metaplectic cover $\tilde{\Sp}(V) \rightarrow\mathrm{Sp}(V)$; this anomaly-free condition ensures that the image of the representation has a splitting inside this cover.  There are several places where this condition becomes natural.
\begin{exercise}\label{exercise:cq6ueb0ys0}
  Check that Definition \ref{definition:cq6ueb0lsb} is independent of the choice of the decomposition of $\pi |_T$.
\end{exercise}
\begin{remark}
  From the above definition, one can easily see that $\Delta$ is anomaly-free if and only if $\Delta_{\red}$ is.  Indeed, what really matters is the symplectic representation.
\end{remark}
Now let's discuss how to see the coisotropy condition.  Recall that $\mathcal{M}$ is coisotropic if the ring $K(\mathcal{M})^G$ of $G$-invariant rational functions is commutative with respect to the Poisson bracket.  What condition does this place on the quadruples?  To see this, we may reduce to the case that $\Delta$ is reductive.
\begin{proposition}
  (See \cite[\S3]{2024arXiv2409.04677}.)  For $\Delta = \Delta_{\red}$, we have that $\mathcal{M}_\Delta$ is coisotropic if and only if the following conditions hold:
  \begin{enumerate}
  \item\label{enumerate:cq6ueeom44} $H \subset L$ is a spherical subgroup.
  \item\label{enumerate:cq6ueeon2w} The restricted symplectic representation $\rho_{H, \iota} |_{H_0}$ is a multiplicity-free symplectic representation, where $H_0$ is the stabilizer of a generic orbit for $H \circlearrowright \mathfrak{h}^\perp$, with $\mathfrak{h}^\perp$ the orthogonal complement of $\mathfrak{h}$ inside $\mathfrak{l} = \Lie(L)$.  Here ``multiplicity-free'' is similar to this coisotropy condition; it means basically that $K(V)^{H}$ is commutative with respect to the Poisson bracket.  Such representations were completely classified by Knop and Losev.
  \end{enumerate}
\end{proposition}
We can now describe the duality $\Delta =(G, H, \iota, \rho_H) \longleftrightarrow \hat{\Delta} =(\hat{G}, \hat{H}', \hat{\iota}', \rho_{\hat{H}'})$.  We have focused here on the period conjectures, but there are also geometric and $L^2$-conjectures, and it is expected that those finer conjectures (especially the geometric ones) should classify this duality.  What is not available at the moment is, if we're given a $\Delta$, can you write down $\hat{\Delta}$?  This is apparently missing at the moment; there's no clear algorithm in general.  (By contrast, it's clear and algorithmic how to pass from a group $G$ to its dual group $\hat{G}$ in terms of root data.)  But there are algorithms for computing the duality in some special cases.

First, BZSV explain how we can reduce the computation of the duality to the reductive case.  We want to go from $\Delta$ to $\hat{\Delta}$, and we know how to go from $\Delta$ to $\Delta_{\red}$, as in \eqref{eq:cq6uefar6y}.  What BZSV propose is to use
\begin{equation*}
  \widehat{\Delta_{\red}} =(\hat{L}, \hat{H}_{L}', \hat{\iota}_L ', \rho_{\hat{H}_{L}'})
\end{equation*}
(this is the dual of $\Delta_{\red}$, typically not the same as the reductive version $\hat{\Delta}_{\red}$ of the dual $\hat{\Delta}$) to compute $\hat{\Delta}$, as follows:
\begin{enumerate}[(i)]
\item $\hat{\iota}' = \hat{\iota}'_L $.
\item $\hat{H}'$ is generated by $\hat{H}'_L$ and
  \begin{equation*}
    \left\{ \image(\iota_\alpha) \mid \alpha \in \Delta_{\hat{G}} = \Delta_{\hat{L}} \right\},
  \end{equation*}
  where $\Delta_{\dotsb}$ denotes simple roots.
\item Write $\rho_{\hat{H}_L '} = \bigoplus_i \tau_{i, L}$, where the $\tau_{i, L}$ are irreducible representations of highest weight $\omega_{i,L}$.  Then take $\rho_{\hat{H}'} = \bigoplus_i \tau_i$, where the $\tau_i$ are irreducible representations of highest weight $\omega_i$ such that $\omega_i$ and $\omega_{i, L}$ belongs to the same orbit of the Weyl group.
\end{enumerate}
\begin{example}[Shalika model]
  (Recall Example \ref{example:cq6tho3o9b}.)  $\Delta =(\mathrm{GL}_{2 n},\mathrm{GL}_{n},(2^n), 0)$.  Then
  \begin{equation*}
    \Delta_{\red} =(\mathrm{GL}_n \times \mathrm{GL}_n, \mathrm{GL}_n, 1, 0)
    \rightarrow
    \widehat{\Delta_{\red}}
    =(\mathrm{GL}_n \times \mathrm{GL}_n, \underline{\mathrm{GL}_n}, 1, 0),
  \end{equation*}
  where $\underline{\mathrm{GL}_n}$ is a sort of diagonal $\mathrm{GL}_n$.  Pass from this to $\hat{\Delta}$, we get
  \begin{equation*}
    \hat{\Delta} =(\mathrm{GL}_{2 n},\mathrm{Sp}_{2 n}, 1, 0).
  \end{equation*}
\end{example}
\begin{example}
  (Recall Exercise \ref{exercise:cq6tho3oca}.)  $\Delta =(\mathrm{GL}_6, \mathrm{GL}_2,(3^2), 0)$.  Then
  \begin{equation*}
    \Delta_{\red} =(\mathrm{GL}_2^3, \mathrm{GL}_2, 1, 0)
    \rightarrow \widehat{\Delta_{\red}} = (\mathrm{GL}_2^3, S(\mathrm{GL}_2^3), 1, \mathrm{std}^{\otimes 3}).
  \end{equation*}
  We obtain
  \begin{equation*}
    \hat{\Delta} =(\mathrm{GL}_6, \mathrm{SL}_6, 1, \wedge^3).
  \end{equation*}
  In deriving this, we look at
  \begin{equation*}
    \begin{pmatrix}
      \diag(t_1, t_2)      &  \mathrm{GL}_2 &  \\
                           & \diag(t_3, t_4) &  \\
                           &  &  \mathrm{GL}_2 \\
    \end{pmatrix}
    \subset \mathrm{GL}_6,
  \end{equation*}
  and $\omega_{L} = t_1 t_3 t_5 \implies \omega = t_1 t_2 t_3$.
\end{example}

This is the first algorithm we have -- you can reduce to the reductive case.  It remains to consider the reductive case, where $\Delta =(G, H, 1, \rho_H)$.  In this case, there are two known algorithms.

First, the \emph{polarized case} $\rho_H = \tau \oplus \tau^\vee$.  This includes, for instance, the case of spherical varieties, where $\Delta =(G, H, 1, 0)$.  It's not too far away from that case -- one can often just replace $H$ by a generic stabilizer for the action of $\tau$.  BZSV give a generic formula for computing the dual.
\begin{itemize}
\item $\hat{H}', \iota$ are given by the dual group of spherical varieties (Gaitsgory--Nadler, Sakellaridis--Venkatesh, Knop--Schalke).
\item $\rho_{\hat{H}}$ was constructed (via unramified calculation) by Sakellaridis \cite{MR3117308}.
\end{itemize}

Another known case is the \emph{vector space case}, where $H = G$ but $\rho_H$ can be anything.  We then give a construction based on Knop's construction.  We give a way to describe $\hat{H}'$ and $\hat{\iota}'$, but for $\rho_{\hat{H}'}$, we use an \emph{ad hoc} method based on looking at the finite tables of examples.  See \cite{2023arXiv2310.17837}.
\section{Raphael Beuzart-Plessis's lectures}\label{sec:cq6tho1cgx}
\textbf{Introduction to Relative Trace Formulas (RTF)}

\subsection{RTF in general}\label{sec:cq6tho1blx}

Let $K$ be a global field.  Let $G$ be a connected reductive group over $K$.  Let $A(G)$ denote the space of automorphic forms on the automorphic quotient $[G] := G(K) \backslash G(\mathbb{A}_K)$.

\subsubsection{Periods}\label{sec:cq6tho1auw}

Let $H \subset G$ be an algebraic group.  Let $\chi :[H] \rightarrow \mathbb{C}^\times$ be a character.  By the $(H, \chi)$-period, we mean the functional
\begin{equation*}
  \mathcal{P}_{H, \chi} : A(G) \rightarrow \mathbb{C}
\end{equation*}
\begin{equation*}
  \varphi \mapsto \int_{[H]} \varphi(h) \chi(h) \, d h.
\end{equation*}
\begin{remark}\label{remark:cq6tho091q}
  The integral often diverges.  We'll explain in some examples how one might regularize them.  It's usually convergent if the automorphic form $\varphi$ is cuspidal.  (Usually, but not always -- there might be issues with the center, or if one takes $H$ to be the Borel subgroup of $G = \mathrm{GL}_2$, then it never converges.)
\end{remark}

\begin{remark}\label{remark:cq6tho3lbh}
  We can replace $\chi$ by some ``small'' automorphic representation of $H$ (e.g., ``degenerate'' Eisenstein series).
\end{remark}

\textbf{Emprical fact}: $\mathcal{P}_{H, \chi}$ is often related to $L$-functions and functoriality.

\begin{example}\label{example:cq6tho6g4r}
  \begin{enumerate}[(a)]
  \item (Hecke) $G = \mathrm{GL}_2 \supset \left(
      \begin{smallmatrix}
        \ast&\\
                               &1 \\
      \end{smallmatrix}
    \right) := \mathbb{G}_m$.  For $\varphi \in \pi \subset \mathcal{A}_{\mathrm{cusp}}(G)$,
    \begin{equation*}
      \mathcal{P}_{H, \lvert . \rvert^s}(\varphi) \sim L(\tfrac{1}{2} + s, \pi).
    \end{equation*}
  \item (Rankin--Selberg) $G = \mathrm{GL}_2 \times \mathrm{GL}_2 \supset H = \mathrm{GL}_2^{\mathrm{diag}}$, $\int_{[H/Z]} \varphi_1(h) \varphi_2(h) E(h, f, s) \, d h \sim L(s, \pi_1 \times \pi_2)$, where $\varphi_i \in \pi_i \subset A_{\mathrm{cusp}}(\mathrm{GL}_2)$ and $E$ is a suitable Eisenstein series.
  \item (Harder--Langlands--Rapoport) Let $L/K$ be a quadratic extension, $G =\mathrm{GL}_{2, L}$, $H =\mathrm{GL}_{2, K}$.  Take $\pi \subset A_{\mathrm{cusp}}(\mathrm{GL}_{2, K})$ and $\chi : \mathbb{A}_K^\times / K^\times \rightarrow \mathbb{C}^\times$ such that $\omega_\pi = \chi^{-1} \circ N_{L/K}$.  Then the following are equivalent:
    \begin{itemize}
    \item There exists $\varphi \in \pi$ with $\mathcal{P}_{H, \chi}(\varphi) \neq 0$.
    \item There exists $\sigma \subset A_{\mathrm{cusp}}(\mathrm{GL}_{2, K})$ such that $\pi$ is the base change $\sigma_L$ and $\omega_\sigma = \chi^{-1}$.
    \end{itemize}
  \item (Jacquet--Shalika)
    Take
    \begin{equation*}
      G :=\mathrm{GL}_{2 n} \supseteq H = \left\{
        \begin{pmatrix}
          g &  \\
                                                                                             & g \\
        \end{pmatrix}
        \begin{pmatrix}
          1          & X \\
                                                                                             & 1 \\
        \end{pmatrix} \mid g \in \mathrm{GL}_n, \, X \in \Mat_n \right\}.
    \end{equation*}
    Let
    \begin{equation*}
      \chi :[H] \rightarrow \mathbb{C}^\times,
    \end{equation*}
    \begin{equation*}
      \begin{pmatrix}
        g        &  \\
                                                                          & g \\
      \end{pmatrix}
      \begin{pmatrix}
        1        & X \\
                                                                          & 1 \\
      \end{pmatrix}
      \mapsto \psi(\trace(X)).
    \end{equation*}
    For $\pi \subset A_{\mathrm{cusp}}(\mathrm{GL}_{2 n} / Z)$, the following are equivalent:
    \begin{itemize}
    \item $\mathcal{P}_{H, \chi} \mid_\pi$ is not identically zero.
    \item $\pi$ is a functorial lift from $\SO_{2 n + 1}$.
    \end{itemize}
  \end{enumerate}
\end{example}

\subsubsection{Theta series}\label{sec:cq6thpxagu}

Take $X := H \backslash G$.  Define $\Theta^X : C_c^\infty(X(\mathbb{A})) \rightarrow C^\infty([G])$ by
\begin{equation*}
  f \mapsto \Theta_f^X(g) := \sum_{x \in X(K)} f(x g).
\end{equation*}
For $\varphi \in A(G)$, define
\begin{equation*}
  \mathcal{P}_X(\varphi, f) := \int_{[G]}
  \varphi(g) \Theta_f^X(g) \, d g.
\end{equation*}
Provided that $f$ is supported inside $H(\mathbb{A}) \backslash G(\mathbb{A})$ (in general, a proper subset of $X(\mathbb{A})$, with the obstruction measured by Galois cohomology), we have
\begin{equation*}
  \mathcal{P}_X(\varphi, f) = \int_{H(\mathbb{A}) \backslash G(\mathbb{A})}
  \mathcal{P}_H(R(x) \varphi) f(x) \, d x.
\end{equation*}
In particular, writing $\Theta_{f,\pi}^X$ for the orthogonal projection of $\Theta_{f}^X$ to $\pi$, we see that
\begin{equation*}
  \mathcal{P}_H |_\pi \not \equiv 0
  \quad \iff \quad
  \Theta_{f,\pi}^X  \not \equiv 0.
\end{equation*}
This makes sense for any (smooth) $G$-variety $X$, not necessarily homogeneous.  Put this way, it contains many basic examples.
\begin{example}\label{example:cq6thpw9ml}
  \begin{enumerate}[(a)]
  \item\label{enumerate:cq6thpxd02} Take $X = \mathbb{G}_a \circlearrowleft \mathbb{G}_m$.  Then an automorphic form is just a Hecke character $\chi$, and by Tate,
    \begin{equation*}
      \int_{[\mathrm{GL}_1]}^{\reg} \chi(t) \Theta_f^X(t) \, d t \sim L(\tfrac{1}{2}, \chi).
    \end{equation*}
    (We'll talk about the regularization later.)
  \item\label{enumerate:cq6thpxe24} Take $X = \Mat_n \circlearrowleft G = \mathrm{GL}_n \times \mathrm{GL}_n$.  Take two cusps forms in the \emph{same} cuspidal automorphic representation, say $\varphi_1, \varphi_2 \in \pi \subset A_{\mathrm{cusp}}(\mathrm{GL}_n)$.  Then
    \begin{equation*}
      \int_{[G]}^{\reg} \varphi_1(g) \varphi_2(g) \Theta_f^X(g) \, d g \sim L \left( \tfrac{1 - n}{2}, \pi \right).
    \end{equation*}
  \end{enumerate}
\end{example}

\subsubsection{RTF formally}\label{sec:cq6thp1yjb}

Before defining an RTF, we need to talk about an \emph{automorphic kernel}.  Take $f \in C_c^\infty(G(\mathbb{A}))$.  It acts on the space of automorphic forms by the right convolution $R(f)$.  This action is given by a kernel, which is like a continuous matrix, given by
\begin{equation*}
  \left( R(f) \varphi \right)(x) := \int_{[G]}
  K_f(x, y) \varphi(y) \, d y.
\end{equation*}
The kernel has $K_f(x, y)$ two different expansions.  One, which we call the \emph{geometric} expansion, is as a sum over rational points over the group:
\begin{equation*}
  \sum_{\gamma \in G(K)}
  f(x^{-1} \gamma y).
\end{equation*}
The other, which is a kind of \emph{spectral} expansion, is given by
\begin{equation*}
  \sum_{
    \substack{
      \varphi \in A_{\mathrm{cusp}}(G)  \\
      \text{O.N.B.}      
    }
  }
  \bigl( R(f) \varphi \bigr)(x) \overline{\varphi(y)}
  + \dotsb 
\end{equation*}
where $\dotsb$ denotes the Eisenstein contribution.

We now consider the following setting.  Let $H_1 \subset G \supset H_2$ be two subgroups.  Let $\chi_i :[H_i] \rightarrow \mathbb{C}^\times$.  Define $\mathfrak{X}$ to be, informally, the quotient
\begin{equation*}
  \text{``}H_1, \chi_1 \backslash G / H_2, \chi_2\text{''}.
\end{equation*}
More precisely:

\begin{definition}\label{definition:cq6thqam4a}
  For $f \in C_c^\infty(G(\mathbb{A}))$,
  \begin{equation*}
    \operatorname{RTF}_{\mathfrak{X}}(f) := \int_{[H_1] \times[H_2]} K_f(h_1, h_2) \chi_1(h_1) \chi_2(h_2)
    \, d h_1 \, d h_2.
  \end{equation*}
\end{definition}
Why is this related to period integrals?  Well, one way to compute the RTF is via the \emph{spectral expansion}
\begin{equation*}
  \mathrm{RTF}_{\mathfrak{X}}(f) := \sum_{\varphi \in A_{\mathrm{cusp}}(G)}
  \mathcal{P}_{H_1, \chi_1}(R(f) \varphi)
  \mathcal{P}_{H_2, \chi_2}(\overline{\varphi})
  + \dotsb.
\end{equation*}
Another is the \emph{geometric expansion}
\begin{equation*}
  \mathrm{RTF}_{\mathfrak{X}}(f) = \sum_{\gamma \in H_1(K) \backslash G(K) / H_2(K)}
  \vol \left([(H_1 \times H_2)_\gamma] \right) \mathrm{Orb}_\gamma(f),
\end{equation*}
where
\begin{equation*}
  \mathrm{Orb}_\gamma(f) := 
  \int_{(H_1 \times H_2)_\gamma(\mathbb{A}) \backslash (H_1 \times H_2)(\mathbb{A})}
  H(h_1^{-1} \gamma h_2)
  \chi_1(h_1) \chi_2(h_2)
  \, d h_1
  \, d h_2.
\end{equation*}
Here $(H_1 \times H_2)_\gamma$ is the stabilizer with respect to the action $\gamma \cdot(h_1, h_2) = h_1^{-1} \gamma h_2$.

\begin{remark}\label{remark:cq6thubzrk}
  Two sources of divergence on the geometric side:
  \begin{itemize}
  \item the volumes can be infinite, and
  \item the orbital integrals can diverge.
  \end{itemize}
  However, one advantage of these distributions over the original ones is that they are factorizable, being now taken over an adelic space.  At least formally,
  \begin{equation*}
    \mathrm{Orb}_\gamma(f) = \prod_v \mathrm{Orb}_\gamma(f_v) \quad \text{ for } f = \prod f_v,
  \end{equation*}
  where $\mathrm{Orb}_\gamma(f_v)$ is a local orbital integral.
\end{remark}

\begin{remark}\label{remark:cq6th778hd}
  There are a few different RTF's one can see here:
  \begin{itemize}
  \item $G \circlearrowleft H_1 \times H_2$,
  \item $H_1 \backslash G \circlearrowleft H_2$,
  \item $H_1 \backslash G \times H_2 \backslash G \circlearrowleft G$.
  \end{itemize}
\end{remark}<++>

\subsubsection{RTF and theta series}\label{sec:cq6thubysx}

Assume for simplicity that $\chi_1 = \chi_2 = 1$.

There is one first obvious relation between RTF and theta series.  Note that
\begin{equation*}
  K_f = \Theta_f^G \qquad \text{ for } G \circlearrowleft G \times G.
\end{equation*}
Thus
\begin{equation*}
  \mathrm{RTF}_{\mathfrak{X}}(f) = \int_{[H_1 \times H_2]} \Theta_f^G = \int_{[H_2]} \Theta_\varphi^{H_2 \backslash G},
\end{equation*}
where $\varphi(x) = \int_{H_1(\mathbb{A})} f(h_1 x) \, d h_1$, which lies in $C_c^\infty(H_1(\mathbb{A}) \backslash G(\mathbb{A}))$.  We can also write the above as the Petersson norm
\begin{equation*}
  \left\langle \Theta^{H_1 \backslash G}_{\varphi_1}, \Theta_{\varphi_2}^{H_2 \backslash G} \right\rangle_{\mathrm{Pet}},
\end{equation*}
where for $f = f_1 \ast f_2^\vee$ with $f_1, f_2 \in C_c^\infty(G(\mathbb{A}))$, we set
\begin{equation*}
  \varphi_i(x) := \int_{H_i(\mathbb{A})} f_i(h_i x) \, d h_i.
\end{equation*}

More generally, for $X \circlearrowleft G$, we can consider the distributions
\begin{equation*}
  \mathrm{RTF}_{\mathfrak{X}/G}(f) := \int_{[G]} \Theta^X_f \quad \text{ for } f \in C_c^\infty(X(\mathbb{A})).
\end{equation*}
You can write, in a similar way, a geometric expansion of this in terms of $G(K)$ on $X(K)$.  Let's try to make sense of the convergence.  These $\Theta_f^X$ are not arbitrary functions -- they have a very special behavior.  Here's a fact that we'll write in vague terms, and then give one example.
\begin{fact}\label{fact:cq6thubvi6}
  $\Theta^X_f$ is ``asymptotically finite'', i.e., is asymptotic to eigenfunctions with respect to the action of some tori (where we pluralize ``torus'' because the precise one depends upon in which direction you are tending to infinity).  Informally, by declaring the integrals of such asymptotics to be zero, you can define regularized integrals.  Provided that<++> the asymptotics are nontrivial, there is a canonical way to regularize $\mathrm{RTF}_{X / G}$.
\end{fact}

\begin{example}\label{example:cq6thubuij}
  Take $G = \mathbb{G}_m$.  Let $\chi_0, \chi_\infty :[\mathbb{G}_m] \rightarrow \mathbb{C}^\times$.  Define $\mathcal{F}_{\chi_0, \chi_\infty}([\mathbb{G}_m])$ to be the set of all $f \in C^\infty([\mathbb{G}_m])$ such that there are $c_0 = c_0(f)$ and $c_\infty = c_\infty(f) \in \mathbb{C}$ such that
  \begin{equation*}
    \left\lvert f(t) - c_\infty \chi_\infty(t) \right\rvert \ll_N \lvert t \rvert^{- N}
    \quad \text{ for } \lvert t \rvert \geq 1,
  \end{equation*}
  \begin{equation*}
    \left\lvert f(t) - c_\infty \chi_\infty(t) \right\rvert \ll_N \lvert t \rvert^{N} \qquad \text{ for } \lvert t \rvert \leq 1.
  \end{equation*}
  We have a short exact sequence of $\mathbb{A}^\times$-representations
  \begin{equation*}
    0 \rightarrow \mathcal{S}([\mathbb{G}_m]) \rightarrow \mathcal{F}_{\chi_0, \chi_\infty} \rightarrow \mathbb{C}_{\chi_0} \oplus \mathbb{C}_{\chi_\infty} \rightarrow 0,
  \end{equation*}
  where $\mathcal{S}([\mathbb{G}_m])$ consists in particular of functions that are rapidly decaying.  The map is given by $f \mapsto(c_0(f), c_\infty(f))$.
  \begin{enumerate}[(a)]
  \item\label{enumerate:cq6tht3m44} If $\chi_0 \neq 1 \neq \chi_\infty$, then there is a unique functional
    \begin{equation*}
      \int_{[\mathbb{G}_m]}^{\mathrm{reg}} : \mathcal{F}_{\chi_0, \chi_\infty} \rightarrow \mathbb{C}
    \end{equation*}
    that is $\mathbb{A}^\times$-invariant and such that
    \begin{equation*}
      \int_{[\mathbb{G}_m]}^{\mathrm{reg}} f = \int_{[\mathbb{G}_m]} f(t) \, d t
      \quad \text{ for } f \in \mathcal{S}([\mathbb{G}_m]).
    \end{equation*}
  \item\label{enumerate:cq6tht3n8y} Take $X_1 = \mathbb{G}_a \circlearrowleft \mathbb{G}_m$.  Then, for all $f \in C_c^\infty(\mathbb{A})$, we have $\Theta_f^{X_1} \in \mathcal{F}_{\lvert . \rvert^{-1}, 1}$.
  \item\label{enumerate:cq6tht4jar} Define $X_2 = \mathbb{G}_a^2 \circlearrowleft \mathbb{G}_m$ by $t \cdot(x, y) :=(t x, t^{-1} y)$.  Then, for all $f \in C_c^\infty(\mathbb{A}^2)$, we have $\Theta_f^{X_2} := \mathcal{F}_{\lvert . \rvert^{-1}, \lvert . \rvert}$.
  \item\label{enumerate:cq6tht7mp9} Take $\mathbb{G}_m = A = \left(
      \begin{smallmatrix}
        \ast&\\
                                &1 \\
      \end{smallmatrix}
    \right) \subset \mathrm{PGL}_2$, then for all $f \in C_c^\infty(X_3(\mathbb{A}))$, we have $\Theta_f^{X_3} \in \mathcal{F}_{\lvert . \rvert^{-1}, \lvert . \rvert}$.
  \end{enumerate}
\end{example}

\subsection{Waldspurger theorem via Jacquet's comparison of RTF}\label{sec:cq6tyal5g1}

\subsubsection{Reminder on Hecke periods}\label{sec:cq6tyal962}

Set
\begin{equation*}
  G := \mathrm{PGL}_2 / K \supset A :=
  \begin{pmatrix}
    \ast    &  \\
                                                                             & 1 \\
  \end{pmatrix}
  = \mathbb{G}_m.
\end{equation*}
Let's also fix an idele class character $\chi :[\mathbb{G}_m] \rightarrow \mathbb{C}^\times$.
Yesterday we formulated a relation between the Hecke period and the Hecke $L$-function.  Let's recall that, being a little more precise.  Let $\varphi \in \pi \subset A_{\mathrm{cusp}}(G)$ be a cusp form, living in some cuspidal automorphic representation.  Then if you take the automorphic period over $A$ twisted by $\chi$ of $\varphi$, you get the standard $L$-function of $\pi$ twisted by $\chi$, although it's only an approximation: you need to add some local factors involving the local points of your torus, the local components of your character, and the local component of not exactly $\varphi$, but rather its Whittaker function.  This yields
\begin{equation}\label{eq:cq6tx8qioa}
  \mathcal{P}_{A, \chi \lvert . \rvert^s}(\varphi) = L(\tfrac{1}{2} + s, \pi \times \chi) \prod_v \mathcal{P}_{A_v, \chi_v, \lvert . \rvert_v^s}^{\flat}(W_v),
\end{equation}
where the Whittaker function is defined by
\begin{equation*}
  W_\varphi(g) = \int_{\mathbb{A}} \varphi \left(
    \begin{pmatrix}
      1 & x \\
      0 & 1 \\
    \end{pmatrix} g \right)
  \psi(x) \, d x
  = \prod_v W_v,
\end{equation*}
with the factorization was explained in Chris's lectures, and where the local periods are defined in the obvious way, by integrating the Whittaker function against the character:
\begin{equation*}
  \mathcal{P}_{A_v, \chi_v, \lvert . \rvert_v^s}(W_v) := \int_{F_v^\times} W_v
  \begin{pmatrix}
    a    &  \\
                                                                                   & 1 \\
  \end{pmatrix}
  \chi_v(a) \lvert a \rvert_v^s \, d a,
\end{equation*}
which we normalize further by dividing by the local factor of the global $L$-function:
\begin{equation*}
  \mathcal{P}_{A_v, \chi_v, \lvert . \rvert_v^s}^\flat(W_v) :=
  \frac{\mathcal{P}_{A_v, \chi_v, \lvert . \rvert_v^s}(W_v)}{L(\tfrac{1}{2} + s, \pi_v \times \chi_v)}.
\end{equation*}
Specialize to $s = 0$.  It turns out that all local periods are nonzero, so we obtain
\begin{equation*}
  L(\tfrac{1}{2}, \pi \times \chi) \neq 0
  \quad \iff \quad
  \text{there exists } \varphi \in \pi, \, \, \mathcal{P}_{A, \chi}(\varphi) \neq 0.
\end{equation*}

\subsubsection{Waldspurger's formula}\label{sec:cq6tyama80}

Let $L /K$ be a separable quadratic extension of $K$.  We can then define a torus $T := L^\times / K^\times \subset G := \Aut_K(L) / K^\times$.  We can define an automorphic character $\chi :[T] \rightarrow \mathbb{C}^\times$.  Let us remark that $[T]$ can also be written as $L^\times \backslash \mathbb{A}_L^\times / \mathbb{A}_K^\times$; thus, $\chi$ gives in particular an idele class character for $L$.  We then have all the ingredients needed to formulate a precise version of Waldspurger's formula.  It's essentially an analogue of the Hecke formula \eqref{eq:cq6tx8qioa}.  Let $\varphi \in \pi \subset A_{\mathrm{cusp}}(G)$.  Then
\begin{equation*}
  \left\lvert \mathcal{P}_{T, \chi}(\varphi) \right\rvert^2
  =
  L(\tfrac{1}{2}, \pi_L \times \chi) \prod(\text{local periods}),
\end{equation*}
where $\pi_L \subset A(G_L)$ is the base change lift of $\pi$ (a particular case of Langlands functoriality, shown to exist by Langlands in this case).  That's the shape of the Waldspurger formula.

Now you can ask the same question: can we deduce from this formula a criterion for the nonvanishing of the central $L$-value?  The problem here is that the local periods can be identically zero!  The way to work around this problem is to work with a family of groups, called \emph{pure inner forms}.  Let's explain quickly what are these groups.

\subsubsection{Quaternion algebras}\label{sec:cq6tyamby0}

Let $k$ be an arbitrary field, with $\operatorname{char}(k) \neq 2$.  Let's take as a definition that a \emph{pure inner form} of $G := \mathrm{PGL}_2$ is a group of the form $G^B := B^\times / k^\times$, where $B$ is a quaternion algebra over $k$.

Recall that a \emph{quaternion algebra} over $k$ is an algebra $B_{/k}$ whose base change to the algebraic closure is the space of $2 \times 2$ matrices, i.e., $B \otimes_k k^{\mathrm{sep}} \cong M_2(k^{\mathrm{sep}})$.  If $B \cong M_2(k)$ (already over $k$), then we say that $B$ is \emph{split}.  There's a very simple classification of quaternion algebras, using the following construction.  Over the algebraic closure, there's a particular quadratic form on the $2 \times 2$ matrices, given by the determinant: $\det : M_2(k^{\mathrm{sep}}) \rightarrow k^{\mathrm{sep}}$.  Being unique, it descends to $N : B \rightarrow k$, called the \emph{reduced norm}.  This is also a quadratic form.  In particular, you can consider the orthogonal of $k$ with respect to the associated bilinear form, say $B_0 := k^\perp$.  Then we obtain
\begin{gather*}
  \left\{
    \begin{array}{c}
      \text{quaternion algebras over } k \\
      \text{up to isomorphism}
    \end{array}
  \right\}
  \quad \longleftrightarrow \quad
  \left\{
    \begin{array}{c}
      \text{rank } 3 \text{ quadratic forms} \\
      \text{of discriminant one,} \\
      \text{up to equivalence}
    \end{array}
  \right\} \\[1em]
  B \quad \longmapsto \quad N|_{B^0}
\end{gather*}
Moreover, $G^B \cong \SO(q)$.

The classification proceeds as follows.
\begin{itemize}
\item If $k$ is a local field other than $\mathbb{C}$, then there are two isomorphism classes of quaternion algebras: $M_2(k) = B^+$ (called \emph{split}), and some other quaternion algebra $B^-$.
\item Suppose $k = K$ is global.  Then:
  \begin{itemize}
  \item Two quaternion  algebras $B$ and $B'$ over $K$ are isomorphic if and only if their completions $B_v :=B \otimes_K k_v$ and $B_v '$ are isomorphic for all $v$.
  \item For a family $(\mathbb{B}_v)_v$ of local quaternion algebras, there exists a quaternion algebra $B_{/ K}$ with $B_v \cong \mathbb{B}_v$ for all places $v$ if and only if
    \begin{itemize}
    \item $\mathbb{B}_v$ is split for almost all $v$, and
    \item $\prod_v \eps(\mathbb{B}_v) = 1$, where $\eps(\mathbb{B}_v)$ is defined to be $+1$ if $\mathbb{B}_v$ is split and $- 1$ otherwise.
    \end{itemize}
  \end{itemize}
\end{itemize}
We next recall the \emph{Jacquet--Langlands} correspondence.
\begin{itemize}
\item For $k = F$ local, there exists
  \begin{equation*}
    \mathrm{JL} : \Irr(G^B(F)) \hookrightarrow \Irr(G(F))
  \end{equation*}
  that is injective and is characterized by some character identities.  Moreover, if $B$ is split, then $\mathrm{JL}$ is just the identity.
\item For $k \in K$ global, there exists
  \begin{equation*}
    \mathrm{JL} :
    \left\{
      \begin{array}{c}
        \text{cuspidal automorphic } \\
        \text{representations } \pi_B \subset A_{\mathrm{cusp}}(G^B)
      \end{array}
    \right\}
    \hookrightarrow 
    \left\{
      \begin{array}{c}
        \text{cuspidal automorphic } \\
        \text{representations } \pi \subset A_{\mathrm{cusp}}(G)
      \end{array}
    \right\}
  \end{equation*}
  such that $\mathrm{JL}(\pi_B)_v = \mathrm{JL}(\pi_{B, v})$ for all places $v$.  In particular, $\pi_{B, v} \cong \pi_v$ for all places $v$ such that $B_v$ is split.
\end{itemize}

That's all we wanted to say about quaternion algebras and the Jacquet--Langlands correspondence.  Let's now go back to finding a way to go from the Waldspurger formula to a criterion for the nonvanishing of the central $L$-value.

\subsubsection{Non-vanishing}\label{sec:cq6tyamcm6}

Return to the previous setting.  Let $L / K$ be a quadratic extension of global fields, so that we have
\begin{equation*}
  T = L^\times / K^\times \subset G := \mathrm{PGL}_2, \qquad \chi :[T] \rightarrow \mathbb{C}^\times
\end{equation*}
as before.  Let $B$ be a quaternion algebra such that $L \subset B$.  Then we obtain an embedding
\begin{equation*}
  T = L^\times / K^\times \subset G^B \rightarrow B^\times / K^\times.
\end{equation*}
It turns out that in this situation also, there is a Waldspurger formula for the period of cusp forms on $G^B$ over $T$.  When you combine all these formulas, you can deduce the following nonvanishing result:
\begin{theorem}[Waldspurger]\label{theorem:cq6tyal0fv}
  Let $\pi \subset A_{\mathrm{cusp}}(G)$.  Then the following are equivalent:
  \begin{enumerate}[(i)]
  \item $L(\tfrac{1}{2}, \pi_L \times \chi) \neq 0$.
  \item There exists a quaternion algebra $B$ over $K$ with $L \subset B$ and $\pi_B \subset A_{\mathrm{cusp}}(G^B)$ with $\operatorname{JL}(\pi_B) = \pi$ with $\mathcal{P}_{T, \chi} |_{\pi^B} \neq 0$.
  \end{enumerate}
\end{theorem}
That's the statement.  We'll now aim to explain how Jacquet was able to reprove this using a comparison of RTF.

\subsubsection{RTF approach}\label{sec:cq6tyamdej}

For simplicity, we will only consider the case where $\chi = 1$ is trivial.  This simplifies in particular the base change $L$-function, which is then just $L(s, \pi_L) = L(s, \pi) L(s, \pi \times \eta)$, where
\begin{equation*}
  \eta : K^\times \backslash \mathbb{A}_K^\times / N_{L / K}(\mathbb{A}_L^\times) \xrightarrow{\simeq} \{\pm 1\}
\end{equation*}

is the quadratic character of the idele class group of $K$ that is associated to the extension $L / K$ by class field theory.  In particular,
\begin{equation*}
  L(\tfrac{1}{2}, \pi) \neq 0
  \quad \iff \quad
  \mathcal{P}_{A} |_\pi \not \equiv 0
\end{equation*}
and
\begin{equation*}
  L(\tfrac{1}{2}, \pi \times \eta) \neq 0
  \quad \iff \quad
  \mathcal{P}_{A, \eta} |_\pi \not \equiv 0.
\end{equation*}
Jacquet's idea: prove Waldspurger's theorem using a comparison of RTF.  On the one side, we'll have the RTF associated to
\begin{equation}\label{eq:cq6tx983u1}
  T \backslash G^B / T.
\end{equation}
We'd like to compare it to the RTF that sees these two Hecke periods, ie.. that which is associated, at least formally, to the double quotient
\begin{equation}\label{eq:cq6tx98942}
  A \backslash G / A, \eta.
\end{equation}

One remark before we proceed.  We have already solved yesterday all the convergence issues.  In the two relative trace formulas that we want to consider, there is a precise way to form the integral defining the RTF.  For the first case \eqref{eq:cq6tx983u1}, we are taking periods over $[T]$, which is compact, so the RTF is already convergent.  This is not the case for \eqref{eq:cq6tx98942}, but it can be regularized as in yesterday's talk.  We are now starting from something that is really defined.  We want to compare these two relative trace formulas.  We do so by trying to match the geometric expansions.  Let's describe those.

\subsubsection{Geometric expansions}\label{sec:cq6tyamec3}

\begin{enumerate}[(a)]
\item
  \begin{equation*}
    \mathrm{RTF}_{T \backslash G^B / T}(f) = \sum_{\delta \in T(K) \backslash G^B(K) / T(K)}
    \vol([(T \times T)_\delta]) \operatorname{Orb}_\gamma(f).
  \end{equation*}
  \begin{exercise}\label{exercise:cq6tyalwr3}
    We need to parametrize the orbits.  Define
    \begin{equation*}
      L_B^- := L^\perp \subset B = L \oplus L_B^-.
    \end{equation*}
    We can define a map
    \begin{equation*}
      \nu : G^B \rightarrow \mathbb{P}^1 - \{1\}
    \end{equation*}
    \begin{equation*}
      \delta = \delta^+ + \delta^- \mapsto - \frac{N(\delta^-)}{N(\delta^+)}.
    \end{equation*}
    (Check why we miss $1$!)  This induces an injection
    \begin{equation*}
      T(K) \backslash G^B(K) / T(K) \rightarrow \mathbb{P}^1(K) \setminus \{1\}
    \end{equation*}
    with image $(- N(L_B^-) \setminus \{1\}) \cup \{\infty\}$.
  \end{exercise}
  \begin{definition}\label{definition:cq6tyalx5j}
    We say that  $\delta \in G^B$ is \emph{regular semisimple} if $\nu(\delta) \neq 0$ or $\infty$.
  \end{definition}
  We denote by
  \begin{equation*}
    G_{\mathrm{rs}}^B \subset G^B
  \end{equation*}
  the subset consisting of regular semisimple elements.

  \begin{exercise}\label{exercise:cq6tyaqy0z}
    \begin{equation*}
      \sqcup_{
        \substack{
          B: \text{quat.\ alg }/ K  \\
          L \subset B          
        }
      }
      \nu(G_{\mathrm{rs}^B(K)})
      = \mathbb{P}^1(K).
    \end{equation*}
  \end{exercise}
  \begin{notation}\label{notation:1}
    For $x \in \nu(G^B(K))$, we set
    \begin{equation}\label{eq:cq6tyc779o}
      \operatorname{Orb}_{\delta_x}(f) =: \O_x(f)
    \end{equation}
    and $\nu(\delta_x) = x$.

  \end{notation}
  \begin{exercise}\label{exercise:cq6tydnqrq}
    Let $x \in K^\times \setminus \{1\}$.  Then
    \begin{equation*}
      \mu_K^{-1}(x) = A(k)
      \underbrace
      {
        \begin{pmatrix}
          1      & x \\
          1 & 1 \\
        \end{pmatrix}
      }_{
        \gamma_x
      }
      \quad
      \gamma_x := .
    \end{equation*}
    For $x = 0$, we have
    \begin{equation*}
      \mu_K^{-1}(0) =
      A(K)
      \sqcup A(K)
      \underbrace
      {
        \begin{pmatrix}
          1        & 1 \\
          0 & 1 \\
        \end{pmatrix}
      }_{
        \gamma_0^+
      }
      A(K) \sqcup A(K)
      \underbrace
      {
        \begin{pmatrix}
          1        & 0 \\
          1                 & 1 \\
        \end{pmatrix}
      }_{
        \gamma_0^-
      }
      A(K).
    \end{equation*}
    For $x = \infty$, we have
    \begin{equation*}
      \mu_K^{-1}(\infty) = A(K) \omega \sqcup A(K) \underbrace
      {
        \omega \gamma_0^+ 
      }_{
        \gamma_\infty^+
      }
      A(K) \sqcup A(K) \underbrace
      {
        \omega \gamma_0^- 
      }_{
        \gamma_\infty^-
      }
      A(K),
      \quad  \omega =
      \begin{pmatrix}
        & 1 \\
        1 &  \\
      \end{pmatrix}.
    \end{equation*}
  \end{exercise}
\item\label{enumerate:cq6tydex7z} Now we need to regularize and work out the following:
  \begin{equation*}
    \mathrm{RTF}_{A \backslash G / A, \eta}(f) = \sum_{x \in \mathbb{P}^1(K) \setminus \{1\}} \mathcal{O}_x^\eta(f),
  \end{equation*}
  where for $x \neq 0, \infty$, we set
  \begin{equation*}
    \mathcal{O}_x^\eta(f) := \operatorname{Orb}_{\gamma_x}(f),
  \end{equation*}
  while for $x = 0, \infty$, we have
  \begin{equation*}
    \mathcal{O}_x^\eta(f) := \operatorname{Orb}_{\gamma_x^+}^{\reg}(f) + \operatorname{Orb}_{\gamma_x^-}^{\reg}(f).
  \end{equation*}  
\end{enumerate}

\subsubsection{Local transfer}

We briefly survey local transfer.  Let $v$ be a place of $K$.  Set $E / F := L_v / K_v$.  We have $T = E^\times / F^\times \hookrightarrow G = \mathrm{PGL}_2(F)$ and also $T \hookrightarrow G^B$.
\begin{definition}\label{definition:cq6tydlv0l}
  We say that $f \in C_c^\infty(G)$ and $f^B \in C_c^\infty(G^B)$ \emph{match} if $\mathcal{O}_x^\eta(f) = \mathcal{O}_x(f^B)$ for all $x \in \nu(G^B)$.
\end{definition}

First, a notation.  Other than writing that two functions match, you can just use this symbol $f \leftrightarrow f^B$.  Now, if $v$ is split in $L$, then $B$ must split, and not only must $G^B$ and $G$ be isomorphic, but there must be an isomorphism respecting $T$ and $A$, i.e.,
\begin{equation*}
  (G^B, T) \cong(G, A),
\end{equation*}
and the existence of matchings turns out to be trivial.  So let's assume that $v$ is non-split -- this is the nontrivial case.  Then you can genuinely have two quaternion algebras.
\begin{theorem}\label{theorem:cq6tydtozy}[Jacquet]
  \begin{enumerate}[(i)]
  \item For all $f \in C_c^\infty(G)$, there exist $(f_+, f_-) \in C_c^\infty(G^{B_+}) \bigoplus C_c^\infty(G^{B_-})$ such that $f \leftrightarrow f_+$ and $f \leftrightarrow f_-$.
  \item For all pairs $(f_+, f_-)$, there exists $f$ such that $f \leftrightarrow f_{\pm}$.
  \end{enumerate}
\end{theorem}
We'll also need the fundamental lemma.  We'll explain that briefly next time, then say how to get the matching.

\begin{remark}
  Given an algebraic subgroup $H$ of an algebraic group $G$, there is a way to make the quotient $H \leq G$ a variety.  Even over a field, it is not necessarily the case that $H(k) \backslash G(k)$ coincides with $(H \backslash G)(k)$, but the former is always contained in the latter:
  \begin{equation}\label{eq:cq6tyq0ey8}
    H(k) \backslash G(k) \subseteq (H \backslash G)(k).
  \end{equation}
  We have
  \begin{equation*}
    (H \backslash G)(k) = \bigsqcup_{\alpha \in \ker(H^1(k, H) \rightarrow H^1(k, G))}
    H_\alpha(k) \backslash G(k),
  \end{equation*}
  thus
  \begin{equation*}
    C_c^\infty((H \backslash G)(k)) = \bigoplus_{\alpha} C_c^\infty \left( H_\alpha(k) \backslash G(k) \right).
  \end{equation*}
  If $k$ is local, then \eqref{eq:cq6tyq0ey8} is closed and open.

  Here we need $H$ to be smooth.  Otherwise, consider $\mu_2 \backslash \mathbb{G}_m$ with $\operatorname{char}(k) = 2$; theo rbits in this case are not open.

  If $X \circlearrowright G$, we can form the stack $[X / G]]$, and we have (groupoids)
  \begin{equation*}
    [X(k) / G(k)] \subset [X/G](k) = \bigsqcup_{\alpha \in H^1(k, G)} X_\alpha(k) / G_\alpha(k).
  \end{equation*}
  Here $\alpha$ corresponds to pure inner forms $G_\alpha$

  For example, if $X = T \backslash G \circlearrowleft T$ (same notation as today), then we end up looking at
  \begin{equation*}
    [T \backslash G / T](k)
    = \bigsqcup_{B \text{:quat}}
    T(k) \backslash G^B(k) / T(k).
  \end{equation*}
\end{remark}


\bibliography{refs}{} \bibliographystyle{plain}
\end{document}
